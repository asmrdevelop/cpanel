#!/usr/local/cpanel/3rdparty/bin/perl

# cpanel - bin/checkmailmanrequests                Copyright 2022 cPanel, L.L.C.
#                                                           All rights reserved.
# copyright@cpanel.net                                         http://cpanel.net
# This code is subject to the cPanel license. Unauthorized copying is prohibited

package bin::checkmailmanrequests;

use strict;
use warnings;

use Cpanel::Mailman::Filesys ();
use Cpanel::PwCache          ();

sub run {
    my ( $self, $list_to_check ) = @_;
    my ( $uid,  $gid )           = ( Cpanel::PwCache::getpwnam('mailman') )[ 2, 3 ];

    my $dir = Cpanel::Mailman::Filesys::MAILING_LISTS_DIR();

    opendir( my $mml, $dir ) or die "opendir($dir) failed: $!";

    while ( my $list = readdir($mml) ) {
        next if ( $list_to_check && $list ne $list_to_check );
        next if ( $list =~ /^\.+$/ );
        if ( !-e "${dir}/${list}/request.pck" ) {
            require File::Copy;
            File::Copy::copy( "/usr/local/cpanel/etc/request.pck", "${dir}/${list}/request.pck" );
            chown $uid, $gid, "${dir}/${list}/request.pck";
        }
    }

    closedir($mml) or warn "closedir($dir) failed: $!";
    return 0;
}

__PACKAGE__->run(@ARGV) unless caller();
