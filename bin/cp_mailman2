#!/usr/local/cpanel/3rdparty/bin/python2
# -*- coding: utf-8 -*-

# cpanel - bin/cp_mailman2                         Copyright 2022 cPanel, L.L.C.
#                                                           All rights reserved.
# copyright@cpanel.net                                         http://cpanel.net
# This code is subject to the cPanel license. Unauthorized copying is prohibited

import re
import sys

sys.path.insert(0, '/usr/local/cpanel/lib/python2')

import cPanel


def main(argv):
    if len(argv) < 3:
        print 'usage: cp_mailman2 <domain> <list> [<domain <list>] [<domain <list>] ...'
        return 1

    for i in range(1, len(argv), 2):
        domain = argv[i]
        list = argv[i + 1]

        def update(dict):
            dict['real_name'] = re.sub('_' + domain, '', dict['real_name'])
            dict['subject_prefix'] = re.sub('_' + domain, '', dict['subject_prefix'])
            dict['host_name'] = domain
            dict['web_page_url'] = cPanel.mailman_url_for_domain(domain)

        cPanel.update_mailman('%s_%s' % (list, domain), update)
        print 'Updated List', list, domain


if __name__ == '__main__':
    raise SystemExit(main(sys.argv))
