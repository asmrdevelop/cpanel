#!/usr/local/cpanel/3rdparty/bin/perl

# cpanel - bin/spf_uninstaller                     Copyright 2022 cPanel, L.L.C.
#                                                           All rights reserved.
# copyright@cpanel.net                                         http://cpanel.net
# This code is subject to the cPanel license. Unauthorized copying is prohibited

use strict;
use warnings;

use Cpanel::SPF                 ();
use Cpanel::AcctUtils::Account  ();
use Cpanel::Config::CpUserGuard ();

my $user = $ARGV[0];
if ( !Cpanel::AcctUtils::Account::accountexists($user) ) {
    die "$0: usage: $0 <user>";
}

my $cpuser_guard = Cpanel::Config::CpUserGuard->new($user);
my $cpuser_data  = $cpuser_guard->{'data'};
$cpuser_data->{'HASSPF'} = 0;
$cpuser_guard->save();

my ( $status, $msg ) = Cpanel::SPF::remove_spf( 'user' => $user );
unless ($status) {
    die $msg || 'Failed to remove SPF support.';
}
