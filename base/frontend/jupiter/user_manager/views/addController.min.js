define(["angular","lodash","cjt/util/locale","app/views/addEditController","cjt/directives/alertList","cjt/directives/bytesInput","cjt/directives/toggleLabelInfoDirective","cjt/directives/toggleSwitchDirective","cjt/directives/labelSuffixDirective","cjt/services/alertService","app/services/userService","cjt/services/dataCacheService"],(function(e,r,i,t){return e.module("App").controller("addController",["$scope","$routeParams","$timeout","$location","$anchorScroll","userService","alertService","directoryLookupService","dataCache","defaultInfo","quotaInfo","emailDaemonInfo","ftpDaemonInfo","webdiskDaemonInfo","features","spinnerAPI",function(r,o,s,c,a,n,u,l,d,m,f,v,p,D,h,b){var w=t(r,n,v,p,D,h,m,f,u),y=function(){w.initializeScope(),r.ui.user.sendInvite=r.ui.isInviteSubEnabled=!!window.PAGE.isInviteSubEnabled};y(),w.initializeView(),r.toggleService=function(e){e.enabled=!e.enabled},r.create=function(t,o){return r.inProgress=!0,u.clear(),a("btn-create"),n.create(t).then((function(t){var c,n=d.get("userList");if(n?(r.insertSubAndRemoveDupes(t,n),d.set("userList",n),c={loadFromCache:!0}):c={loadFromCache:!1},w.clearPrefetch(),u.add({type:"success",message:i.maketext("You successfully created the following user: [_1]",t.real_name||t.full_username),id:"createSuccess",autoClose:1e4}),o)r.loadView("list/rows",c);else{var l=r.ui.user.domain;y(),r.ui.user.domain=l,r.form.$setPristine(),a("top"),s((function(){var r=e.element("#full-name");r&&r.focus()}),10)}}),(function(e){var o=t.real_name||t.username+"@"+t.domain;e=e.error||e,u.add({type:"danger",message:i.maketext("The system failed to create the “[_1]” user with the following error: [_2]",o,e),id:"createError"}),a("top");var s=d.get("userList");e.user&&s&&(r.insertSubAndRemoveDupes(e.user,s),d.set("userList",s)),w.clearPrefetch()})).finally((function(){r.inProgress=!1}))},r.$watch("ui.user.services.ftp.homedir",(function(){r.ui.user.services.ftp.homedir||!r.form.txtFtpHomeDirectory||r.form.txtFtpHomeDirectory.$pristine||r.form.txtFtpHomeDirectory.$setViewValue("/")})),r.$watch("ui.user.services.webdisk.homedir",(function(){r.ui.user.services.webdisk.homedir||!r.form.txtWebDiskHomeDirectory||r.form.txtWebDiskHomeDirectory.$pristine||r.form.txtWebDiskHomeDirectory.$setViewValue("/")})),r.$watch("ui.user.username + '@' + ui.user.domain",(function(e,i){var t=e.split("@");!r.ui.user.services.ftp.isCandidate&&r.form.txtFtpHomeDirectory&&r.form.txtFtpHomeDirectory.$pristine&&(r.ui.user.services.ftp.homedir=r.ui.docrootByDomain[t[1]]+"/"+t[0]),!r.ui.user.services.webdisk.isCandidate&&r.form.txtWebDiskHomeDirectory&&r.form.txtWebDiskHomeDirectory.$pristine&&(r.ui.user.services.webdisk.homedir=r.ui.docrootByDomain[t[1]]+"/"+t[0])}))}])}));