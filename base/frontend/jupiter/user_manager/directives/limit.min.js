define(["angular","lodash","cjt/core","cjt/util/locale","cjt/directives/bytesInput","app/directives/selectOnFocus"],(function(e,i,u,l){function t(i,u){return e.isString(i)&&(i=parseInt(i,10)),isNaN(i)?u:i}e.module("App").directive("appLimit",["$timeout","$templateCache","$document",function(i,l,a){var n=1,m="directives/limit.phtml";return{restrict:"E",templateUrl:u.config.debug?u.buildFullPath("user_manager/directives/limit.phtml"):m,replace:!0,require:"ngModel",scope:{id:"@?id",unitsLabel:"@?unitsLabel",unlimitedLabel:"@?unlimitedLabel",unlimitedValue:"=unlimitedValue",minimumValue:"=minimumValue",maximumValue:"=maximumValue",isDisabled:"=ngDisabled",defaultValue:"=defaultValue",maximumLength:"=maximumLength",selectedUnit:"="},compile:function(u,l){return{pre:function(i,u,l){e.isUndefined(l.unlimitedLabel)&&(l.unlimitedLabel="Unlimited"),l.id||(l.id="ctrlLimit_"+n++)},post:function(u,l,n,m){e.isUndefined(u.unlimitedValue)&&(u.unlimitedValue=0),e.isUndefined(u.minimumValue)&&(u.minimumValue=1),u.maximumLength=t(u.maximumLength,null),u.unlimitedValue=t(u.unlimitedValue,0),u.minimumValue=t(u.minimumValue,1),u.maximumValue=t(u.maximumValue,null),u.defaultValue=t(u.defaultValue,null),u.selectedUnit=u.selectedUnit||"MB";var d=l.find(".textbox");m.$formatters.push((function(e){var i=e===u.unlimitedValue;return{unlimitedChecked:i,value:i?"":e}})),m.$render=function(){u.unlimitedChecked=m.$viewValue.unlimitedChecked,u.value=m.$viewValue.value},m.$parsers.push((function(e){return e.unlimitedChecked?u.unlimitedValue:e.value})),u.$watch("unlimitedChecked + value",(function(e,i){e!==i&&m.$setViewValue({unlimitedChecked:u.unlimitedChecked,value:u.unlimitedChecked?"":u.value})})),u.maximumLength&&u.maximumLength>0&&d.on("input",(function(e){this.value.length>u.maximumLength&&(this.value=this.value.slice(0,u.maximumLength))})),u.makeUnlimited=function(){""!==u.value?u.lastValue=u.value:u.defaultValue?u.lastValue=u.defaultValue:u.lastValue=u.minimumValue,u.unlimitedChecked=!0,u.value=""},u.enableLimit=function(){var t,n;u.isDisabled||(u.unlimitedChecked&&(""===u.value&&(""!==u.lastValue?u.value=u.lastValue:u.defaultValue?u.value=u.defaultValue:u.value=u.minimumValue),u.unlimitedChecked=!1),0===d.length&&(d=l.find(".textbox")),n=0,(t=d)&&(a.activeElement?a.activeElement:null)!==t&&(e.isUndefined(n)?t.focus():i((function(){t.focus()}),n)))},u.defaultValue?u.lastValue=u.defaultValue:u.lastValue=u.minimumValue}}}}}])}));