define(["angular","cjt/io/api","cjt/io/uapi-request","cjt/io/uapi","cjt/services/APIService"],(function(e,t,r,n){"use strict";e.module("cpanel.multiPhpManager.service",["cjt2.services.api"]).factory("configService",["$q","APIService",function(e,n){return{convertResponseToList:function(e){var t=[];if(e.status){for(var r=e.data,n=0,i=r.length;n<i;n++){var a=r[n];a.version&&(a.displayPhpVersion=this.transformPhpFormat(a.version)),t.push(a)}var s=e.meta;return{items:t,totalItems:s.paginate.total_records||r.length,totalPages:s.paginate.total_pages||1}}return{items:[],totalItems:0,totalPages:0}},applyDomainSetting:function(n,i){var a=e.defer(),s=new r.Class;return s.initialize("LangPHP","php_set_vhost_versions"),s.addArgument("version",n),void 0!==i&&i.length>0&&i.forEach((function(e,t){s.addArgument("vhost-"+t,e)})),t.promise(s.getRunArguments()).done((function(e){(e=e.parsedResponse).status?a.resolve(e.data):a.reject(e)})),a.promise},fetchList:function(n){var i=e.defer(),a=this,s=new r.Class;return s.initialize("LangPHP","php_get_vhost_versions"),n&&(n.sortBy&&n.sortDirection&&s.addSorting(n.sortBy,n.sortDirection,n.sortType),n.currentPage&&s.addPaging(n.currentPage,n.pageSize||10),n.filterBy&&n.filterCompare&&n.filterValue&&s.addFilter(n.filterBy,n.filterCompare,n.filterValue)),t.promise(s.getRunArguments()).done((function(e){if((e=e.parsedResponse).status){var t=a.convertResponseToList(e);i.resolve(t)}else i.reject(e.error)})),i.promise},fetchImpactedDomains:function(e,t){var i=new r.Class,a=new n;return i.initialize("LangPHP","php_get_impacted_domains"),i.addArgument(e,t),a.deferred(i).promise},friendlyPhpFormat:function(e){var t=e||"",r=/^\D+-(php)(\d{2,3})$/i;r.test(e)&&(t="PHP "+e.match(r)[2].replace(/(\d)$/,".$1"));return t},transformPhpFormat:function(e){e=e||"";var t=this.friendlyPhpFormat(e);return""!==t&&t!==e?t+" ("+e+")":e},getEA4Recommendations:function(){var e=new r.Class,t=new n;return e.initialize("EA4","get_recommendations"),t.deferred(e).promise},getCustomRecommendations:function(){var e=new r.Class,t=new n;return e.initialize("EA4","get_php_recommendations"),t.deferred(e).promise}}}])}));