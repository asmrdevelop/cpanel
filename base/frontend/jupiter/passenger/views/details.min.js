define(["angular","lodash","cjt/util/locale","cjt/util/parse","cjt/util/table","app/directives/passenger_validators","cjt/directives/toggleSwitchDirective","cjt/directives/actionButtonDirective","cjt/directives/toggleLabelInfoDirective","cjt/directives/alertList","cjt/directives/pageSizeDirective","cjt/services/alertService","cjt/services/cpanel/componentSettingSaverService","cjt/services/viewNavigationApi","cjt/directives/validationContainerDirective","cjt/directives/validationItemDirective","cjt/validator/ip-validators","cjt/validator/domain-validators","cjt/validator/compare-validators","cjt/validator/datatype-validators","cjt/validator/path-validators","cjt/validator/length-validators","cjt/services/viewNavigationApi","app/directives/table_row_form","uiBootstrap"],(function(e,a,t,i,n){return e.module("cpanel.applicationManager").controller("ConfigurationDetailsController",["$routeParams","viewNavigationApi","Apps","Domains","defaultInfo","alertService","componentSettingSaverService",function(i,o,r,s,c,l,p){var d=this;d.is_loading=!1,d.domains=[],d.user_home_dir=c.homedir,d.supports_env_vars=r.has_support_for_env_vars,d.edit_mode=void 0!==i.applname,d.editing_envar=!1,d.forceLoad=!1,d.isRTL=!1,d.savedSettings={};var v={showAllHelp:!0};d.formDescription=d.edit_mode?t.maketext("You can use this section of the interface to manage your custom applications."):t.maketext("You can use this section of the interface to register a new application.");var u=document.querySelector("html");u&&(d.isRTL="rtl"===u.getAttribute("dir")),d.get_page_title=function(){return d.edit_mode?t.maketext("Edit"):t.maketext("Register")},d.get_application_title=function(){return d.edit_mode?t.maketext("Edit Your Application"):t.maketext("Register Your Application")};var g=new n;d.meta=g.getMetadata(),d.filteredEnvars=g.getList(),d.paginationMessage=g.paginationMessage,d.renderEnvars=function(){d.filteredEnvars=g.update()},d.sortList=function(){d.renderEnvars()},d.selectPage=function(){d.renderEnvars()},d.selectPageSize=function(){d.renderEnvars()},d.searchList=function(){d.renderEnvars()},d.goToView=function(e,a){o.loadView(e,a?{forceLoad:1}:{})},d.save_application=function(){if(d.add_app.$pristine||d.add_app.$invalid)l.add({type:"danger",message:t.maketext("Your application is incomplete or invalid."),closeable:!0,replace:!0,autoClose:!1,group:"passenger"});else{if(!d.editing_envar)return d.edit_mode?d.save_edited_application():d.save_new_application();l.add({type:"danger",message:t.maketext("You must finish adding or editing environment variables first."),closeable:!0,replace:!0,autoClose:!1,group:"passenger"})}},d.save_edited_application=function(){return r.update_application(d.application,d.previous_name).then((function(){l.add({type:"success",message:t.maketext("You successfully updated your application."),closeable:!0,replace:!1,autoClose:1e4,group:"passenger"}),d.goToView("manage",!0)})).catch((function(e){l.add({type:"danger",message:e,closeable:!0,replace:!1,group:"passenger"})}))},d.save_new_application=function(){return r.add_application(d.application).then((function(){l.add({type:"success",message:t.maketext("You successfully registered your application."),closeable:!0,replace:!1,autoClose:1e4,group:"passenger"}),d.goToView("manage",!0)})).catch((function(e){l.add({type:"danger",message:e,closeable:!0,replace:!1,group:"passenger"})}))},d.add_envar=function(){g.add({name:"",value:"",is_editing:!0,is_new:!0}),d.editing_envar=!0,d.renderEnvars()},d.close_envar_editor=function(e){e.is_editing=!1,d.editing_envar=!1,e.is_new&&(g.remove(e),d.renderEnvars())},d.save_envar=function(e,a,t){e.is_new?delete e.is_new:a!==e.name&&delete d.application.envvars[e.name],e.name=a,e.value=t,d.application.envvars[a]=t,d.close_envar_editor(e),d.renderEnvars()},d.delete_envar=function(e){g.remove(e),delete d.application.envvars[e.name],d.renderEnvars(),d.add_app.$setDirty()},d.edit_envar=function(e){e.is_editing=!0,d.editing_envar=!0},d.toggleShowAllHelp=function(){d.savedSettings.showAllHelp=!d.savedSettings.showAllHelp,p.set("application_details",d.savedSettings)},d.init=function(){l.clear(void 0,"passenger");var t=p.getCached("application_details").cachedValue;a.merge(d.savedSettings,v,t||{}),d.edit_mode?(d.is_loading=!0,r.get_application_by_name(i.applname).then((function(t){d.application=e.copy(t),d.application=r.strip_homedir_from_path(d.application);var i=[];a.forOwn(d.application.envvars,(function(e,a){i.push({name:a,value:e,is_editing:!1})})),g.load(i),d.renderEnvars(),d.previous_name=d.application.name,d.is_loading=!1}))):(0===r.applications.length&&(d.forceLoad=!0),d.application=r.get_default_application()),s.fetch().then((function(e){d.domains=e})),g.setSort("name","asc")},d.init()}])}));