function MailingListItem(){this.defaultValues={accesstype:"",advertised:0,archive_private:0,desthost:"",diskused:"",humandiskused:"00.00 KB",list:"",listadmin:"",listid:"",subscribe_policy:0}}function MailingListService(e,t){var i=this;if(i.lists=[],i.loading=!1,i.alertService=t,i.page=0,i.pageSize=10,i.maxPages=3,i.totalResults=0,i.filterValue="",i.totalPages=0,i.errors=[],i.request=null,i.meta={sort:{sortBy:"list",sortDirection:"asc",sortType:""}},i.meta.sort.sortString="list",i.addItem=function(e){var t=new MailingListItem;t.create(e),i.lists.push(t)},i.handleLoadSuccess=function(t){i.lists=[];for(var a=0;a<t.cpanel_data.length;a++)i.addItem(t.cpanel_data[a]);var r=t.cpanel_raw.metadata.paginate;void 0!==r&&(i.totalPages=r.total_pages,i.totalResults=r.total_results),i.loading=!1,e.$apply()},i.handleLoadError=function(t){i.loading=!1,i.alertService.clear(),angular.forEach(t.cpanel_messages,(function(e){i.alertService.add({message:e.content,type:e.level})})),e.$apply()},i.selectPage=function(){i.getLists()},i.selectPageSize=function(e){i.pageSize=e,i.getLists()},i.dataSorted=function(){i.meta.sort.sortString="asc"===i.meta.sort.sortDirection?i.meta.sort.sortBy:"!"+i.meta.sort.sortBy,i.getLists()},i.getLists=function(){YAHOO.util.Connect.isCallInProgress(i.request)&&(YAHOO.util.Connect.abort(i.request),i.request=null),i.errors=[];var e={module:"Email",version:"3",func:"list_lists",data:{domain:CPANEL.PAGE.domain},api_data:{sort:[],filter:[]},callback:{success:i.handleLoadSuccess,failure:i.handleLoadError}};"humandiskused"===i.meta.sort.sortBy?e.api_data.sort.push([("asc"===i.meta.sort.sortDirection?"":"!")+"diskused","numeric"]):""!==i.meta.sort.sortString&&e.api_data.sort.push(i.meta.sort.sortString),""!==i.filterValue&&e.api_data.filter.push(["*","contains",i.filterValue]),-1!==i.pageSize&&(e.api_data.paginate={start:(i.page-1)*i.pageSize,size:i.pageSize}),i.request=CPANEL.api(e),i.loading=!0},"initData"in window.PAGE){i.totalResults=Number(window.PAGE.initData.totalResults)||0,i.totalPages=Number(window.PAGE.initData.totalPages)||1,i.pageSize=Number(window.PAGE.initData.resultsPerPage)||i.pageSizes[0];for(var a=0;a<window.PAGE.initData.lists.length;a++)i.addItem(window.PAGE.initData.lists[a])}else i.getLists()}MailingListItem.prototype.create=function(e){angular.extend(this,this.defaultValues,e)},MailingListItem.prototype.getAttribute=function(e){return this[e]},MailingListItem.prototype.formatListAdmins=function(e){var t=this.getAttribute("listadmin"),i={maxItems:t.length,maxCols:t.length,separator:"\n"};e=angular.extend(i,e);for(var a,r=t.split(","),s=0;s<r.length;s++){var n=r[s].replace(/[\r\n]/gi,"").trim();if(n.length>e.maxCols&&(n=n.substr(0,e.maxCols-3)+"…"),r[s]=n,s===e.maxItems-1&&s+2<r.length){a=r.length-e.maxItems,r.splice(s+1);break}}return a?LOCALE.maketext("[join,_1,_2][_1] … and [numf,_3] more",e.separator,r,a):r.join(e.separator)},define("app/services/mailingListsService",["angular","cjt/util/locale","cjt/services/alertService"],(function(e){var t;try{t=e.module("App")}catch(i){t=e.module("App",[])}MailingListService.$inject=["$rootScope","alertService"],t.service("mailingListsService",MailingListService)})),define("app/controllers/mailingListsController",["angular","app/services/mailingListsService"],(function(e){var t;try{t=e.module("App")}catch(i){t=e.module("App",[])}function i(e,t){var i=this;i.model=t,i.columnHeaders=[],i.addColumn=function(e,t){i.columnHeaders.push({key:e,name:t})},i.getHeaders=function(){return i.columnHeaders},i.getLists=function(){return i.model.lists},i.addColumn("list",LOCALE.maketext("List Name")),i.addColumn("humandiskused",LOCALE.maketext("Usage")),i.addColumn("accesstype",LOCALE.maketext("Access")),i.addColumn("listadmin",LOCALE.maketext("Admin")),i.addColumn("functions",LOCALE.maketext("Functions"))}i.$inject=["$scope","mailingListsService"],t.controller("mailingListsController",i)})),define("app/controllers/mainController",["angular","app/services/mailingListsService","cjt/directives/alertList","cjt/filters/qaSafeIDFilter","cjt/decorators/paginationDecorator"],(function(e){var t;try{t=e.module("App")}catch(i){t=e.module("App",[])}function i(e,t,i){var a=this;a.model=t,a.spinner=i,e.totalItems=a.model.totalResults,e.currentPage=a.model.page,e.$watch((function(){return a.model.loading}),(function(){a.model.loading?a.spinner.start():a.spinner.stop()})),a.startSearch=function(){a.model.page=0,a.model.getLists()},a.clearSearch=function(){a.model.filterValue="",a.model.selectPage(0)},e.$watch((function(){return a.model.pageSize}),(function(e,t){e!==t&&a.model.getLists()})),e.$watch((function(){return a.model.filterValue}),(function(e,t){""!==e?a.startSearch():e!==t&&a.clearSearch()}))}i.$inject=["$scope","mailingListsService","spinnerAPI"],t.controller("mainController",i)})),function(e){"use strict";var t,i=e.LOCALE,a=e.CPANEL,r=e.YAHOO,s=r.util.Dom,n=r.util.Event,o=e.CPANEL.PAGE,l=e.Handlebars,c={};if(o.lists&&o.lists.length)for(var u=o.lists.length-1;u>=0;u--)c[o.lists[u].list]=o.lists[u];var d={advertised:!1,archive_private:!0,subscribe_policy:["3","2"]};function p(e,t,i){var r=i.dialog,s=a.dom.get_data_from_form(r.form,{include_unchecked_checkboxes:0});s.list=i.list,a.api({version:3,module:"Email",func:"set_list_privacy_options",data:s,callback:a.ajax.build_page_callback((function(){i.onSuccess.call(),r.destroy()}),{on_error:r.destroy.bind(r)})})}function m(){var e=s.getAncestorByTagName(this,"form"),t=a.dom.get_data_from_form(e);for(var i in d)if("checkbox"===e[i].type)e[i].checked=d[i];else{var n=d[i];r.lang.isArray(n)||(n=[n]),-1===n.indexOf(t[i])&&a.dom.set_form_el_value(e[i],n[0])}g("private")}function g(e){s.get("form_access_type").innerHTML=o.translated_access_type[e]}function f(e,t){var i,s="private",n=a.dom.get_data_from_form(t);for(var o in d)if(d.hasOwnProperty(o)){i="checkbox"===t[o].type?!!n[o]:n[o];var l=d[o];if(r.lang.isArray(l)?-1===l.indexOf(i)&&(s="public"):i!==l&&(s="public"),"public"===s)break}g(s)}function v(e,t){setTimeout((function(){f(0,t)}),1)}r.lang.augmentObject(e,{privacy_opts_popup:function(e,r,o){t||(t=l.compile(s.get("change_list_privacy_template").text.trim()));var c=new a.ajax.Common_Dialog(null,{close:!0,show_status:!0,status_html:i.maketext("Saving …")});c.setHeader(a.widgets.Dialog.applyDialogHeader(i.maketext("Edit Privacy Options: “[_1]”",e.list.html_encode())));var u=e,d=String(u.subscribe_policy);c.form.innerHTML=t({advertised:"1"===String(u.advertised),archive_private:"1"===String(u.archive_private),subscribe_policy_is_1:"1"===d,subscribe_policy_is_2:"2"===d,subscribe_policy_is_3:"3"===d}),c.submitEvent.subscribe(p,{list:e.list.html_encode(),dialog:c,onSuccess:o}),c.show_from_source(r),f(0,c.form),n.on(c.form,"change",f,c.form),n.on(c.form,"reset",v,c.form);var g=a.Y(c.form).one(".set-private-values");n.on(g,"click",m)}}),o.notice&&(o.noticeHandle=new a.widgets.Page_Notice(o.notice))}(window),define("app/lists",["angular","cjt/modules"],(function(e){"use strict";return e.module("App",["ui.bootstrap","cjt2.cpanel"]),require(["cjt/directives/toggleSortDirective","cjt/directives/spinnerDirective","cjt/directives/searchDirective","cjt/directives/pageSizeDirective","app/services/mailingListsService","app/controllers/mailingListsController","app/controllers/mainController","uiBootstrap"],(function(){var t=e.module("App");function i(e){var t=this;i.prototype.closed=function(){e.getLists()},i.prototype.open=function(e,i){window.privacy_opts_popup(e,i.currentTarget,t.closed)}}t.filter("escape",(function(){return window.escape})),i.$inject=["mailingListsService"],t.controller("PrivacyWindowController",i),t.init=function(){var i=e.element("#content");return null!==i[0]&&e.bootstrap(i[0],["App"]),t},t.init()}))}));