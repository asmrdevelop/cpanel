define(["angular","lodash","cjt/util/locale","app/directives/itemLister","app/directives/itemListerView","app/services/apiTokens","app/views/create","cjt/modules","cjt/services/alertService","cjt/directives/actionButtonDirective"],(function(e,t,n,i,s,o,a){"use strict";var l=n.maketext("List API Tokens"),r="cpanel.apiTokens.views.list",c=[i.namespace,s.namespace,o.namespace],u=["$scope","$location",o.serviceName,"alertService","apiTokens","ITEM_LISTER_CONSTANTS"],d="ListController",m=function(e,i,s,o,l,r){e.init=function(){e._apiTokens=l,e._filteredItems=[],e.selectedItems=[],e.confirmingDelete=!1,e.deletingTokens=!1,e.tableHeaderItems=[{field:"label",label:n.maketext("Token Name"),sortable:!0},{field:"createdOn",label:n.maketext("Created"),hiddenOnMobile:!0,sortable:!0},{field:"expiresAt",label:n.maketext("Expires"),hiddenOnMobile:!0,sortable:!0},{field:"actions",label:"",sortable:!1}],["TABLE_ITEM_SELECTED","TABLE_ITEM_DESELECTED","ITEM_LISTER_SELECT_ALL","ITEM_LISTER_DESELECT_ALL"].forEach((function(t){e.$on(r[t],e._updatedSelected)})),e.$on(r.ITEM_LISTER_UPDATED_EVENT,(function(t,n){e._filteredItems=n.items,e._updatedSelected()}))},e._deleteTokenSuccess=function(t,s){e._apiTokens=s,o.success(n.maketext("The system successfully revoked the following [asis,API] [numerate,_1,token,tokens]: [list_and_quoted,_1]",t)),0===e._apiTokens.length&&i.path(a.route),e.confirmingDelete=!1,e.deletingTokens=!1},e._updatedSelected=function(){e.selectedItems=e._filteredItems.filter((function(e){return e.selected}))},e.deleteTokens=function(n){var i=[],o=[];return n.forEach((function(e){o.push(e.id),i.push(t.escape(e.label))})),e.deletingTokens=!0,s.deleteTokens(o).then(e._deleteTokenSuccess.bind(e,i))},e.showDeletionConfirmationMessage=function(){e.confirmingDelete=!0},e.hideDeletionConfirmationMessage=function(){e.confirmingDelete=!1},e.confirmDeleteButtonLabel=function(){return n.maketext("Revoke Selected [asis,API] [numerate,_1,Token,Tokens]",e.selectedItems.length)},e.getItems=function(){return e._apiTokens},e.getSelectedFeatureNames=function(){return e.selectedItems.map((function(e){return e.id}))},e.confirmDeleteMessage=function(){var i=e.getSelectedFeatureNames().map(t.escape);return n.maketext("Are you sure that you want to revoke the following [asis,API] [numerate,_1,token,tokens]: [list_and_quoted,_2]",i.length,i)},e.init()};return e.module(r,c).controller(d,u.concat(m)),{id:"listAPITokens",route:"/",controller:d,class:m,templateUrl:"views/list.ptt",title:l,namespace:r,showResourcePanel:!1,resolve:{apiTokens:[o.serviceName,"$location",function(e,t){return e.fetchTokens().then((function(e){return e.length?e:(t.path(a.route),!1)}))}]}}}));