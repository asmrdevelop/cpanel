define("app/services/modSecurityDomainService",["angular","lodash","cjt/util/locale","cjt/io/api","cjt/io/uapi-request","cjt/io/uapi","cjt/services/APIService"],(function(e,t,i,a,n,o){e.module("App").factory("modSecurityDomainService",["$q","APIService",function(i,a){function o(e){var i=[];if(e.data){for(var a=e.data,n=0,o=a.length;n<o;n++)i.push(a[n]);var s=e.meta,r=s.paginate.total_records||a.length,l=s.paginate.total_pages||1,c=0,d=0;if(s.hasOwnProperty("modsec"))c=s.modsec.total_enabled,d=s.modsec.total_disabled;else{var u=t.filter(a,(function(e){return!!e.enabled}));c=u?u.length:0,d=a.length-c}return{items:i,totalItems:r,totalPages:l,totalEnabled:c,totalDisabled:d}}return{items:[],totalItems:0,totalPages:0,totalEnabled:0,totalDisabled:0}}function s(e,t){var i=new n.Class;return i.initialize("ModSecurity",e,{domains:t}),this.deferred(i,{done:function(e,t){var i=o(e=e.parsedResponse);e.status?t.resolve(i):t.reject({items:i.items,error:e.error})}}).promise}function r(e){var t=new n.Class;return t.initialize("ModSecurity",e),this.deferred(t,{done:function(e,t){var i=o(e=e.parsedResponse);e.status?t.resolve(i):(i.error=e.error,t.reject(i))}}).promise}var l=function(){};return l.prototype=new a,e.extend(l.prototype,{fetchList:function(e){var t=new n.Class;return t.initialize("ModSecurity","list_domains"),e&&(e.sortBy&&e.sortDirection&&t.addSorting(e.sortBy,e.sortDirection,e.sortType),e.pageNumber&&t.addPaging(e.pageNumber,e.pageSize||10),e.filterBy&&e.filterCompare&&e.filterValue&&t.addFilter(e.filterBy,e.filterCompare,e.filterValue)),this.deferred(t,{transformAPISuccess:o}).promise},prepareList:function(e){return o(e)},enableDomains:function(e){return s.call(this,"enable_domains",e)},enableAllDomains:function(){return r.call(this,"enable_all_domains")},disableDomains:function(e){return s.call(this,"disable_domains",e)},disableAllDomains:function(){return r.call(this,"disable_all_domains")}}),new l}])})),define("app/views/domainListController",["angular","lodash","cjt/util/locale","uiBootstrap","cjt/directives/alertList","cjt/services/alertService","cjt/decorators/paginationDecorator","cjt/directives/toggleSortDirective","cjt/directives/validationItemDirective","cjt/directives/spinnerDirective","cjt/directives/autoFocus","cjt/filters/wrapFilter","cjt/filters/breakFilter","app/services/modSecurityDomainService"],(function(e,t,i){var a=e.module("App"),n=function(e,t){for(var i=0,a=e.length;i<a;i++){var n=o(t,e[i].domain);n?(e[i].enabled=n.enabled,n.exception?e[i].exception=n.exception:delete e[i].exception):e[i].exception&&delete e[i].exception}},o=function(e,t){for(var i=0,a=e.length;i<a;i++)if(e[i].domain===t)return e[i]},s=function(e,t){return function(e,t){for(var i=0,a=e.length;i<a;++i)if(t(e[i]))return i;return-1}(e,(function(e){return t===e.domain}))},r=function(e,t){if(e&&e.length>0){var i=s(e,t);-1!==i&&e.splice(i,1)}},l=function(e,t,i){var a=s(e,t),n={domain:t,exception:i};-1!==a?e.splice(a,1,n):e.push(n)};return a.controller("domainListController",["$scope","$routeParams","$q","modSecurityDomainService","spinnerAPI","alertService",function(o,s,c,d,u,m){o.clearFilter=function(){return o.meta.filterValue="",o.activeSearch=!1,o.filteredData=!1,o.selectedRow=-1,o.fetch()},o.startFilter=function(){o.activeSearch=!0,o.filteredData=!1,o.selectedRow=-1;var e=c.defer();e.promise.then((function(){o.selectPage(1)})).then((function(){o.filteredData=!0})),e.resolve()},o.toggleRow=function(e,t){e.preventDefault(),t===o.selectedRow?o.selectedRow=-1:o.selectedRow=t},o.selectPage=function(t){return o.selectedRow=-1,t&&e.isNumber(t)&&(o.meta.pageNumber=t),o.fetch()},o.sortList=function(e,t){o.selectedRow=-1,t||o.fetch()},o.triggerToggleSearch=function(e){27===e.keyCode&&o.toggleSearch(!0),13===e.keyCode&&o.toggleSearch()},o.toggleSearch=function(e){var t=o.meta.filterValue;t||!o.activeSearch&&!o.filteredData?e&&o.activeSearch?o.clearFilter():t&&o.startFilter():o.clearFilter()},o.fetch=function(){return u.start("loadingSpinner"),d.fetchList(o.meta).then((function(i){var a,n;o.domainList=(a=i.items,(n=o.issues)&&0!==n.length?(e.forEach(a,(function(e){var i=t.find(n,(function(t){return e.domain===t.domain}));!function(e,t){t&&(t.exception?e.exception=t.exception:e.exception&&delete e.exception)}(e,i)})),a):a),o.totalItems=i.totalItems,o.totalPages=i.totalPages,o.totalEnabled=i.totalEnabled,o.totalDisabled=i.totalDisabled}),(function(e){m.add({type:"danger",message:e,id:"fetchError"})})).then((function(){u.stop("loadingSpinner")}))},o.setDomain=function(t){return u.start("loadingSpinner"),t.enabled?d.enableDomains(t.domain).then((function(e){o.totalEnabled++,o.totalDisabled--,r(o.issues,t.domain),t.exception&&delete t.exception,f(),m.add({type:"success",message:i.maketext("Successfully enabled [asis,ModSecurity™] on “[_1]”.",e.items[0].domain),id:"enableSuccess"})}),(function(i){var a;if(e.isString(i))a=i;else{var n=i.items[0].exception,s=i.items[0].enabled;l(o.issues,t.domain,n),t.exception=n,t.enabled=s,f(),a=i.error}m.add({type:"danger",message:a,id:"enableFailure"})})).then((function(){u.stop("loadingSpinner")})):d.disableDomains(t.domain).then((function(e){o.totalDisabled++,o.totalEnabled--,r(o.issues,t.domain),t.exception&&delete t.exception,f(),m.add({type:"success",message:i.maketext("Successfully disabled [asis,ModSecurity™] on “[_1]”.",e.items[0].domain),id:"disableSuccess"})}),(function(i){var a;if(e.isString(i))a=i;else{var n=i.items[0].exception,s=i.items[0].enabled;l(o.issues,t.domain,n),t.exception=n,t.enabled=s,f(),a=i.error}m.add({type:"danger",message:a,id:"disableFailed"})})).then((function(){u.stop("loadingSpinner")}))},o.enableAllDomains=function(t){return t.preventDefault(),u.start("loadingSpinner"),d.enableAllDomains().then((function(e){p(),n(o.domainList,e.items),o.totalItems=e.totalItems,o.totalPages=e.totalPages,o.totalEnabled=e.totalItems,o.totalDisabled=0,m.add({type:"success",message:i.maketext("Successfully enabled [asis,ModSecurity™] on all domains."),id:"enableAllSuccess"})}),(function(t){var i;e.isString(t)?i=t:(n(o.domainList,t.items),o.issues=t.items||[],f(),o.totalEnabled=t.totalEnabled,o.totalDisabled=t.totalDisabled,i=t.error),m.add({type:"danger",message:i,id:"enableAllFailed"})})).then((function(){u.stop("loadingSpinner")}))},o.disableAllDomains=function(t){return t.preventDefault(),u.start("loadingSpinner"),d.disableAllDomains().then((function(e){n(o.domainList,e.items),o.issues=e.items||[],o.totalItems=e.totalItems,o.totalPages=e.totalPages,o.totalDisabled=e.totalItems,o.totalEnabled=0,m.add({type:"success",message:i.maketext("Successfully disabled [asis,ModSecurity™] on all domains."),id:"disableAllSuccess"})}),(function(t){var i;e.isString(t)?i=t:(n(o.domainList,t.items),o.issues=t.items||[],f(),o.totalEnabled=t.totalEnabled,o.totalDisabled=t.totalDisabled,i=t.error),m.add({type:"danger",message:i,id:"disableAllFailed"})})).finally((function(){u.stop("loadingSpinner"),o.openConfirmation=null}))};var f=function(){var e=t.find(o.domainList,(function(e){return!!e.exception}));o.hasIssues=void 0!==e};o.hasIssue=function(e){return!!e.exception};var p=function(){delete o.hasIssues};o.hasDisabledDomains=function(){return o.totalDisabled>0},o.confirm=function(e){o.openConfirmation=e||null};o.activeSearch=!1,o.filteredData=!1,o.totalEnabled=0,o.totalDisabled=0,o.selectedRow=-1,o.alerts=m.getAlerts(),o.hasIssues=!1,o.issues=[],o.openConfirmation=null,o.isInstalled=PAGE.installed,o.hasFeature=PAGE.hasFeature,o.hasFeature&&(o.domainList=[],o.totalPages=0,o.totalItems=0,o.meta={filterBy:s.filterBy||"*",filterCompare:s.filterCompare||"contains",filterValue:s.filterValue||"",pageSize:s.pageSize||10,pageNumber:s.pageNumber||1,sortDirection:s.sortDirection||"asc",sortBy:s.sortBy||"domain",sortType:s.sortType,pageSizes:[10,20,50,100]}),o.$watch("meta.filterValue",(function(e,t){e!==t&&(o.activeSearch=!1)})),o.$watch("meta.pageSize",(function(e,t){e!==t&&o.selectPage(1)})),function(){if(a.firstLoad.domainList&&PAGE.domainList){a.firstLoad.domainList=!1;var e=d.prepareList(PAGE.domainList);o.meta.pageNumber=1,o.domainList=e.items,o.totalItems=e.totalItems,o.totalPages=e.totalPages,o.totalEnabled=PAGE.domainList.meta.modsec.total_enabled,o.totalDisabled=PAGE.domainList.meta.modsec.total_disabled}else o.selectPage(1)}()}])})),define("app/index",["angular","jquery","lodash","cjt/core","cjt/modules","ngRoute","uiBootstrap"],(function(e,t,i,a){return function(){return e.module("App",["ngRoute","ui.bootstrap","cjt2.cpanel"]),require(["cjt/bootstrap","cjt/views/applicationController","app/views/domainListController"],(function(t){var i=e.module("App");i.firstLoad={domainList:!0},i.config(["$routeProvider",function(e){e.when("/domainList/",{controller:"domainListController",templateUrl:a.buildFullPath("security/mod_security/views/domainListView.ptt")}),e.otherwise({redirectTo:"/domainList/"})}]),t("#content","App")}))}}));