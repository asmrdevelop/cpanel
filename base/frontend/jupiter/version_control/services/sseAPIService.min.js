define(["angular","cjt/core","lodash"],(function(e,n,r){"use strict";e.module("cpanel.versionControl.sseAPIService",[]).factory("sseAPIService",["$rootScope",function(e){var r=function(n,r){return function(o){o.eventName=n;var t=o.data;try{t=function(e,n){return e&&e.json&&n&&(n=JSON.parse(n)),n}(r,t)}catch(r){return void function(n,r,o){e.$broadcast("sse:"+n+":error",{data:o,error:r})}(n,r,t)}e.$broadcast("sse:"+n,t)}};return{initialize:function(r){if(window.EventSource)r&&r(),e.$broadcast("sse:ready");else{var o=document.createElement("script");o.src=n.buildFullPath("libraries/eventsource-polyfill/eventsource.js"),o.onload=function(){r&&r(),e.$broadcast("sse:ready")},document.body.appendChild(o)}},connect:function(n,o,t){o||(o=[]);var c=t||{},a=new EventSource(n);return o&&o.forEach((function(e){a.addEventListener(e,r(e,c))})),a.onerror=function(n){e.$broadcast("sse:error",n)},window.addEventListener("beforeunload",(function(n){a&&(a.close(),a=null,e.$broadcast("sse:beforeunload",n))})),a},close:function(e){e&&e.close()}}}])}));