define(["angular","cjt/io/api","cjt/io/uapi-request","cjt/io/uapi"],(function(e,t,r){var a=e.module("App");function i(a){var i={convertResponseToList:function(t){var r=[];if(t.data){for(var a=t.data,i=0,n=a.length;i<n;i++)r.push(a[i]);var u=t.meta||{};return e.isDefined(u.paginate)||(u.paginate={total_records:a.length,total_pages:1}),e.isDefined(u.records_before_filter)||(u.records_before_filter=a.length),{meta:u,data:r}}return{meta:{paginate:{total_records:0,total_pages:0}},data:[]}},listDomains:function(e){var i=a.defer(),n=new r.Class;return n.initialize("SiteTemplates","list_user_settings"),e&&(e.currentPage&&n.addPaging(e.currentPage,e.pageSize||10),e.filterBy&&e.filterCompare&&e.filterValue&&n.addFilter(e.filterBy,e.filterCompare,e.filterValue)),t.promise(n.getRunArguments()).done((function(e){(e=e.parsedResponse).status?i.resolve(e):i.reject(e.error)})),i.promise},publish:function(e,i){var n=a.defer(),u=new r.Class,o=_.map(e.meta.fields,(function(e){if(e.value&&0===e.type.indexOf("date",0)){if("Invalid Date"===e.value.toString())return{id:e.id,value:""};try{return{id:e.id,value:new Date(e.value).toISOString()}}catch(t){return{id:e.id,value:""}}}return _.pick(e,["id","value"])}));u.initialize("SiteTemplates","publish"),u.addArgument("path",e.path),u.addArgument("template",e.template),u.addArgument("docroot",i.documentroot),u.addArgument("domain_url",i.url);for(var l=0,d=o.length;l<d;l++)u.addArgument(o[l].id,o[l].value);return t.promise(u.getRunArguments()).done((function(e){(e=e.parsedResponse).status?n.resolve(e):n.reject(e.error)})),n.promise}};return i}return i.$inject=["$q"],a.factory("publishService",i)}));