!function(){"use strict";var e={"restore-home-file":!0,"restore-db-file":!0,"restore-forwarder-file":!0,"restore-filter-file":!0},r={"restore-db-form":function(e){return e.preventDefault(),d(PAGE.session+"/execute/Backup/restore_databases","db",PAGE.restoringDb),!1},"restore-home-form":function(e){return e.preventDefault(),d(PAGE.session+"/execute/Backup/restore_files","home",PAGE.restoringHome),!1},"restore-forwarder-form":function(e){return e.preventDefault(),d(PAGE.session+"/execute/Backup/restore_email_forwarders","forwarder",PAGE.restoringForwarders),!1},"restore-filter-form":function(e){return e.preventDefault(),d(PAGE.session+"/execute/Backup/restore_email_filters","filter",PAGE.restoringFilters),!1}},t={"restore-home-file":"restore-home-submit-button","restore-db-file":"restore-db-submit-button","restore-forwarder-file":"restore-forwarder-submit-button","restore-filter-file":"restore-filter-submit-button"};function n(e,r,t){var n=document.getElementById("error-template").innerHTML;return Handlebars.compile(n)({id:r,message:e,rest:t})}function o(e,r){void 0===r&&(r="block"),e.style.display=r}function i(e){e.style.display="none"}function s(e,r,t){e.querySelector("#"+r+"-close").addEventListener("click",(function(r){e.innerHTML="",t&&"function"==typeof t&&t()}),!1)}function d(r,t,d){e["restore-"+t+"-file"]=!1;var f=document.getElementById("restore-"+t+"-file"),a=document.getElementById("restore-"+t+"-fields"),u=document.getElementById("restore-"+t+"-submit-button"),l=document.getElementById("restore-"+t+"-message"),c=document.getElementById("restore-"+t+"-spinner");l.innerHTML="",u.disabled=!0,l.innerText=d,i(a),o(c,"inline"),function(e,r){var t=new FormData;return t.append("file1",e.files[0]),fetch(r,{method:"POST",body:t}).then((function(e){return e.json()}))}(f,r).then((function(r){i(c),1==r.status?(l.innerHTML=function(e,r){var t=document.getElementById("success-template").innerHTML;return Handlebars.compile(t)({id:r,message:e})}(r.messages[r.messages.length-1],"success-"+t+"-restore"),s(l,"success-"+t+"-restore"),o(a),f.value=""):(l.innerHTML=n(r.errors.shift(),"failed-"+t+"-restore",r.errors),s(l,"failed-"+t+"-restore"),o(a)),u.disabled=!1,e["restore-"+t+"-file"]=!0})).catch((function(r){i(c),l.innerHTML=n(r,"failed-network-"+t+"-restore"),s(l,"failed-network-"+t+"-restore",(function(){o(a)})),u.disabled=!1,o(a),e["restore-"+t+"-file"]=!0}))}function f(r){return function(t,n){return e[r]}}function a(e){for(var n in t)if(document.getElementById(n)){var o=new CPANEL.validate.validator(PAGE.validationTitle);o.add(n,"min_length(%input%, 1)",PAGE.missingFile,f(n)),o.attach(),CPANEL.validate.attach_to_form(t[n],o)}if(e instanceof Error)alert(e);else for(var i in r)if(r.hasOwnProperty(i)){var s=document.getElementById(i);s&&s.addEventListener("submit",r[i],!1)}}window.Promise&&window.fetch?YAHOO.util.Event.onDOMReady(a):YAHOO.util.Event.onDOMReady((function(){!function(e,r){var t={},n=function(){window.defineHide&&(window.define=window.defineHide,delete window.defineHide)},o=function(o){var i=0,s=!1;for(var d in e)if(e.hasOwnProperty(d)){var f=e[d];!0===t[f]?i++:t[f]instanceof Error&&(s||(s=!0,n(),r(t[f])))}i===e.length&&(s||(s=!0,n(),r()))},i=function(e){return function(){t[e]=!0,o()}},s=function(e){return function(){t[e]=new Error("Failed to load script "+e),o()}};for(var d in window.define&&(window.defineHide=window.define,window.define=null),e)if(e.hasOwnProperty(d)){var f=e[d],a=document.createElement("script");a.src=f,a.onload=i(f),a.onerror=s(f),document.head.appendChild(a)}}(PAGE.polyfills,a)}))}();