define("app/services/backupAPI",["angular","cjt/util/locale","cjt/util/parse","cjt/io/uapi-request","cjt/services/APIService","cjt/io/uapi"],(function(e,t,r,n){"use strict";var a;try{a=e.module("App")}catch(t){a=e.module("App",[])}a.factory("backupAPIService",["APIService",function(a){var o={compressed:t.maketext("Compressed"),uncompressed:t.maketext("Uncompressed"),incremental:t.maketext("Incremental")},i={file:t.maketext("File"),dir:t.maketext("Directory"),symlink:t.maketext("Symlink")};function c(e){var r=e.data,n=[];return r.forEach((function(e){if(e.lastModifiedTime=t.local_datetime(parseInt(e.mtime,10),"datetime_format_short"),!o.hasOwnProperty(e.backupType))throw"DEVELOPER ERROR: Invalid backup type";e.backupType=o[e.backupType],e.type=i[e.type],n.push(e)})),n}function s(e){var t=[];return e.data.forEach((function(e){e.conflict=r.parsePerlBoolean(e.conflict),e.exists=r.parsePerlBoolean(e.exists),t.push(e)})),e.data=t,e}var u=function(){};return u.prototype=new a,e.extend(u.prototype,{listDirectoryContents:function(e,t,r){var a=new n.Class;return a.initialize("Restore","directory_listing"),a.addArgument("path",e),r&&a.addPaging(t,r),this.deferred(a,{transformAPISuccess:s,transformAPIFailure:function(e){return e.error}}).promise},listBackups:function(e,t){var r=new n.Class;return r.initialize("Restore","query_file_info"),r.addArgument("path",e),r.addArgument("exists",t),this.deferred(r,{transformAPISuccess:c,transformAPIFailure:function(e){return e.error}}).promise},restoreBackup:function(e,t){var r=new n.Class;return r.initialize("Restore","restore_file"),r.addArgument("backupID",t),r.addArgument("path",e),r.addArgument("overwrite",1),this.deferred(r,{transformAPISuccess:function(e){return e.data},transformAPIFailure:function(e){return e.error}}).promise}}),new u}])})),define("app/filters/fileSizeFilter",["angular","cjt/util/locale"],(function(e,t){"use strict";var r;try{r=e.module("App")}catch(t){r=e.module("App",[])}r.filter("convertedSize",(function(){return function(e){return t.format_bytes(e)}}))})),define("app/views/list",["angular","lodash","cjt/util/table","cjt/util/locale","cjt/util/parse","cjt/decorators/paginationDecorator","cjt/directives/actionButtonDirective","cjt/validator/datatype-validators","app/filters/fileSizeFilter","app/services/backupAPI","cjt/services/alertService","cjt/directives/alert","cjt/directives/alertList","cjt/services/cpanel/componentSettingSaverService"],(function(e,t,r,n,a){"use strict";var o=e.module("App");return o.value("PAGE",PAGE),o.controller("listController",["$scope","$anchorScroll","PAGE","backupAPIService","alertService","componentSettingSaverService",function(e,o,i,c,s,u){var p=new r;p.setSort("name","asc");var l=new r;function d(t,r,n){p.items=[],p.filteredList=[],p.last_id=0,c.listDirectoryContents(t,r,n).then((function(t){!function(t,r){p.load(t),function(t){var r=[],n=1;for(;n<=t.total_pages;)n.toString(),r.push(n),parseInt(n,10),n++;e.goToPages=r}(r),function(t){e.directoryContentsMeta.pageNumber=1,p.update(),e.directoryContentsMeta.maxPages=parseInt(t.total_pages,10),e.directoryContentsMeta.totalItems=parseInt(t.total_records,10),e.directoryContentsMeta.start=parseInt(t.current_record,10),e.directoryContentsMeta.pageNumber=t.current_page,e.directoryContentsMeta.start+e.directoryContentsMeta.pageSize>e.directoryContentsMeta.totalItems?e.directoryContentsMeta.limit=e.directoryContentsMeta.totalItems:e.directoryContentsMeta.limit=e.directoryContentsMeta.start+e.directoryContentsMeta.pageSize-1;e.directoryContents=p.getList(),e.directoryContentsPaginationMessage=p.paginationMessage()}(r)}(function(t){var r=[];return t.forEach((function(t){t.backupPath&&t.parentDir||("/"===e.currentDirectory?(t.backupPath="/"+t.name,t.parentDir="/"):(t.backupPath=e.currentDirectory+t.name,t.parentDir=e.currentDirectory)),r.push(t)})),e.parentDirectory=e.currentDirectory,r}(t.data),t.meta.paginate)})).catch((function(t){e.noMetadataMessage=t})).finally((function(){e.actions.loadingUI=!1,e.actions.loadingData=!1,0===e.directoryContents.length?e.emptyDirectory=!0:e.emptyDirectory=!1}))}function f(t){var r=t.split("/");e.breadCrumb=r.slice(1,r.length-1)}function g(t,r,n){return e.clearBackupList(),c.listBackups(t,r).then((function(t){r&&(e.doesContentExist=a.parsePerlBoolean(t[0].exists)),o("viewContent"),e.isContentTypeDirectory="Directory"===t[0].type,e.isBackupSelected=!0,l.load(t),l.update(),e.backupsMeta=l.getMetadata(),e.backupList=l.getList(),e.backupsPaginationMessage=l.paginationMessage()})).catch((function(t){e.getBackupsError=t})).finally((function(){r||(e.doesContentExist=n),e.selectedContent=t,e.actions.loadingBackups=!1}))}function y(t){u.get(t).then((function(r){r?(e.directoryContentsMeta.pageSize=r.pageSize,d(e.currentDirectory,e.directoryContentsMeta.pageNumber,e.directoryContentsMeta.pageSize)):function(e){u.register(e).then((function(t){m(e)})).catch((function(e){s.add({type:"danger",message:e,group:"backup-restoration",closeable:!0})}))}(t)})).catch((function(e){s.add({type:"danger",message:e,group:"backup-restoration",closeable:!0})}))}function m(t){u.set(t,{pageSize:e.directoryContentsMeta.pageSize}).then((function(t){d(e.currentDirectory,e.directoryContentsMeta.pageNumber,e.directoryContentsMeta.pageSize)})).catch((function(e){s.add({type:"danger",message:e,group:"backup-restortion",closeable:!0})}))}l.setSort("backupDate,backupType,lastModifiedTime,fileSize","desc"),e.setDirectoryContentsPage=function(t){e.clearBackupList(),e.actions.loadingData=!0,t?m("pagination"):d(e.currentDirectory,e.directoryContentsMeta.pageNumber,e.directoryContentsMeta.pageSize)},e.navigateBreadcrumb=function(t){e.clearBackupList(),e.actions.loadingData=!0;for(var r="/",n=0,a=e.breadCrumb.length;n<a;n++){if(t===e.breadCrumb[n]){r=r+e.breadCrumb[n]+"/";break}r=r+e.breadCrumb[n]+"/"}e.currentDirectory=r;d(e.currentDirectory,1,e.directoryContentsMeta.pageSize),f(e.currentDirectory)},e.goToDirectory=function(t){e.actions.loadingData=!0,"/"===t&&(e.breadcrumb=""),e.clearBackupList(),e.currentDirectory!==t&&(e.directoryContentsMeta.pageNumber=1),e.currentDirectory=t;var r=e.currentDirectory.length;"/"!==e.currentDirectory.charAt(r-1)&&(e.currentDirectory=e.currentDirectory+"/"),d(e.currentDirectory,e.directoryContentsMeta.pageNumber,e.directoryContentsMeta.pageSize),f(e.currentDirectory)},e.toggleSelectedBackup=function(t){t===e.backupSelected?e.backupSelected="":e.backupSelected=t},e.listBackups=function(t){return e.actions.loadingBackups=!0,g(t.backupPath,0,t.exists)},e.toggleRestoreConfirmation=function(t){t?(e.confirmSelected=t.backupDate,e.isConfirmingRestoration=!0):(e.confirmSelected="",e.isConfirmingRestoration=!1)},e.restoreSelectedBackup=function(r){return function(r){return e.actions.restoring=!0,c.restoreBackup(r.path,r.backupID).then((function(a){s.add({type:"success",message:n.maketext("The system successfully restored the “[_1]” backup file from the date “[_2]”.",t.escape(r.path),t.escape(r.backupDate)),autoClose:1e4,group:"backup-restoration"}),e.clearBackupList(),e.goToDirectory(e.currentDirectory)})).catch((function(e){s.add({type:"danger",message:e,closeable:!0,group:"backup-restoration"})})).finally((function(){e.actions.restoring=!1,e.toggleRestoreConfirmation()}))}(r)},e.goToParentDirectory=function(){e.actions.loadingData=!0,e.currentDirectory=function(){for(var t="/",r=0,n=e.breadCrumb.length-1;r<n;r++)t=t+e.breadCrumb[r]+"/";return t}();d(e.currentDirectory,1,e.directoryContentsMeta.pageSize),f(e.currentDirectory)},e.findByPathInput=function(t){return t=function(e){0!==e.indexOf("/")&&(e="/"+e);return e}(t),e.getBackupsError="",e.selectedContent=t,g(t,1)},e.goToPage=function(t,r){var n=function(t){return!(t*e.directoryContentsMeta.page_size>e.directoryContentsMeta.total_records)}(t);null===t||isNaN(t)||(n?d(r,t,e.directoryContentsMeta.pageSize):e.pageDoesNotExist=!0)},e.sortDirectoryContentsTable=function(){var t=e.directoryContentsMeta.totalItems;if(e.directoryContentsMeta.pageNumber>=2){var r=e.directoryContentsMeta.pageNumber;p.meta.pageNumber=1,p.update(),p.meta.pageNumber=r}else p.update();e.directoryContentsMeta.totalItems=t,e.directoryContents=p.getList()},e.sortBackupsTable=function(){l.update(),e.backupList=l.getList(),e.backupsPaginationMessage=l.paginationMessage()},e.clearBackupList=function(){e.isConfirmingRestoration=!1,e.getBackupsError="",e.isBackupSelected=!1,e.selectedContent=""},e.checkForEmptyInput=function(t){e.isPathInputEmpty=""===t},e.getBackupsPanelClass=function(e){var t="panel panel-default";return e&&(t+=" restorationPanel"),t},e.getDirContentsPanelClass=function(e){var t="panel panel-default";return e&&(t+=" restorationPanel"),t},e.scrollToBackupList=function(){o("viewContent")},e.userHomeDirDisplay=i.homeDir+"/",e.navigateMethod="input",e.dirContentsPanelOpen=!0,e.backupsPanelOpen=!0,e.currentDirectory="/",e.homeDir="/",e.noMetadataMessage="",e.isPathInputEmpty=!0,e.directoryContentsMeta=p.getMetadata(),e.backupsMeta=l.getMetadata(),e.doesContentExistInfo=n.maketext("When you restore a backup, the system will overwrite existing files and restore deleted files."),e.findByPathInfo=n.maketext("Enter the exact path to the file or directory that you wish to restore."),e.actions={loadingUI:!0,loadingData:!1,loadingBackups:!1},y("pagination")}])})),define("app/index",["angular","cjt/core","cjt/modules","uiBootstrap","ngRoute"],(function(e,t){"use strict";return function(){return e.module("App",["ui.bootstrap","cjt2.cpanel"]),require(["cjt/bootstrap","cjt/views/applicationController","app/services/backupAPI","app/filters/fileSizeFilter","app/views/list"],(function(r){e.module("App").config(["$routeProvider",function(e){e.when("/list/",{controller:"listController",templateUrl:t.buildFullPath("file_and_directory_restoration/views/list.ptt")}),e.otherwise({redirectTo:"/list/"})}]),r()}))}}));