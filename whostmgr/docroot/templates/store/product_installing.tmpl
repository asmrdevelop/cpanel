<div id="whats-happening">
    <script>
        var skip_redirect = [% data.skip_redirect ? "true" : "false" %];

        function redirect(delay) {
            setTimeout(function() {
                window.location.replace([% data.redirect.json() %]);
            }, delay * 1000);
        }

        function showInstalled(additional) {
            document.getElementById("installing").style.display = "none";
            document.getElementById("installed").style.display = "block";
            if (additional && additional.length > 0) {
                document.getElementById("additional-detail").style.display = "block";
                document.getElementById("additional-detail-text").innerHTML = additional;
            }
            else if ( !skip_redirect ) {
                document.getElementById("redirect-note").style.display = "block";
                redirect(5);
            }
        }

        function showNotInstalled(error) {
            document.getElementById("installing").style.display = "none";
            var element = document.getElementById("not-installed");
            var errorDetail = document.getElementById("error-detail-text");
            if (error) {
                var div = document.createElement("div");
                var text = document.createTextNode("The following error was returned: " + error);
                div.appendChild(text);
                errorDetail.appendChild(div);
            }
            element.style.display = "block";
        }

        function showSuccessAddendum() {
            document.getElementById("positionedSuccessAddendum").innerHTML = document.getElementById("addendum").innerHTML;
            document.getElementById("addendum").style.display = "none";
        }

        function showFailureAddendum() {
            document.getElementById("positionedFailureAddendum").innerHTML = document.getElementById("addendum").innerHTML;
            document.getElementById("addendum").style.display = "none";
        }
    </script>
    <div id="installing" class="callout callout-info">
        <div class="callout-heading">
            <i class="fas fa-sync fa-spin text-info" aria-hidden="true"></i>
            [% locale.maketext('Installation in Progress') %]
        </div>
        [% IF data.install_duration_warning %]
          [% locale.maketext('“[_1]” is installing. The installation may take up to [_2] minutes.', data.product_name, data.install_duration_warning) %]
        [% ELSE %]
          [% locale.maketext('“[_1]” is installing. The installation may take a few minutes.', data.product_name) %]
        [% END %]
        [% IF data.background_install %]
          [% locale.maketext('You can navigate away from this interface and the installation will continue.') %]
        [% ELSE %]
          [% locale.maketext('The system will redirect you when the installation is complete.') %]
        [% END %]
    </div>
    <div id="installed" style="display:none" class="callout callout-success finished">
        <div class="callout-heading">
            <i class="fas fa-check text-success" aria-hidden="true"></i>
            [% locale.maketext('Success') %]
        </div>
        [% locale.maketext('“[_1]” is installed.', data.product_name) %]
        <span id="redirect-note" style="display:none">
            <br>
            [% locale.maketext('The system will redirect you.') %]
        </span>

        <span id="positionedSuccessAddendum">&nbsp;</span>

        <span id="additional-detail" style="display:none">
            <br>
            [% locale.maketext('Additional detail:') %] <span id="additional-detail-text">&nbsp;</span>
            <br><br>
        </span>

        <div>
            <a id="success-return-to-origin" href="[% data.redirect %]">[% locale.maketext('Go back')%]</a>
        </div>
    </div>
    <div id="not-installed" style="display:none" class="callout callout-danger finished">
        <div class="callout-heading">
            <i class="fas fa-times text-danger" aria-hidden="true"></i>
            [% locale.maketext('Error') %]
        </div>
        [% locale.maketext('You have a license for “[_1]”, but the “[_1]” installation failed.', data.product_name) %]
        [% locale.maketext('For more details, review the following error log: [_1]', data.log_path) %]
        <br>
        <span id="error-detail-text">&nbsp;</span>
        <br>
        <span id="positionedFailureAddendum">&nbsp;</span>

        <div>
            <a id="error-return-to-origin" href="[% data.redirect %]">[% locale.maketext('Go back')%]</a>
        </div>
    </div>
</div>
