define("app/services/parser",["punycode","cjt/util/locale","cjt/validator/domain-validators","cjt/validator/validator-utils"],(function(e,i,a,t){"use strict";var n=a.methods.wildcardFqdnAllowTld;function o(e){return!!e.length}return{parseDomainsFromText:function(a){var r=a.trim().split(/\s*\n\s*/).filter(o),c=[],s={};if(r.forEach((function(a,o){var l=n(a);if(l.isValid){var d=e.toUnicode(a);if(s[d]){if(1===s[d]){var u=t.initializeValidationResult();u.addError("duplicate",i.maketext("You may not enter any domain more than once.")),c.push([d,u])}s[d]++}else s[d]=1;r[o]=d}else c.push([a,l])})),c.length)throw c;return r}}})),define("app/services/manageService",["lodash","angular","punycode","cjt/util/locale","cjt/io/batch-request","cjt/io/whm-v1-request","cjt/services/APICatcher","cjt/services/alertService","cjt/io/whm-v1"],(function(e,i,a,t,n,o){"use strict";var r=i.module("whm.mailBlockedDomains.Service",["cjt2.services.apicatcher","cjt2.services.api"]);function c(i,r){var c;function s(e){c=e.map(a.toUnicode).sort()}return{setSavedDomains:s,getSavedDomains:function(){return c.slice()},saveBlockedDomains:function(l){l=l.map(a.toASCII);var d=c.map(a.toASCII),u=[],m=e.difference(l,d);m.length&&u.push((new o.Class).initialize("","block_incoming_email_from_domain",{domain:m}));var v=e.difference(d,l);v.length&&u.push((new o.Class).initialize("","unblock_incoming_email_from_domain",{domain:v})),u.push((new o.Class).initialize("","list_blocked_incoming_email_domains"));var p=new n.Class(u);return r.add({type:"info",message:t.maketext("Submitting updates â€¦"),replace:!0}),i.promise(p).then((function(e){var i=e.data[e.data.length-1].data;s(i=i.map((function(e){return a.toUnicode(e.domain)}))),r.success(t.maketext("Success!"))}))}}}return c.$inject=["APICatcher","alertService"],r.factory("manageService",c)})),define("app/validators/domainList",["lodash","angular","cjt/validator/validator-utils","app/services/parser","cjt/validator/validateDirectiveFactory"],(function(e,i,a,t){"use strict";var n={domainList:function(i){var n=a.initializeValidationResult();try{t.parseDomainsFromText(i)}catch(i){var o,r=i.map((function(i){return"<span class='code'>"+e.escape(i[0])+"</span>: "+e.escape(i[1])}));1===r.length?o=r[0]:(o="<ul><li>",o+=r.join("</li><li>"),o+="</li></ul>"),n.addError("domainList",o)}return n}};return i.module("cjt2.validate").run(["validatorFactory",function(e){e.generate(n)}]),{methods:n,name:"domain-list",description:"Validate a list of domains, allowing wildcard.",version:1}})),define("app/index",["lodash","angular","punycode","cjt/util/locale","app/services/parser","cjt/core","cjt/util/parse","cjt/modules","uiBootstrap","cjt/directives/validationContainerDirective"],(function(e,i,a,t,n){"use strict";var o=window.PAGE;return function(){return i.module("whm.mailBlockedDomains",["cjt2.config.whm.configProvider","ui.bootstrap","cjt2.whm","cjt2.services.alert","whm.mailBlockedDomains.Service"]),require(["cjt/bootstrap","uiBootstrap","app/services/manageService","app/validators/domainList"],(function(t){i.module("whm.mailBlockedDomains").controller("BaseController",["$rootScope","$scope","manageService",function(i,t,r){r.setSavedDomains(o.initial_blocked_domains);var c={viewPunycodeYN:o.initial_view_punycode};function s(){return n.parseDomainsFromText(c.domainsText)}function l(e){c.domainsText=e.join("\n")}function d(){var e=r.getSavedDomains();c.viewPunycodeYN&&(e=e.map(a.toASCII)),l(e)}d(),e.assign(t,{updateViewPunycode:function(){var e=s(),i=a[c.viewPunycodeYN?"toASCII":"toUnicode"];l(e.map(i))},domainsAreChanged:function(){var i=s(),a=r.getSavedDomains();return!!e.xor(i,a).length},submit:function(){var e=n.parseDomainsFromText(c.domainsText);return t.inProgress=!0,r.saveBlockedDomains(e).then(d).finally((function(){t.inProgress=!1}))},state:c})}]),t(document,"whm.mailBlockedDomains")}))}}));