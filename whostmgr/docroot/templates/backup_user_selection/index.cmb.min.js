define("app/services/backupUserSelectionService",["angular","cjt/util/locale","cjt/util/parse","cjt/io/whm-v1-request","cjt/io/whm-v1","cjt/services/APIService"],(function(e,t,a,n){"use strict";var c=e.module("whm.backupUserSelection.backupUserSelectionService.service",[]);c.value("PAGE",PAGE),c.factory("backupUserSelectionService",["$q","APIService","PAGE",function(t,c,i){function r(e){var t,n=e,c=e.data,i=[];return e.data&&c.forEach((function(e){(t={}).user=e.user,t.domain=e.domain,t.uid=e.uid,t.legacy_backup=a.parsePerlBoolean(e.legacy_backup),t.backup=a.parsePerlBoolean(e.backup),i.push(t)})),n.data=i,n}var o=function(){};return o.prototype=new c,e.extend(o.prototype,{getUserAccounts:function(){var e=new n.Class;return e.initialize("","listaccts"),e.addArgument("want","user,domain,uid,backup,legacy_backup"),this.deferred(e,{transformAPISuccess:r}).promise},toggleAccount:function(e,t){var c=new n.Class;return c.initialize("","toggle_user_backup_state"),c.addArgument("user",e),c.addArgument("legacy",t?1:0),this.deferred(c,{transformAPISuccess:function(e){return a.parsePerlBoolean(e.data.toggle_status)}}).promise}}),new o}])})),define("app/services/NVData",["angular","lodash","cjt/io/api","cjt/io/whm-v1-request","cjt/io/whm-v1"],(function(e,t,a,n,c){"use strict";return e.module("whm.backupUserSelection").factory("NVData",["$q",function(e){var t={get:function(t){var c=e.defer(),i=new n.Class;return i.initialize("","nvget"),i.addArgument("key",t),a.promise(i.getRunArguments()).done((function(e){if((e=e.parsedResponse).status){var t=e.data.nvdatum,a={};a.key=t.key,Array.isArray(t.value)&&1===t.value.length?a.value=t.value[0]:a.value=t.value,c.resolve(a)}else c.reject(e.error)})),c.promise},set:function(t,c){var i=e.defer(),r=new n.Class;return r.initialize("","nvset"),r.addArgument("key1",t),r.addArgument("value1",c),a.promise(r.getRunArguments()).done((function(e){if((e=e.parsedResponse).status){var t,a={};t=void 0!==e.data.nvdatum?e.data.nvdatum:e.data,Array.isArray(t)&&t.length>0&&(a.key=t[0].key,a.value=t[0].value),a.status=e.status,i.resolve(a)}else i.reject(e.error)})),i.promise}};return t}])})),define("app/views/backupUserSelectionView",["angular","lodash","cjt/util/locale","cjt/util/table","cjt/util/parse","uiBootstrap","cjt/decorators/paginationDecorator","cjt/directives/toggleSortDirective","cjt/directives/alert","cjt/directives/loadingPanel","cjt/services/alertService","app/services/NVData","app/services/backupUserSelectionService"],(function(e,t,a,n,c){"use strict";return e.module("whm.backupUserSelection").controller("backupUserSelectionView",["$q","$scope","backupUserSelectionService","NVData","PAGE","alertService",function(t,a,i,r,o,u){var s=new n;s.setSearchFunction((function(e,t){return t=t.toLowerCase(),-1!==e.user.toLowerCase().indexOf(t)||-1!==e.domain.toLowerCase().indexOf(t)})),a.getUserAccounts=function(){a.action.loading=!0,i.getUserAccounts().then((function(e){a.accountData=e.data,a.getInitialPageSize(a.accountData)}),(function(e){u.add({type:"danger",message:e,group:"backupUserSelection",closeable:!0})})).finally((function(){a.action.loading=!1}))},a.toggleAccount=function(e,t){a.action.toggling=!0,i.toggleAccount(e.user,t).then((function(a){t?e.legacy_backup=a:e.backup=a}),(function(e){u.add({type:"danger",message:e,group:"backupUserSelection",closeable:!0})})).finally((function(){a.action.toggling=!1}))},a.setPagination=function(e,t){s.load(e),s.setSort("user","asc"),a.meta=s.getMetadata(),a.meta.pageSize=t,a.setTable()},a.setTable=function(){s.update(),a.meta=s.getMetadata(),a.filteredAccountList=s.getList(),a.paginationMessage=s.paginationMessage(),a.action.toggling=!1,a.showPager=!0},a.getInitialPageSize=function(e){r.get("accounts_page_size").then((function(t){t=parseInt(t.value,10)||10,a.setPagination(e,t)}))},a.setPageSize=function(){a.setTable(),r.set("accounts_page_size",a.meta.pageSize)},a.getInitialPageSize=function(e){r.get("accounts_page_size").then((function(t){t=parseInt(t.value,10)||10,a.setPagination(e,t)}))},a.setPageSize=function(){a.setTable(),r.set("accounts_page_size",a.meta.pageSize)},a.enableAllAccounts=function(n){var c=[];return a.action.toggling=!0,e.forEach(a.accountData,(function(e){(!e.backup&&!n||!e.legacy_backup&&n)&&c.push(i.toggleAccount(e.user,n).then((function(t){n?e.legacy_backup=t:e.backup=t}),(function(e){u.add({type:"danger",message:e,group:"backupUserSelection",closeable:!0})})))})),t.all(c).finally((function(){a.action.toggling=!1}))},a.disableAllAccounts=function(n){var c=[];return a.action.toggling=!0,e.forEach(a.accountData,(function(e){(e.backup&&!n||e.legacy_backup&&n)&&c.push(i.toggleAccount(e.user,n).then((function(t){n?e.legacy_backup=t:e.backup=t}),(function(e){u.add({type:"danger",message:e,group:"backupUserSelection",closeable:!0})})))})),t.all(c).finally((function(){a.action.toggling=!1}))},a.init=function(){a.action={loading:!1,toggling:!1,settingPage:!1},a.meta={},a.getUserAccounts(),a.legacyBackupEnabled=c.parsePerlBoolean(o.legacyBackupEnabled)},a.init()}])})),define("app/index",["angular","cjt/core","cjt/modules","ngRoute","app/services/backupUserSelectionService","cjt/services/alertService","cjt/directives/alert","cjt/directives/alertList","cjt/directives/callout"],(function(e,t){"use strict";return function(){return e.module("whm.backupUserSelection",["cjt2.config.whm.configProvider","ngRoute","angular-growl","cjt2.whm","whm.backupUserSelection.backupUserSelectionService.service"]),require(["cjt/bootstrap","app/views/backupUserSelectionView"],(function(t){var a=e.module("whm.backupUserSelection");a.value("PAGE",PAGE),a.config(["$routeProvider",function(e){e.when("/backupUserSelectionView",{controller:"backupUserSelectionView",templateUrl:"views/backupUserSelectionView.ptt"}),e.otherwise({redirectTo:"/backupUserSelectionView"})}]);var n=e.element("#pageContainer");null!==n[0]&&t(n[0],"whm.backupUserSelection")}))}}));