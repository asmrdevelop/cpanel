define("app/services/configService",["angular","lodash","cjt/util/locale","cjt/io/whm-v1-request","cjt/util/parse","cjt/io/api","cjt/io/whm-v1","cjt/services/APIService"],(function(e,t,n,o,c){"use strict";e.module("whm.tomcat.configService",[]).factory("TomcatApi",["$q","APIService",function(n,c){var i=function(){};i.prototype=new c;var r={};return e.extend(i.prototype,{getUsers:function(e){if(e||function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(r)){var t=new o.Class;return t.initialize("","list_users"),this.deferred(t).promise.then((function(e){return r=e.data})).catch((function(e){return n.reject(e)}))}return n.when(r)},getTomcatList:function(){var e=new o.Class;return e.initialize("","ea4_tomcat85_list"),this.deferred(e).promise.then((function(e){return r=e.data})).catch((function(e){return n.reject(e)}))},enableDisableTomcat:function(e,c){var i=new o.Class;return c?i.initialize("","ea4_tomcat85_add"):i.initialize("","ea4_tomcat85_rem"),t.each(e,(function(e,t){i.addArgument("user-"+t,e)})),this.deferred(i).promise.then((function(e){return e.data})).catch((function(e){return n.reject(e)}))}}),new i}])})),define("app/views/config",["angular","lodash","cjt/util/locale","cjt/util/table","uiBootstrap","cjt/filters/qaSafeIDFilter","cjt/decorators/growlDecorator","cjt/decorators/paginationDecorator","cjt/directives/actionButtonDirective","cjt/directives/searchDirective","cjt/directives/pageSizeDirective","cjt/directives/alertList","cjt/services/alertService","cjt/directives/toggleSortDirective","cjt/services/viewNavigationApi","cjt/directives/autoFocus"],(function(e,t,n,o){"use strict";return e.module("whm.tomcat").controller("config",["$scope","$q","TomcatApi","alertService","$uibModal",function(e,c,i,r,a){var l="Tomcat 8.5",s=n.maketext("Your server may run out of memory if you enable “[_1]” for multiple users.",l);e.config=this,e.config.loading=!1,e.config.showFormToggleBtn=!0,e.config.tokenAdded=!1,e.config.loadingError=!1,e.config.loadingErrorMessage="",e.config.allChecked=!1,e.config.checkedCount=0,e.config.paginationMessage="";var u=new o;function f(){return e.config.loading=!0,c.all([i.getUsers(!0),i.getTomcatList()]).then((function(n){var o=[],c=n[0],i=n[1];null!=c&&(o=t.map(t.pull(c,"root"),(function(e){return{user:e,tomcatEnabled:t.includes(i,e),showAlert:!1,alertMsg:""}})),u.load(o),e.config.allUsers=o,e.config.render())})).catch((function(t){e.config.loadingError=!0,e.config.loadingErrorMessage=t})).finally((function(){e.config.loading=!1}))}function g(o,c){var a=this;a.showActions=!0,a.cancel=function(){o.dismiss("cancel")};var u=t.map(t.filter(c.userList,["tomcatEnabled",!c.enable]),"user"),f=n.maketext("If you disable “[_1]”, any URLs that “[_1]” handles will no longer work as expected.",l);t.isEmpty(u)?(a.showActions=!1,c.enable?a.prompt=n.maketext("“[_1]” is already enabled for the selected [numerate,_2,user,users]. Select other users to enable.",l,u.length):a.prompt=n.maketext("“[_1]” is already disabled for the selected [numerate,_2,user,users]. Select other users to disable.",l,u.length)):u.length>0&&u.length===e.config.allUsers.length?c.enable?a.prompt=s+" "+n.maketext("Are you certain that you want to enable “[_1]” for all of your users?",l):a.prompt=f:u.length>0&&(c.enable?a.prompt=s+" "+n.maketext("Are you certain that you want to enable “[_1]” for the selected [numerate,_2,user,users]?",l,u.length):a.prompt=f),a.confirm=function(){return i.enableDisableTomcat(u,c.enable).then((function(o){if(o){var i=[];t.each(t.keys(o),(function(e){t.isEmpty(o[e])&&i.push(e)}));var a=t.omit(o,i),s=t.keys(a);if(s.length>0&&t.each(s,(function(e){r.add({type:"danger",message:t.escape(a[e]),replace:!1})})),0!==i.length){var f="";f=i.length===e.config.allUsers.length?c.enable?n.maketext("You successfully enabled “[_1]” for all of your users.",l):n.maketext("You successfully disabled “[_1]” for all of your users.",l):Array.isArray(c.userList)&&i.length===c.userList.length?c.enable?n.maketext("You successfully enabled “[_1]” for the selected [numerate,_2,user,users].",l,u.length):n.maketext("You successfully disabled “[_1]” for the selected [numerate,_2,user,users].",l,u.length):c.enable?n.maketext("You successfully enabled “[_1]” for “[_2]” of “[_3]” [numerate,_3,user,users].",l,i.length,u.length):n.maketext("You successfully disabled “[_1]” for “[_2]” of “[_3]” [numerate,_3,user,users].",l,i.length,u.length),r.add({type:"success",message:t.escape(f),autoclose:1e3,replace:!1})}e.config.refreshList()}})).catch((function(e){r.add({type:"danger",message:t.escape(e),replace:!1})})).finally((function(){o.close()}))}}u.setSearchFunction((function(e,t){return-1!==e.user.toLowerCase().indexOf(t.toLowerCase())||-1!==e.user.toLowerCase().indexOf(t.toLowerCase())})),u.setSort("user","asc"),e.config.meta=u.getMetadata(),e.config.filteredList=u.getList(),e.config.allUsers=[],e.config.render=function(){e.config.resetCheckAll(),e.config.filteredList=u.update(),e.config.paginationMessage=u.paginationMessage()},e.config.sortList=function(){e.config.render()},e.config.selectPage=function(){e.config.render()},e.config.selectPageSize=function(){e.config.render()},e.config.searchList=function(){e.config.render()},e.config.toggleLabel=function(e){return e.tomcatEnabled?n.maketext("Enabled"):n.maketext("Disabled")},e.config.resetCheckAll=function(){e.config.allChecked=!1,e.config.toggleCheckAll(),e.config.checkedCount=0},e.config.getIndeterminateState=function(){return e.config.checkedCount>0&&!e.config.allChecked},e.config.toggleCheckAll=function(){if(0!==e.config.filteredList.length){for(var t=0,n=e.config.filteredList.length;t<n;t++)e.config.filteredList[t].checked=e.config.allChecked;e.config.allChecked?e.config.checkedCount=n:e.config.checkedCount=0}},e.config.syncCheckAll=function(t){t.checked?e.config.checkedCount++:e.config.checkedCount--,e.config.allChecked=e.config.checkedCount===e.config.filteredList.length},e.config.checkAll=function(){e.config.allChecked=!0,e.config.toggleCheckAll()},e.config.refreshList=function(){return e.config.filteredList=[],e.config.allTokens=[],f()},e.config.toggleLabel=function(e){return e.tomcatEnabled?n.maketext("Enabled"):n.maketext("Disabled")},e.config.toggleTitle=function(e){return e.tomcatEnabled?n.maketext("Disable [asis,Tomcat] support."):n.maketext("Enable [asis,Tomcat] support.")},e.config.toggleTomcatStatus=function(o){return r.clear(),i.enableDisableTomcat([o.user],!o.tomcatEnabled).then((function(e){if(t.isEmpty(e[o.user])){o.tomcatEnabled=!o.tomcatEnabled;var c=o.tomcatEnabled?n.maketext("“[_1]” support is enabled for “[_2]”.",l,o.user):n.maketext("“[_1]” support is disabled for “[_2]”.",l,o.user);r.add({type:"success",message:t.escape(c),autoclose:1e3,id:"alertSuccess",replace:!0})}else r.add({type:"danger",message:t.escape(e[o.user]),id:"alertError",replace:!0})})).catch((function(e){r.add({type:"danger",message:t.escape(e),id:"alertError",replace:!0})})).finally((function(){e.config.resetToggleSingle(o)}))},e.config.confirmToggleSingle=function(e){e.showAlert=!0,e.tomcatEnabled?(e.elId="confirmToggle_continue_disable_"+e.user,e.alertActionTitle=n.maketext("Continue to disable."),e.alertActionText=n.maketext("Disable"),e.alertMsg=n.maketext("If you disable “[_1]”, any URLs that “[_1]” handles will no longer work as expected.",l)):(e.elId="confirmToggle_continue_enable_"+e.user,e.alertActionTitle=n.maketext("Continue to enable."),e.alertActionText=n.maketext("Enable"),e.alertMsg=s)},e.config.resetToggleSingle=function(e){e.showAlert=!1,e.alertMsg=""},e.config.confirmToggleMultiple=function(e,t){a.open({templateUrl:"confirm_enable_disable.tmpl",controller:g,controllerAs:"promptCtrl",resolve:{data:function(){return{userList:e,enable:t}}}})},e.config.getSelectedUsers=function(){return t.filter(e.config.filteredList,["checked",!0])},g.$inject=["$uibModalInstance","data"],e.$on("$viewContentLoaded",(function(){f()}))}])})),define("app/index",["angular","jquery","lodash","cjt/core","cjt/modules","ngRoute","uiBootstrap","app/services/configService"],(function(e,t,n,o){"use strict";return function(){return e.module("whm.tomcat",["cjt2.config.whm.configProvider","ngRoute","ui.bootstrap","angular-growl","cjt2.whm","whm.tomcat.configService"]),require(["cjt/bootstrap","app/views/config"],(function(t){e.module("whm.tomcat").config(["$routeProvider",function(e){e.when("/config",{controller:"config",templateUrl:o.buildFullPath("tomcat/views/config.ptt"),reloadOnSearch:!1}).otherwise({redirectTo:"/config"})}]),t(document,"whm.tomcat")}))}}));