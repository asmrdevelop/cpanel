define("app/services/createPluginService",["angular","cjt/util/locale","cjt/util/parse","cjt/io/api","cjt/io/whm-v1-request","cjt/io/whm-v1","cjt/services/APIService"],(function(e,t,i,r,n,o){return e.module("App").factory("createPluginService",["$q","APIService",function(e,t){var i=function(){};return i.prototype={generatePluginFile:function(t){if(void 0!==t&&""!==t.name){var i=new n.Class,o=e.defer();return i.initialize("","generate_cpanel_plugin"),i.addArgument("plugin_name",t.name),i.addArgument("install.json",t.installListJson),i.addArgument("icons.json",t.iconListJson),r.promise(i.getRunArguments()).done((function(e){(e=e.parsedResponse).status?o.resolve(e.data):o.reject(e.error)})),o.promise}}},new i}])})),define("app/views/createPluginController",["angular","lodash","cjt/util/locale","app/services/createPluginService","cjt/services/alertService","cjt/directives/alertList","cjt/validator/datatype-validators","cjt/directives/validationContainerDirective","cjt/directives/validationItemDirective"],(function(e,t,i){"use strict";e.module("App").controller("createPluginController",["$scope","$anchorScroll","alertService","createPluginService","PAGE",function(t,r,n,o,a){var u={id:"",name:"",description:"",group_id:"",order:"",uri:"index.html",overwrite:!1,featuremanager:!1,target:""},l=!1,c="",d="";t.itemList=[],t.item=e.copy(u);var s=[],m={};t.groups=a.groups;var p=a.itemIds;function f(){if(t.addItemForm.$dirty){t.addItemForm.$setPristine(),t.item=e.copy(u),t.showNewGroup=l,t.newGroup=c,t.itemIcon=d,t.showOverwrite=!1,t.focusOnId=!0;var i=document.getElementById("fileIcon");void 0!==i&&(i.value=d)}}t.item.uri=u.uri,t.addItemToPlugin=function(){var e;if(!t.addItemForm.$invalid&&void 0!==t.item){if(t.item.type="link",void 0!==t.newGroup&&""!==t.newGroup){var i=t.newGroup.toLowerCase().split(" ").join("_"),r={id:i,name:t.newGroup};t.groups.push(r),t.item.group_id=i;var n={name:t.newGroup,type:"group",order:99,id:i};s.push(n)}(e=new FileReader).onloadend=function(){var i,r,n,o;t.addItemProcessing=!1,t.$apply((i=e.result,r=t.itemIcon.name,n=r.substr(r.lastIndexOf(".")),o=t.item.icon=t.item.id+n,m[o]=i,t.itemList.push(t.item),void f()))},t.itemIcon&&(t.addItemProcessing=!0,e.readAsDataURL(t.itemIcon))}},t.validateDuplicate=function(){if(""!==t.item.id){var e=t.itemList.some((function(e){return e.id===t.item.id}));if(e)return t.addItemForm.txtItemId.$setValidity("unique",!1),t.focusOnId=!0,e;t.addItemForm.txtItemId.$setValidity("unique",!0);var i=p.some((function(e){return e===t.item.id}));return i?(t.addItemForm.txtItemId.$setValidity("existing",!1),t.showOverwrite=!0,i):(t.addItemForm.txtItemId.$setValidity("existing",!0),t.showOverwrite=!1,t.item.overwrite=!1,i)}},t.validateGroupNameDuplicate=function(){var e=!1;if(void 0!==t.newGroup&&""!==t.newGroup){var i=t.newGroup.toLowerCase().split(" ").join("_");e=t.groups.some((function(e){return e.id===i}))}t.addItemForm.txtItemGroup.$setValidity("unique",!e)},t.validateOverwrites=function(){var e=t.item.overwrite;t.addItemForm.txtItemId.$setValidity("existing",e)},t.clearItem=function(){f()},t.addGroup=function(){t.showNewGroup=!0,t.item&&t.item.group_id&&(t.item.group_id=""),t.addItemForm.ddlGroup.$setPristine()},t.cancelNewGroup=function(){t.showNewGroup=!1,t.newGroup="",t.addItemForm.txtItemGroup.$setValidity("unique",!0),t.addItemForm.txtItemGroup.$setPristine()},t.removeItem=function(e){if(""!==e){var i=t.itemList,r=i.filter((function(t){return t.id===e}));if(r&&1===r.length){var n=i.indexOf(r[0]);-1!==n&&t.itemList.splice(n,1);var o=r[0].icon;delete m[o]}}},t.generatePlugin=function(){if(!t.createPluginForm.$invalid){s=s.filter((function(e){return t.itemList.some((function(t){return t.group_id===e.id}))}));var r=e.toJson(m),a=s.concat(t.itemList),u=e.toJson(a),l={name:t.pluginName,installListJson:u,iconListJson:r};return o.generatePluginFile(l).then((function(e){if(void 0!==e.tarball){t.notice=!0;var r="download/"+e.tarball;n.add({type:"success",message:i.maketext("The plugin file “[_1]” was generated successfully. Please [output,url,_2,download the plugin,target,blank,title,_1] before creating a new one.",e.tarball,r),id:"alertAddSuccess",closeable:!1}),f(),t.createPluginForm.$dirty&&(t.createPluginForm.$setPristine(),t.itemList=[],t.pluginName="",m={})}}),(function(e){n.add({type:"danger",message:e,id:"alertMessages",closeable:!1})}))}}}])})),define("app/directives/fileModel",["angular"],(function(e){e.module("App").directive("fileModel",["$parse",function(e){return{restrict:"A",require:"ngModel",link:function(t,i,r,n){var o=e(r.fileModel);i.bind("change",(function(){var e=this.files[0];e&&t.$apply((function(){o.assign(t,e),n.$setViewValue(n.$modelValue)}))}))}}}])})),define("app/directives/fileType",["angular"],(function(e){e.module("App").directive("fileType",[function(){return{restrict:"A",require:"ngModel",link:function(t,i,r,n){i.bind("change",(function(){var i=this.files[0];i&&(0===i.size?n.$setValidity("filesize",!1):n.$setValidity("filesize",!0),!function(t,i){var r=!1;return e.forEach(i,(function(e){r=r||t.type===e})),r}(i,t.$eval(r.fileType))?n.$setValidity("filetype",!1):n.$setValidity("filetype",!0))}))}}}])})),define("app/index",["angular","jquery","lodash","cjt/core","cjt/modules","ngRoute"],(function(e,t,i,r){"use strict";return function(){return e.module("App",["cjt2.config.whm.configProvider","ngRoute","cjt2.whm"]),require(["cjt/bootstrap","cjt/util/locale","cjt/views/applicationController","app/views/createPluginController","app/directives/fileModel","app/directives/fileType","cjt/directives/autoFocus","cjt/services/autoTopService","cjt/directives/actionButtonDirective"],(function(t,i){var n=e.module("App");n.value("PAGE",PAGE),n.firstLoad={pluginList:!0},n.config(["$routeProvider",function(e){e.when("/createPlugin",{controller:"createPluginController",templateUrl:r.buildFullPath("cpanel_plugin_manager/views/createPluginView.ptt"),reloadOnSearch:!1}),e.otherwise({redirectTo:"/createPlugin"})}]),n.run(["autoTopService",function(e){e.initialize()}]),t(document)}))}}));