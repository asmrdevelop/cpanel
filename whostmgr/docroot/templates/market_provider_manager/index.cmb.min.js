define("app/services/manageService",["angular","cjt/io/api","cjt/io/whm-v1-request","cjt/io/whm-v1"],(function(e,t,r){var i=e.module("App");function n(e,i){var n={},o=[],a="";return n.get_providers=function(){return i.providers?i.providers:[]},n.get_products=function(){return o},n.fetch_providers=function(){var i=e.defer(),n=new r.Class;return n.initialize("","get_market_providers_list"),t.promise(n.getRunArguments()).done((function(e){(e=e.parsedResponse).status?i.resolve(e):i.reject(e.error)})),i.promise.then((function(e){e.data})),i.promise},n.fetch_products=function(){var i=e.defer(),n=new r.Class;return n.initialize("","get_market_providers_products"),t.promise(n.getRunArguments()).done((function(e){(e=e.parsedResponse).status?i.resolve(e):i.reject(e.error)})),i.promise.then((function(e){o=e.data})),i.promise},n.set_provider_enabled_status=function(i,n){var o=e.defer(),a=n?"enable_market_provider":"disable_market_provider",c=new r.Class;return c.initialize("",a),c.addArgument("name",i.name),t.promise(c.getRunArguments()).done((function(e){(e=e.parsedResponse).status?o.resolve(e):o.reject(e.error)})),o.promise},n.get_contact_email=function(){return a},n.fetch_contact_email=function(){var i=e.defer(),n=new r.Class;return n.initialize("","get_tweaksetting"),n.addArgument("key","CONTACTEMAIL"),n.addArgument("module","Basic"),t.promise(n.getRunArguments()).done((function(e){(e=e.parsedResponse).status?i.resolve(e):i.reject(e.error)})),i.promise.then((function(e){a=e.data.tweaksetting.value})),i.promise},n}return n.$inject=["$q","PAGE"],i.factory("manageService",n)})),define("app/services/editProductsService",["angular","cjt/io/api","cjt/util/query","cjt/util/parse","cjt/io/whm-v1-request","cjt/io/whm-v1"],(function(e,t,r,i,n){"use strict";var o=e.module("App"),a="";function c(e){var o={},c=[],s=[];return o.get_products=function(){return c},o.fetch_products=function(){var r=e.defer(),o=new n.Class;return o.initialize(a,"get_adjusted_market_providers_products"),t.promise(o.getRunArguments()).done((function(e){(e=e.parsedResponse).status?r.resolve(e):r.reject(e.error)})),r.promise.then((function(e){(c=e.data).forEach((function(e){["recommended","x_ssl_per_domain_pricing"].forEach((function(t){e[t]=i.parsePerlBoolean(e[t])})),e.price=e.price&&i.parseNumber(e.price),e.x_ssl_per_domain_pricing&&(e.x_price_per_domain=i.parseNumber(e.x_price_per_domain))}))})),r.promise},o.set_product_enabled=function(r,i,o){var c=e.defer(),s=new n.Class,d=o?1:0;return s.initialize(a,"set_market_product_attribute"),s.addArgument("product_id",r.product_id),s.addArgument("value",d),s.addArgument("provider",i),s.addArgument("attribute","enabled"),t.promise(s.getRunArguments()).done((function(e){(e=e.parsedResponse).status?c.resolve(e):c.reject(e.error)})),c.promise},o.setMarketProductAttribute=function(r,i,o,c){var s=e.defer(),d=new n.Class;return d.initialize(a,"set_market_product_attribute"),d.addArgument("product_id",i),d.addArgument("provider",r),d.addArgument("attribute",o),d.addArgument("value",c),t.promise(d.getRunArguments()).done((function(e){(e=e.parsedResponse).status?s.resolve(e):s.reject(e.error)})),s.promise},o.set_provider_product_recommended=function(i,o,s){var d=e.defer(),u=s?1:0,p=u&&c.filter((function(e){return!!e.recommended&&i.product_group===e.product_group})),m=new n.Class;if(p&&p.length){m.initialize(a,"batch");var _={};for(var l in p.forEach((function(e,t){_["command-"+t]={product_id:e.product_id,value:0,provider:e.provider_name}})),_["command-"+p.length]={product_id:i.product_id,value:1,provider:i.provider_name},_)if(_.hasOwnProperty(l)){_[l].attribute="recommended";var f=r.make_query_string(_[l]);m.addArgument(l,"set_market_product_attribute?"+f)}}else m.initialize(a,"set_market_product_attribute"),m.addArgument("product_id",i.product_id),m.addArgument("value",u),m.addArgument("provider",o),m.addArgument("attribute","recommended");return t.promise(m.getRunArguments()).done((function(e){(e=e.parsedResponse).status?d.resolve(e):d.reject(e.error)})),d.promise},o.fetch_product_metadata=function(){var r=e.defer(),o=new n.Class;return o.initialize(a,"get_market_providers_product_metadata"),t.promise(o.getRunArguments()).done((function(e){(e=e.parsedResponse).status?r.resolve(e):r.reject(e.error)})),r.promise.then((function(e){(s=e.data).forEach((function(e){for(var t in e.attributes)e.attributes.hasOwnProperty(t)&&(e.attributes[t].read_only=i.parsePerlBoolean(e.attributes[t].read_only))}))})),r.promise},o.get_product_metadata=function(){return s},o}return c.$inject=["$q"],o.factory("editProductsService",c)})),define("app/services/editCPStoreService",["angular","cjt/io/api","cjt/io/whm-v1-request","cjt/io/whm-v1"],(function(e,t,r){var i,n=e.module("App");function o(e){var n={set_commission_id:function(i,n){var o=e.defer(),a=new r.Class;return a.initialize("","set_market_provider_commission_id"),a.addArgument("provider",i),a.addArgument("commission_id",n),t.promise(a.getRunArguments()).done((function(e){(e=e.parsedResponse).status?o.resolve(e):o.reject(e.error)})),o.promise},fetch_market_providers_commission_config:function(){var n=e.defer(),o=new r.Class;return o.initialize("","get_market_providers_commission_config"),t.promise(o.getRunArguments()).done((function(e){(e=e.parsedResponse).status?n.resolve(e):n.reject(e.error)})),n.promise.then((function(e){i=e.data})),n.promise},get_market_providers_commission_config:function(){return i}};return n}return o.$inject=["$q"],n.factory("editCPStoreService",o)})),define("app/views/manageController",["lodash","angular","cjt/util/locale","uiBootstrap","cjt/directives/toggleSortDirective","cjt/directives/actionButtonDirective","cjt/directives/toggleSwitchDirective","cjt/validator/email-validator","cjt/directives/validationContainerDirective","cjt/directives/validationItemDirective"],(function(e,t,r){return t.module("App").controller("manageController",["$scope","manageService","editCPStoreService","growl",function(i,n,o,a){function c(t){return a.error(e.escape(t))}i.set_provider=function(t,o){var d=r.maketext("The system successfully enabled the Market provider “[_1]”.",e.escape(t.name)),u=r.maketext("The system successfully disabled the Market provider “[_1]”.",e.escape(t.name)),p=o?d:u;return n.set_provider_enabled_status(t,o).then((function(){if(a.success(p),o&&t.supports_commission)return s(t.name).then((function(e){t.enabled=o,i.$parent.go("edit_cpstore_config",2)}),(function(e){t.enabled=o,i.$parent.go("edit_cpstore_config",2)}));t.enabled=o}),c)};var s=function(t){return o.fetch_market_providers_commission_config().then((function(n){for(var c=!1,s=0;s<n.data.length;s++)n.data[s].provider_name!==t||n.data[s].remote_commission_id||(c=!0);if(c&&i.CONTACTEMAIL)return o.set_commission_id(t,i.CONTACTEMAIL).then((function(n){a.success(r.maketext("The system successfully set the commission [asis,ID] for the provider “[_1]” to “[_2]”.",e.escape(t),e.escape(i.CONTACTEMAIL)))}),(function(e){}))}),c)};i.init=function(){i.fetching_products=!0,i.locale=r,i.providers=n.get_providers(),i.$parent.loading=!0,n.fetch_products().then((function(r){t.forEach(r.meta.warnings,(function(t){a.warning(e.escape(t))})),i.products=n.get_products()}),c).finally((function(){i&&i.$parent&&(i.$parent.loading=!1),i.fetching_products=!1})),n.fetch_contact_email().then((function(){i.CONTACTEMAIL=n.get_contact_email()}),c)},i.init()}])})),define("app/views/editProductsController",["lodash","angular","cjt/util/locale","cjt/validator/compare-validators","cjt/validator/datatype-validators","uiBootstrap","cjt/directives/toggleSortDirective","cjt/directives/actionButtonDirective","cjt/directives/toggleSwitchDirective"],(function(e,t,r){"use strict";return t.module("App").controller("editProductsController",["$scope","editProductsService","growl","$uibModal","$log","PAGE",function(i,n,o,a,c,s){function d(t){return o.error(e.escape(t))}var u,p={};i.provider_commission=p;for(var m=s.providers,_=0;_<m.length;_++)m[_].even_commission_divisor&&(p[m[_].name]=m[_].even_commission_divisor/100);function l(e){e=parseFloat(e)+.001;var t=r.numf(e);return t.substr(0,t.length-1)}i.set_product=function(t,i){var a=r.maketext("The system has successfully enabled the product “[_1]”.",e.escape(t.display_name)),c=r.maketext("The system has successfully disabled the product “[_1]”.",e.escape(t.display_name)),s=i?a:c;return n.set_product_enabled(t,t.provider_name,i).then((function(){o.success(s),t.enabled=i}),d)},i.product_group_changing={},i.set_recommended=function(t,a){t.recommended_is_changing=!0,i.product_group_changing[t.product_group]=!0;var c=r.maketext("“[_1]” is now recommended.",e.escape(t.display_name)),s=r.maketext("“[_1]” is no longer recommended.",e.escape(t.display_name)),u=a?c:s;return n.set_provider_product_recommended(t,t.provider_name,a).then((function(){if(o.success(u),a)for(var e=0;e<i.products.length;e++)i.products[e].product_group===t.product_group&&(i.products[e].recommended=!1);t.recommended=a}),d).finally((function(){t.recommended_is_changing=!1,i.product_group_changing[t.product_group]=!1}))},i.format_dollars=l;var f=Number;i.get_product_commission=function(e){var t=e[e._pricing_attribute]/3;return t=Math.round(100*t),parseFloat((""+t).replace(/(..)$/,".$1"))},i.editProductPrice=function(c,s){var p=e.escape(c.display_name),m=c._pricing_attribute,_=i.provider_commission[c.provider_name],g=c.x_price_per_domain_minimum,v=c.x_price_per_domain_maximum,h=r.maketext("Editing the per-domain pricing for the product “[_1]”.",c.display_name);s&&(m=c._wildcard_pricing_attribute,g=c.x_price_per_wildcard_domain_minimum,v=c.x_price_per_wildcard_domain_maximum,h=r.maketext("Editing the per-wildcard-domain pricing for the product “[_1]”.",c.display_name));var w=c[m],A={editingDescription:h,product:{providerCommissionMessage:_?i.get_provider_commission_msg(_):null,settingPrice:!1,price:{unit:c.price_unit,minimum:g||0,maximum:v||1e6,minimumMessage:i.get_min_price_msg(g),maximumMessage:i.get_max_price_msg(v),multipleOf:_?i.provider_commission[c.provider_name]:.01}},new_price:f(w).toFixed(2),cancel_change_price:function(){u.close()},set_price:function(e,t){A.product.settingPrice=!0;var i,a=f(e);i=s?r.maketext("The system has successfully set the per-wildcard-domain pricing for the product “[_1]” to $[_2].",p,l(a)):r.maketext("The system has successfully set the per-domain pricing for the product “[_1]” to $[_2].",p,l(a));return n.setMarketProductAttribute(c.provider_name,c.product_id,m,a).then((function(){c[m]=a,u.dismiss(),t.$setPristine(),o.success(i)}),d).finally((function(){A.product.settingPrice=!1}))}};var b=i.$new();t.extend(b,A);var C=document.getElementById("product-price-modal").text;u=a.open({template:C,scope:b,size:"sm"})},i.product_orderBy_sorter=function(e){return e[e._pricing_attribute]};var g={},v={},h=function(){i.$parent.loading=!1,i.products.forEach((function(e){var t=e.provider_name+"/"+e.product_id;e._pricing_attribute=e.x_ssl_per_domain_pricing?"x_price_per_domain":"price",e.x_price_per_wildcard_domain&&(e._wildcard_pricing_attribute="x_price_per_wildcard_domain");try{e._price_is_read_only=v[t].attributes[e._pricing_attribute].read_only}catch(r){c.warn("Missing metadata attribute?",JSON.stringify(e),t,JSON.stringify(v),r),e._price_is_read_only=!0}}))};i.get_recommended_tooltip=function(e){return e.recommended?r.maketext("Clear the recommended product setting for this product group."):r.maketext("Make this the recommended product for its product group.")},i.get_provider_commission_msg=function(e){return r.maketext("Enter a multiple of $[_1] USD.",l(e))},i.get_min_price_msg=function(e){return r.maketext("The minimum price is $[_1] USD.",l(e))},i.get_max_price_msg=function(e){return r.maketext("The maximum price is $[_1] USD.",l(e))},i.init=function(){i.fetching_products=!0,i.fetching_metadata=!0,i.selected_product=void 0,i.$parent.loading=!0,n.fetch_products().then((function(){}),(function(e){o.error(e)})).then((function(){i.fetching_products=!1,i.products=n.get_products(),i.products.forEach((function(e){g[e.provider_name+"/"+e.product_id]=e})),i&&i.$parent&&!i.fetching_metadata&&h()})),n.fetch_product_metadata().then((function(){}),(function(e){o.error(e)})).then((function(){i.fetching_metadata=!1,i.product_metadata=n.get_product_metadata(),i.product_metadata.forEach((function(e){v[e.provider_name+"/"+e.product_id]=e})),i&&i.$parent&&!i.fetching_products&&h()}))},i.init()}])})),define("app/views/editCPStoreController",["lodash","angular","cjt/util/locale","uiBootstrap","cjt/directives/actionButtonDirective","cjt/validator/email-validator"],(function(e,t,r){return t.module("App").controller("editCPStoreController",["$scope","editCPStoreService","growl",function(t,i,n){function o(t){return n.error(e.escape(t))}t.init=function(){t.locale=r,t.$parent.loading=!0,i.fetch_market_providers_commission_config().then((function(){t.cpstore_commission_config=i.get_market_providers_commission_config().filter((function(e){return"cPStore"===e.provider_name}))[0]}),o).then((function(){t&&t.$parent&&(t.$parent.loading=!1)}))},t.set_commission_id=function(a,c){var s=r.maketext("You have set the Commission [asis,ID] for “[_1]” to “[_2]”.",e.escape(a),e.escape(c));return t.setting_commission_id=!0,i.set_commission_id(a,c).then((function(){n.success(s)}),o).then((function(){t.setting_commission_id=!1}))},t.init()}])})),define("app/index",["angular","cjt/core","cjt/modules","uiBootstrap","ngRoute","ngAnimate"],(function(e,t){"use strict";return t.config.html5Mode=!1,function(){return e.module("App",["cjt2.config.whm.configProvider","ui.bootstrap","angular-growl","cjt2.whm","ngAnimate"]),require(["cjt/bootstrap","uiBootstrap","app/services/manageService","app/services/editProductsService","app/services/editCPStoreService","app/views/manageController","app/views/editProductsController","app/views/editCPStoreController"],(function(r){var i=e.module("App");i.value("PAGE",PAGE),i.controller("BaseController",["$rootScope","$scope","$route","$location",function(e,t,r,i){t.loading=!1,e.$on("$routeChangeStart",(function(){t.loading=!0})),e.$on("$routeChangeSuccess",(function(){t.loading=!1})),e.$on("$routeChangeError",(function(){t.loading=!1})),t.current_route_matches=function(e){return i.path().match(e)},t.onSelectTab=function(e){t.activeTabIndex=e},t.go=function(e,r){i.path(e),t.active_path=e,t.onSelectTab(r)},t.activeTabIndex=0}]),i.config(["$routeProvider",function(e){e.when("/",{controller:"manageController",templateUrl:t.buildFullPath("market_provider_manager/views/manageView.ptt")}),e.when("/edit_products/",{controller:"editProductsController",templateUrl:t.buildFullPath("market_provider_manager/views/editProducts.ptt")}),e.when("/edit_cpstore_config/",{controller:"editCPStoreController",templateUrl:t.buildFullPath("market_provider_manager/views/editCPStore.ptt")}),e.otherwise({redirectTo:"/"})}]),r()}))}}));