define("app/services/indexService",["angular","cjt/io/api","cjt/util/query","cjt/io/whm-v1-request","cjt/io/whm-v1"],(function(e,t,r,n){var a=e.module("App"),o="";function s(e,a){var s={get_domains:function(){return a.data.domains},get_enabled_provider_count:function(){return a.data.enabled_provider_count},get_default_theme:function(){return a.data.default_theme},check_account_has_feature:function(r,a){var s=e.defer(),i=new n.Class;return i.initialize(o,"verify_user_has_feature"),i.addArgument("user",r),i.addArgument("feature",a),t.promise(i.getRunArguments()).done((function(e){(e=e.parsedResponse).status?s.resolve(e):s.reject(e.error)})),s.promise},check_user_has_features:function(a,s){var i=e.defer(),u=new n.Class;u.initialize(o,"batch");var c={};for(var d in s.forEach((function(e,t){c["command-"+t]={feature:e}})),c)if(c.hasOwnProperty(d)){c[d].user=a;var l=r.make_query_string(c[d]);u.addArgument(d,"verify_user_has_feature?"+l)}return t.promise(u.getRunArguments()).done((function(e){(e=e.parsedResponse).status?i.resolve(e):i.reject(e.error)})),i.promise},force_enable_features_for_user:function(r,a){var s=e.defer(),i=new n.Class;return i.initialize(o,"add_override_features_for_user"),i.addArgument("user",r),i.addArgument("features",JSON.stringify(a)),t.promise(i.getRunArguments()).done((function(e){(e=e.parsedResponse).status?s.resolve(e):s.reject(e.error)})),s.promise},create_user_session:function(r){var a=e.defer(),s=new n.Class;return s.initialize(o,"create_user_session"),s.addArgument("user",r),s.addArgument("service","cpaneld"),s.addArgument("app","SSL_TLS_Wizard"),t.promise(s.getRunArguments()).done((function(e){(e=e.parsedResponse).status?a.resolve(e):a.reject(e.error)})),a.promise},enable_cpstore_provider:function(){var r=e.defer(),a=new n.Class;return a.initialize(o,"enable_market_provider"),a.addArgument("name","cPStore"),t.promise(a.getRunArguments()).done((function(e){(e=e.parsedResponse).status?r.resolve(e):r.reject(e.error)})),r.promise},set_user_theme_to_default_theme:function(r){var s=e.defer(),i=new n.Class,u=a.data.default_theme;return i.initialize(o,"modifyacct"),i.addArgument("user",r),i.addArgument("RS",u),t.promise(i.getRunArguments()).done((function(e){(e=e.parsedResponse).status?s.resolve(e):s.reject(e.error)})),s.promise},set_user_style_to_retro:function(r){var a=e.defer(),s=new n.Class;return s.initialize(o,"cpanel"),s.addArgument("user",r),s.addArgument("cpanel_jsonapi_apiversion","3"),s.addArgument("cpanel_jsonapi_module","Styles"),s.addArgument("cpanel_jsonapi_func","update"),s.addArgument("name","retro"),s.addArgument("type","default"),t.promise(s.getRunArguments()).done((function(e){(e=e.parsedResponse).status?a.resolve(e):a.reject(e.error)})),a.promise},get_user_account_info:function(r){var a=e.defer(),s=new n.Class;return s.initialize(o,"accountsummary"),s.addArgument("user",r),t.promise(s.getRunArguments()).done((function(e){(e=e.parsedResponse).status?a.resolve(e):a.reject(e.error)})),a.promise}};return s}return s.$inject=["$q","PAGE"],a.factory("indexService",s)})),define("app/views/purchaseRedirectController",["lodash","angular","cjt/util/locale","uiBootstrap","cjt/directives/toggleSortDirective","cjt/directives/searchDirective","cjt/directives/pageSizeDirective","cjt/filters/startFromFilter","cjt/decorators/paginationDecorator"],(function(e,t,r){return t.module("App").controller("purchaseRedirectController",["$scope","$filter","indexService","growl",function(n,a,o,s){var i=function(t){s.error(e.escape(t))},u=o.get_default_theme(),c=o.get_domains(),d=[],l=!o.get_enabled_provider_count();t.forEach(c,(function(e,t){d.push({username:e,domain:t})})),n.accounts=d,n.meta={sortReverse:!1,sortBy:"username",sortDirection:"desc",maxPages:5,totalItems:n.accounts.length,currentPage:1,pageSize:10,pageSizes:[10,20,50,100],start:0,limit:10,filterValue:""},n.showPager=!0;var f={filter:a("filter"),orderBy:a("orderBy"),startFrom:a("startFrom"),limitTo:a("limitTo")};n.sortList=function(){n.fetch()},n.selectPage=function(){n.fetch()},n.selectPageSize=function(){n.fetch()},n.searchList=function(){n.fetch()};n.fetch=function(){var e=[];if(e=""!==n.meta.filterValue?f.filter(n.accounts,n.meta.filterValue,!1):n.accounts,""!==n.meta.sortDirection&&""!==n.meta.sortBy&&(e=f.orderBy(e,n.meta.sortBy,"asc"===n.meta.sortDirection)),n.meta.totalItems=e.length,n.meta.totalItems>function(e){for(var t=e[0],r=0;r<e.length;r++)t=e[r]<t?e[r]:t;return t}(n.meta.pageSizes)){var t=(n.meta.currentPage-1)*n.meta.pageSize,r=n.meta.pageSize>0?n.meta.pageSize:n.meta.totalItems;e=f.limitTo(f.startFrom(e,t),r),n.showPager=!0,n.meta.start=t+1,n.meta.limit=t+e.length}else n.showPager=!1,0===e.length?n.meta.start=0:n.meta.start=1,n.meta.limit=e.length;return n.filteredAccounts=e,e},n.fetch(),n.process_user_and_generate_login_url=function(e,t){return l?(l=!1,o.enable_cpstore_provider().then((function(n){return s.success(r.maketext("Because no other providers are enabled, the system enabled the [asis,cPanel Store] provider.")),m(e,t)}),(function(e){l=!0,i(e)}))):m(e,t)},n.get_pagination_msg=function(){return r.maketext("Displaying [numf,_1] to [numf,_2] out of [quant,_3,item,items]",n.meta.start,n.meta.limit,n.meta.totalItems)};var m=function(e,t){var n={};return o.check_user_has_features(e,["market","tls_wizard","sslinstall"]).then((function(a){for(var u=0;u<a.data.length;u++){var c=a.data[u].parsedResponse.data;c.has_feature||(n[c.query_feature]=1,n.should_be_set=!0)}return n.should_be_set?(delete n.should_be_set,o.force_enable_features_for_user(e,n).then((function(a){var o=Object.keys(n).sort();return s.success(r.maketext("The system enabled the [numerate,_1,feature,features] [list_and_quoted,_2] for the user “[_3]” to ensure access to the “[_4]”.",o.length,o,e,r.maketext("[asis,SSL]/[asis,TLS] Wizard"))),_(e,t)}),i)):_(e,t)}),i)},_=function(t,n){var a=function(){return o.create_user_session(t).then((function(a){var o=a.data.url+"#/purchase-certificates/"+n;window.open(o,"_blank"),s.success(r.maketext("Click to continue as the “[_1]” user and purchase an [asis,SSL] certificate.",e.escape(t)),{ttl:-1,variables:{buttonLabel:"Purchase SSL",showAction:!0,action:function(){window.open(o,"_blank")}}})}),i)};return o.get_user_account_info(t).then((function(n){return"x3"===n.data[0].theme?o.set_user_theme_to_default_theme(t).then((function(n){return o.set_user_style_to_retro(t).then((function(n){return s.success(r.maketext("The system changed the theme for user “[_1]” to “[_2]”, with the “[asis,Retro]” style, to support this feature.",e.escape(t)),{ttl:-1},u),a()}),(function(e){s.error(r.maketext("You cannot redirect to this account because it does not have theme support for this feature."))}))}),(function(e){s.error(r.maketext("You cannot redirect to this account because it does not have theme support for this feature."))})):a()}),(function(t){s.error(r.maketext("The system failed to fetch the user’s account information because of the following error: [_1]",e.escape(t)))}))}}])})),define("app/index",["angular","cjt/core","cjt/modules","uiBootstrap","ngRoute"],(function(e,t){return t.config.html5Mode=!1,function(){return e.module("App",["cjt2.config.whm.configProvider","ui.bootstrap","angular-growl","cjt2.whm"]),require(["cjt/bootstrap","uiBootstrap","app/services/indexService","app/views/purchaseRedirectController"],(function(r){var n=e.module("App");n.value("PAGE",PAGE),n.controller("BaseController",["$rootScope","$scope","$route","$location",function(e,t,r,n){t.loading=!1,e.$on("$routeChangeStart",(function(){t.loading=!0})),e.$on("$routeChangeSuccess",(function(){t.loading=!1})),e.$on("$routeChangeError",(function(){t.loading=!1})),t.current_route_matches=function(e){return n.path().match(e)},t.go=function(e){n.path(e)}}]),n.config(["$routeProvider",function(e){e.when("/purchaseRedirect",{controller:"purchaseRedirectController",templateUrl:t.buildFullPath("tls_wizard_redirect/views/purchaseRedirectView.ptt"),resolve:{}}),e.otherwise({redirectTo:"/purchaseRedirect"})}]),r()}))}}));