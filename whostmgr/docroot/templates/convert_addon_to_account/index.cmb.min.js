define("app/services/pageDataService",["angular"],(function(e){e.module("App").factory("pageDataService",[function(){return{prepareDefaultInfo:function(e){return e.security_token=e.security_token||"",e.addon_domains=e.addon_domains||[],e.username_restrictions=e.username_restrictions||{},e.username_restrictions.maxLength=Number(e.username_restrictions.maxLength)||16,e}}}])})),define("app/services/ConvertAddonData",["angular","jquery","lodash","cjt/util/locale","cjt/util/parse","cjt/io/api","cjt/io/whm-v1-request","cjt/io/whm-v1"],(function(e,t,o,n,i,a,s,r){return e.module("App").factory("ConvertAddonData",["$q","defaultInfo",function(t,n){var i={domains:[]},r={"email-accounts":!0,autoresponders:!0,"email-forwarders":!0,docroot:!0,"preserve-ownership":!0,"custom-dns-records":!0,mysql_dbs:[],mysql_users:[],db_move_type:"move","custom-vhost-includes":!0,"copy-installed-ssl-cert":!0,"ftp-accounts":!0,"webdisk-accounts":!0};function d(e){var t=i.domains.filter((function(t){return e===t.addon_domain}));return t.length?t[0]:{}}return i.getAddonDomain=function(e){return 0===i.domains.length?t.when(i.loadList()).then((function(t){return d(e)})):t.when(d(e))},i.getAddonDomainDetails=function(o){var n=d(o);if(Object.keys(n).length>1&&Object.keys(n.details).length>1)return t.when(n);var l=new s.Class;return l.initialize("","convert_addon_fetch_domain_details"),l.addArgument("domain",o),t.when(a.promise(l.getRunArguments())).then((function(t){return t=t.parsedResponse,i.getAddonDomain(o).then((function(o){return null!==t.data&&(e.extend(o.details,t.data),0===Object.keys(o.move_options).length&&e.extend(o.move_options,r)),o}))})).catch((function(e){return(e=e.parsedResponse).error}))},i.convertDomainObjectToList=function(e){i.domains=Object.keys(e).map((function(t){var o=e[t];return o.addon_domain=t,o.details={},o.move_options={},o.account_settings={},o}))},i.loadList=function(){var e=t.defer(),o=new s.Class;return o.initialize("","convert_addon_list_addon_domains"),a.promise(o.getRunArguments()).done((function(t){(t=t.parsedResponse).status?(i.convertDomainObjectToList(t.data),e.resolve(i.domains)):e.reject(t.error)})),e.promise},i.beginConversion=function(e){var n,i,r=new s.Class;for(var d in r.initialize("","convert_addon_initiate_conversion"),e.account_settings)e.account_settings.hasOwnProperty(d)&&r.addArgument(d,e.account_settings[d]);for(var l in e.move_options)if(e.move_options.hasOwnProperty(l)){if("db_move_type"===l)continue;if("mysql_dbs"===l)for(n=0,i=e.move_options[l].length;n<i;n++)"copy"===e.move_options.db_move_type?r.addArgument("copymysqldb-"+e.move_options[l][n].name,e.move_options[l][n].new_name):r.addArgument("movemysqldb-"+n,e.move_options[l][n].name);else if("mysql_users"===l&&"move"===e.move_options.db_move_type)for(n=0,i=e.move_options[l].length;n<i;n++)r.addArgument("movemysqluser-"+n,e.move_options[l][n].name);else o.isBoolean(e.move_options[l])?r.addArgument(l,e.move_options[l]?1:0):r.addArgument(l,e.move_options[l])}return t.when(a.promise(r.getRunArguments())).then((function(e){return(e=e.parsedResponse).status?e.data:t.reject(e.meta)}))},i.init=function(){i.convertDomainObjectToList(n.addon_domains)},i.init(),i}])})),define("app/services/Databases",["angular","jquery","lodash","cjt/util/locale","cjt/util/parse","cjt/io/api","cjt/io/whm-v1-request","cjt/io/whm-v1"],(function(e,t,o,n,i,a,s,r){return e.module("App").factory("Databases",["$q",function(e){var t,o,n,r={};r.databases={},r.users={},r.currentOwner="";var d={mysql:{database:"verify_mysql_database_name"},postgresql:{database:"verify_postgresql_database_name"}};return r.setPrefixing=function(e){t=e},r.isPrefixingEnabled=function(){return t},r.setMySQLVersion=function(e){o=e,window.MYSQL_SERVER_VERSION=o},r.getMySQLVersion=function(){return o},r.setPrefixLength=function(e){n=e},r.getPrefixLength=function(){return n},r.createPrefix=function(e){var t=e.replace(/[_.]/,""),o=r.getPrefixLength();return t.substr(0,o)+"_"},r.addPrefix=function(e,t){return r.createPrefix(t)+e},r.addPrefixIfNeeded=function(e,t){if(void 0!==e&&""!==e){var o=r.createPrefix(t);return new RegExp("^"+o+".+$").test(e)?e:o+e}},r.listMysqlDbsAndUsers=function(t){var o=new s.Class;return o.initialize("","list_mysql_databases_and_users"),o.addArgument("user",t),e.when(a.promise(o.getRunArguments())).then((function(t){if(!(t=t.parsedResponse).status)return e.reject(t.meta);r.setPrefixing(i.parsePerlBoolean(t.data.mysql_config.use_db_prefix)),r.setPrefixLength(t.data.mysql_config.prefix_length),r.setMySQLVersion(t.data.mysql_config["mysql-version"]),r.databases=t.data.mysql_databases,r.users=function(e){var t={},o="",n=e.mysql_databases;for(var i in n)if(n.hasOwnProperty(i))for(var a=0,s=n[i].length;a<s;a++)o=n[i][a],t.hasOwnProperty(o)?t[o].push(i):t[o]=[i];return t}(t.data)}))},r.getDatabases=function(t){return Object.keys(r.databases).length>0&&r.currentOwner===t?e.when(r.databases):r.listMysqlDbsAndUsers(t).then((function(){return r.currentOwner=t,r.databases}))},r.getUsers=function(){return r.users},r.validateName=function(e,t){return CPANEL.sql[d[t].database](e)},r}])})),define("app/services/account_packages",["angular","jquery","lodash","cjt/util/locale","cjt/util/parse","cjt/io/api","cjt/io/whm-v1-request","cjt/io/whm-v1"],(function(e,t,o,n,i,a,s,r){return e.module("App").factory("AccountPackages",["$q",function(e){var t={packages:[],listPackages:function(){if(t.packages.length>0)return e.when(t.packages);var o=new s.Class;return o.initialize("","listpkgs"),e.when(a.promise(o.getRunArguments())).then((function(o){return(o=o.parsedResponse).status?(t.packages=o.data,t.packages):e.reject(o.meta)}))}};return t}])})),define("app/services/conversion_history",["angular","lodash","cjt/util/locale","cjt/util/parse","cjt/io/api","cjt/io/whm-v1-request","cjt/io/whm-v1"],(function(e,t,o,n,i,a,s){return e.module("App").factory("ConversionHistory",["$q",function(e){var t={conversions:[],getDetails:function(t){var o=e.defer(),n=new a.Class;return n.initialize("","convert_addon_fetch_conversion_details"),n.addArgument("job_id",t),i.promise(n.getRunArguments()).done((function(e){(e=e.parsedResponse).status?o.resolve(e.data):o.reject(e.error)})),o.promise},getJobStatus:function(t){var o=e.defer(),n=new a.Class;n.initialize("","convert_addon_get_conversion_status");for(var s=t.length,r=0;r<s;r++)n.addArgument("job_id-"+r,t[r]);return i.promise(n.getRunArguments()).done((function(e){(e=e.parsedResponse).status?o.resolve(e.data):o.reject(e.error)})),o.promise},load:function(){var o=e.defer(),n=new a.Class;return n.initialize("","convert_addon_list_conversions"),i.promise(n.getRunArguments()).done((function(e){(e=e.parsedResponse).status?(t.conversions=e.data,o.resolve(t.conversions)):o.reject(e.error)})),o.promise}};return t}])})),define("app/filters/local_datetime_filter",["angular","cjt/util/locale"],(function(e,t){e.module("App").filter("local_datetime",(function(){return function(e){return null==e||""===e?"":("number"!=typeof e&&(e=Number(e)),t.local_datetime(e,"datetime_format_medium"))}}))})),define("app/views/main",["angular","cjt/util/locale","lodash","uiBootstrap","cjt/decorators/growlDecorator","cjt/directives/searchDirective","app/services/ConvertAddonData"],(function(e,t,o){var n=e.module("App");return n.controller("mainController",["$anchorScroll","$location","growl","ConvertAddonData",function(e,o,i,a){var s=this;s.allDomains=[],s.loadingDomains=!1,s.meta={sortDirection:"asc",sortBy:"domain",sortType:"",sortReverse:!1,maxPages:0,totalItems:s.allDomains.length||0,pageNumber:1,pageNumberStart:0,pageNumberEnd:0,pageSize:20,pageSizes:[20,50,100],pagedList:[],filteredList:s.allDomains,filter:""},s.resetPagination=function(){s.meta.pageNumber=1,s.fetchPage()},s.includeItem=function(e){return-1!==e.addon_domain.indexOf(s.meta.filter)||-1!==e.owner.indexOf(s.meta.filter)},s.filterList=function(){s.meta.filteredList=s.allDomains.filter(s.includeItem),s.resetPagination()},s.clearFilter=function(){s.hasFilter()&&(s.meta.filter="",s.meta.filteredList=s.allDomains.slice(),s.resetPagination())},s.hasFilter=function(){return s.meta.filter.length>0},s.fetchPage=function(t){var o=s.meta.pageSize,n=(s.meta.pageNumber-1)*o+1,i=n+o-1;i>s.meta.filteredList.length&&(i=s.meta.filteredList.length),s.meta.totalItems=s.meta.filteredList.length,s.meta.pagedList=s.meta.filteredList.slice(n-1,i),s.meta.pageNumberStart=0===s.meta.filteredList.length?0:n,s.meta.pageNumberEnd=i,t&&e("pageContainer")},s.paginationMessage=function(){return t.maketext("Displaying [numf,_1] to [numf,_2] out of [quant,_3,item,items]",s.meta.pageNumberStart,s.meta.pageNumberEnd,s.meta.totalItems)},s.convertDomain=function(e){o.path("/convert/"+encodeURIComponent(e.addon_domain)+"/migrations")},s.compareDomains=function(e,t){if("domain"===s.meta.sortBy)return e.addon_domain.localeCompare(t.addon_domain);var o=e.owner.localeCompare(t.owner);return 0===o?e.addon_domain.localeCompare(t.addon_domain):o},s.sortList=function(){s.allDomains.sort(s.compareDomains),"asc"!==s.meta.sortDirection&&(s.allDomains=s.allDomains.reverse())},s.hasAddonDomains=function(){return s.meta.pagedList.length>0},s.resetDisplay=function(){s.sortList(),s.filterList()},s.loadList=function(){return s.loadingDomains=!0,a.loadList().then((function(e){s.allDomains=e}),(function(e){i.error(e)})).finally((function(){s.loadingDomains=!1,s.resetDisplay()}))},s.forceLoadList=function(){s.allDomains=[],s.meta.pagedList=[],s.loadList()},s.viewHistory=function(){o.path("/history/")},s.init=function(){n.firstLoad.addonList?(n.firstLoad.addonList=!1,s.allDomains=a.domains,s.resetDisplay()):s.loadList()},s.init()}])})),define("app/directives/move_status",["angular","cjt/util/locale","cjt/core"],(function(e,t,o){e.module("App").directive("itemMoveStatus",[function(){var e="directives/move_status.phtml",n=t.maketext("Selected"),i=t.maketext("Not Selected");return{replace:!0,require:"ngModel",restrict:"E",scope:{ngModel:"="},templateUrl:o.config.debug?o.buildFullPath("templates/convert_addon_to_account/directives/move_status.phtml"):e,link:function(e,t,o){e.moveLabel=n,e.noMoveLabel=i}}}])})),define("app/views/move_options",["angular","cjt/util/locale","cjt/decorators/growlDecorator","cjt/validator/email-validator","cjt/directives/validationItemDirective","cjt/directives/validationContainerDirective","cjt/directives/validateEqualsDirective","cjt/directives/actionButtonDirective","app/services/ConvertAddonData","app/services/Databases","app/services/account_packages","app/directives/move_status"],(function(e,t){return e.module("App").controller("moveSelectionController",["$q","$location","$routeParams","defaultInfo","growl","ConvertAddonData","Databases","AccountPackages","$scope",function(e,o,n,i,a,s,r,d,l){var c=this;c.ui={},c.ui.is_loading=!1,c.ui.domain_exists=!1,c.ui.is_conversion_started=!1,c.enable_db_button=!1,c.this_domain={},c.copy_mysql_dbs=!1,c.has_dedicated_ip=!1,c.account_packages=[],c.ip_addr_will_change=!1,c.selected_package=void 0,c.stats={},c.no_databases_tooltip=t.maketext("Disabled because there are no databases to move"),c.no_email_tooltip=t.maketext("Disabled because there are no email-related items to move"),c.sync_pkg_settings=function(){1===c.this_domain.details.has_dedicated_ip||c.has_dedicated_ip?c.ip_addr_will_change=!0:c.ip_addr_will_change=!1},c.generate_username=function(e){var t=e.replace(/^\d+/,"").replace(/\.[^.]+$/,"").replace(/[^A-Za-z0-9]/g,"").substr(0,i.username_restrictions.maxLength);c.this_domain.account_settings.username=t.toLowerCase()},c.disableSave=function(e){return e.$dirty&&e.$invalid||c.ui.is_conversion_started||!c.account_packages.length},c.addDbPrefix=function(e){return r.isPrefixingEnabled()?r.addPrefixIfNeeded(e,c.this_domain.account_settings.username):e},l.$watch((function(){return c.selected_package}),(function(e,t){0!==Object.keys(c.this_domain).length&&void 0!==e&&(null===e?(c.has_dedicated_ip=!1,c.this_domain.account_settings.pkgname=""):(c.has_dedicated_ip="y"===e.IP,c.this_domain.account_settings.pkgname=e.name),c.sync_pkg_settings())})),c.startConversion=function(e){if(e.$valid){if(c.this_domain.modified=!0,r.isPrefixingEnabled()&&"copy"===c.this_domain.move_options.db_move_type)for(var n=0,i=c.this_domain.move_options.mysql_dbs.length;n<i;n++){var d=c.this_domain.move_options.mysql_dbs[n];d.new_name=r.addPrefix(d.new_name,c.this_domain.account_settings.username)}return s.beginConversion(c.this_domain).then((function(e){return a.success(t.maketext("The system started the conversion process for “[_1]”.",c.domain_name)),c.ui.is_conversion_started=!0,o.path("/history")})).catch((function(e){var t=e.errors.length;t>1&&a.error(e.reason);for(var o=0;o<t;o++)a.error(e.errors[o]);c.ui.is_conversion_started=!1}))}},c.goToEditView=function(e){return o.path("/convert/"+c.domain_name+"/migrations/edit/"+e)},c.goToMain=function(){return c.this_domain.account_settings={},o.path("/main")},c.ui.is_loading=!0,s.getAddonDomainDetails(n.addondomain).then((function(o){if(Object.keys(o).length)return c.domain_name=o.addon_domain,c.this_domain=o,c.this_domain.account_settings.domain=o.addon_domain,void 0===c.this_domain.account_settings.email&&(c.this_domain.account_settings.email=""),void 0===c.this_domain.account_settings.pkgname&&(c.this_domain.account_settings.pkgname=""),void 0===c.this_domain.account_settings.username&&c.generate_username(c.domain_name),1===c.this_domain.details.has_dedicated_ip&&(c.ip_addr_will_change=!0),c.show_ssl_copy_option=c.this_domain.move_options["copy-installed-ssl-cert"]&&1===c.this_domain.details.has_ssl_cert_installed,c.this_domain.modified||(function(e){0===e.details.number_of_email_accounts&&(c.this_domain.move_options["email-accounts"]=!1),e.details.number_of_domain_forwarders+e.details.number_of_email_forwarders===0&&(c.this_domain.move_options["email-forwarders"]=!1),0===e.details.number_of_autoresponders&&(c.this_domain.move_options.autoresponders=!1),c.show_ssl_copy_option=1===c.this_domain.details.has_ssl_cert_installed,c.sync_pkg_settings()}(c.this_domain),c.this_domain.modified=!1),function(e){c.stats.email={accounts:t.maketext("[quant,_1,Email account,Email accounts]",e.number_of_email_accounts),forwarders:t.maketext("[quant,_1,Forwarder,Forwarders]",e.number_of_email_forwarders+e.number_of_domain_forwarders),autoresponders:t.maketext("[quant,_1,Autoresponder,Autoresponders]",e.number_of_autoresponders)}}(c.this_domain.details),c.move_email_category=c.this_domain.move_options["email-accounts"]||c.this_domain.move_options["email-forwarders"]||c.this_domain.move_options.autoresponders,c.disable_email_button=c.this_domain.details.number_of_email_accounts+c.this_domain.details.number_of_domain_forwarders+c.this_domain.details.number_of_email_forwarders+c.this_domain.details.number_of_autoresponders===0,c.move_db_category=c.this_domain.move_options.mysql_dbs.length||c.this_domain.move_options.mysql_users.length,c.copy_mysql_dbs="copy"===c.this_domain.move_options.db_move_type,c.move_website_data=c.this_domain.move_options.docroot||c.this_domain.move_options["custom-vhost-includes"]||c.this_domain.move_options["copy-installed-ssl-cert"],c.move_subaccount_category=c.this_domain.move_options["ftp-accounts"]||c.this_domain.move_options["webdisk-accounts"],c.selected_dbs_message=c.copy_mysql_dbs?t.maketext("You selected the following [asis,MySQL] databases to copy:"):t.maketext("You selected the following [asis,MySQL] databases to move:"),e.all([r.getDatabases(c.this_domain.owner),d.listPackages()]).then((function(e){c.enable_db_button=Object.keys(e[0]).length>0,c.account_packages=e[1];for(var t=0,o=c.account_packages.length;t<o;t++)c.account_packages[t].name&&c.account_packages[t].name===c.this_domain.account_settings.pkgname&&(c.selected_package=c.account_packages[t]);""===c.this_domain.account_settings.pkgname&&(c.selected_package=c.account_packages[0]),c.sync_pkg_settings()})).catch((function(e){var t=e.errors.length;t>1&&a.error(e.reason);for(var o=0;o<t;o++)a.error(e.errors[o])})).finally((function(){c.ui.domain_exists=!0}));c.domain_name=n.addondomain,c.ui.domain_exists=!1})).finally((function(){c.ui.is_loading=!1}))}])})),define("app/views/docroot",["angular","cjt/util/locale","cjt/decorators/growlDecorator","app/services/ConvertAddonData"],(function(e,t){return e.module("App").controller("docrootController",["$anchorScroll","$location","$routeParams","growl","ConvertAddonData",function(e,o,n,i,a){var s=this;s.loading=!0,s.moveIt=!1,s.moveVhostIncludes=!1,s.copySSLCert=!1,s.sslCertInstalled=!1,s.addonDomain="",s.domainData={},s.noSSLCertTooltip=t.maketext("The domain does not have an [asis,SSL] certificate installed."),s.load=function(){return a.getAddonDomainDetails(s.addonDomain).then((function(e){s.moveIt=e.move_options.docroot,s.moveVhostIncludes=e.move_options["custom-vhost-includes"],s.sslCertInstalled=1===e.details.has_ssl_cert_installed,s.copySSLCert=e.move_options["copy-installed-ssl-cert"]&&s.sslCertInstalled,s.domainData=e}),(function(e){i.error(e)})).finally((function(){s.loading=!1}))},s.goToOverview=function(){return o.path("/convert/"+s.addonDomain+"/migrations")},s.save=function(){s.domainData.modified=!0,s.domainData.move_options.docroot=s.moveIt,s.domainData.move_options["custom-vhost-includes"]=s.moveVhostIncludes,s.domainData.move_options["copy-installed-ssl-cert"]=s.copySSLCert,s.goToOverview()},s.cancel=function(){s.goToOverview()},s.init=function(){s.addonDomain=n.addondomain,s.load()},s.init()}])})),define("app/views/dns",["angular","cjt/util/locale","cjt/decorators/growlDecorator","app/services/ConvertAddonData"],(function(e,t){return e.module("App").controller("dnsSelectionController",["$anchorScroll","$location","$routeParams","growl","ConvertAddonData",function(e,t,o,n,i){var a=this;a.loading=!0,a.moveIt=!0,a.addonDomain="",a.domainData={},a.load=function(){return i.getAddonDomainDetails(a.addonDomain).then((function(e){a.moveIt=e.move_options["custom-dns-records"],a.domainData=e}),(function(e){n.error(e)})).finally((function(){a.loading=!1}))},a.goToOverview=function(){return t.path("/convert/"+a.addonDomain+"/migrations")},a.save=function(){a.domainData.modified=!0,a.domainData.move_options["custom-dns-records"]=a.moveIt,a.goToOverview()},a.cancel=function(){a.goToOverview()},a.init=function(){a.addonDomain=o.addondomain,a.load()},a.init()}])})),define("app/views/email_options",["angular","cjt/util/locale","cjt/decorators/growlDecorator","app/services/ConvertAddonData"],(function(e,t){return e.module("App").controller("emailSelectionController",["$scope","$q","$location","$routeParams","ConvertAddonData",function(e,o,n,i,a){var s=this;s.ui={},s.ui.is_loading=!1,s.ui.domain_exists=!1,s.this_domain={},s.stats={},s.noEmailAccountsTooltip=t.maketext("The domain does not have email accounts."),s.noAutorespondersTooltip=t.maketext("The domain does not have autoresponders."),s.noForwardersTooltip=t.maketext("The domain does not have email forwarders."),s.saveOptions=function(){return s.this_domain.modified=!0,s.this_domain.move_options["email-accounts"]=s.email_accounts,s.this_domain.move_options["email-forwarders"]=s.email_forwarders,s.this_domain.move_options.autoresponders=s.autoresponders,n.path("/convert/"+s.domain_name+"/migrations")},s.goBack=function(){return n.path("/convert/"+s.domain_name+"/migrations")},s.ui.is_loading=!0,a.getAddonDomain(i.addondomain).then((function(e){Object.keys(e).length?(s.domain_name=e.addon_domain,s.this_domain=e,void 0===e.details.number_of_email_forwarders&&(e.details.number_of_email_forwarders=0),void 0===e.details.number_of_domain_forwarders&&(e.details.number_of_domain_forwarders=0),void 0===e.details.number_of_email_accounts&&(e.details.number_of_email_accounts=0),void 0===e.details.number_of_autoresponders&&(e.details.number_of_autoresponders=0),s.email_accounts=e.move_options["email-accounts"],s.email_forwarders=e.move_options["email-forwarders"],s.autoresponders=e.move_options.autoresponders,0===e.details.number_of_email_accounts&&(s.webmail_data=!1),function(e){s.stats={accounts:t.maketext("[quant,_1,Email account,Email accounts]",e.number_of_email_accounts),emailForwarders:t.maketext("[quant,_1,Email forwarder,Email forwarders]",e.number_of_email_forwarders),domainForwarders:t.maketext("[quant,_1,Domain forwarder,Domain forwarders]",e.number_of_domain_forwarders),autoresponders:t.maketext("[quant,_1,Autoresponder,Autoresponders]",e.number_of_autoresponders)}}(s.this_domain.details),s.total_forwarders=e.details.number_of_email_forwarders+e.details.number_of_domain_forwarders,s.ui.domain_exists=!0):(s.domain_name=i.addondomain,s.ui.domain_exists=!1)})).finally((function(){s.ui.is_loading=!1}))}])})),define("app/models/dynamic_table",["lodash","cjt/util/locale"],(function(e,t){function o(){this.items=[],this.filteredList=this.items,this.selected=[],this.allDisplayedRowsSelected=!1,this.filterFunction=void 0,this.meta={sortBy:"",sortDirection:"asc",maxPages:0,totalItems:this.items.length,pageNumber:1,pageSize:10,pageSizes:[10,20,50,100],start:0,limit:10,filterValue:""}}return o.prototype.loadData=function(e){this.items=e;for(var t=0,o=this.items.length;t<o;t++)this.items[t]._id=t,this.items[t].selected&&this.selected.push(this.items[t]._id)},o.prototype.setFilterFunction=function(t){e.isFunction(t)&&(this.filterFunction=t)},o.prototype.setSort=function(e,t){void 0!==e&&(this.meta.sortBy=e),void 0!==t&&(this.meta.sortDirection=t)},o.prototype.getMetadata=function(){return this.meta},o.prototype.getList=function(){return this.filteredList},o.prototype.getSelectedList=function(){return this.items.filter((function(e){return e.selected}))},o.prototype.areAllDisplayedRowsSelected=function(){return this.allDisplayedRowsSelected},o.prototype.getTotalRowsSelected=function(){return this.selected.length},o.prototype.selectAllDisplayed=function(t){if(t)for(var o=0,n=this.filteredList.length;o<n;o++){var i=this.filteredList[o];i.selected=!0,-1===this.selected.indexOf(i._id)&&this.selected.push(i._id)}else{var a=this.filteredList.map((function(e){return e.selected=!1,e._id}));this.selected=e.difference(this.selected,a)}this.allDisplayedRowsSelected=t},o.prototype.selectItem=function(e){if(void 0!==e)if(e.selected){if(-1!==this.selected.indexOf(e._id))return;this.selected.push(e._id),this.allDisplayedRowsSelected=this.filteredList.every((function(e){return e.selected}))}else this.selected=this.selected.filter((function(t){return t!==e._id})),this.allDisplayedRowsSelected=!1},o.prototype.clearAllSelections=function(){this.selected=[];for(var e=0,t=this.items.length;e<t;e++){this.items[e].selected=!1}this.allDisplayedRowsSelected=!1},o.prototype.clear=function(){this.items=[],this.selected=[],this.allDisplayedRowsSelected=!1,this.filteredList=this.populate()},o.prototype.populate=function(){var t=[],o=this;if(t=""!==this.meta.filterValue&&e.isFunction(this.filterFunction)?this.items.filter((function(e){return o.filterFunction(e,o.meta.filterValue)})):this.items,""!==this.meta.sortDirection&&""!==this.meta.sortBy&&(t=e.orderBy(t,[this.meta.sortBy],[this.meta.sortDirection])),this.meta.totalItems=t.length,this.meta.totalItems>e.min(this.meta.pageSizes)){var n=(this.meta.pageNumber-1)*this.meta.pageSize,i=this.meta.pageNumber*this.meta.pageSize;t=e.slice(t,n,i),this.meta.start=n+1,this.meta.limit=n+t.length}else 0===t.length?this.meta.start=0:this.meta.start=1,this.meta.limit=t.length;for(var a=0,s=0,r=t.length;s<r;s++){var d=t[s];-1!==this.selected.indexOf(d._id)?d.selected=!0:(d.selected=!1,a++)}return this.filteredList=t,this.allDisplayedRowsSelected=t.length>0&&0===a,t},o.prototype.paginationMessage=function(){return t.maketext("Displaying [numf,_1] to [numf,_2] out of [quant,_3,item,items]",this.meta.start,this.meta.limit,this.meta.totalItems)},o})),define("app/directives/db_name_validators",["angular","cjt/validator/validator-utils","cjt/util/locale","cjt/validator/validateDirectiveFactory","app/services/Databases"],(function(e,t,o,n,i){var a={mysqlDbName:function(e){var o=t.initializeValidationResult();try{CPANEL.sql.verify_mysql_database_name(e),o.isValid=!0}catch(e){o.isValid=!1,o.add("db",e)}return o},postgresqlDbName:function(e){var o=t.initializeValidationResult();try{CPANEL.sql.verify_postgresql_database_name(e),o.isValid=!0}catch(e){o.isValid=!1,o.add("db",e)}return o}};return e.module("cjt2.validate").run(["validatorFactory","Databases",function(e,t){e.generate(a)}]),{methods:a,name:"dbNameValidators",description:"Validation directives for db names.",version:11.56}})),define("app/views/db_options",["angular","lodash","cjt/util/locale","app/models/dynamic_table","cjt/decorators/growlDecorator","cjt/decorators/paginationDecorator","cjt/directives/toggleSortDirective","cjt/directives/searchDirective","cjt/directives/pageSizeDirective","cjt/filters/startFromFilter","app/services/ConvertAddonData","app/services/Databases","app/directives/db_name_validators"],(function(e,t,o,n){return e.module("App").controller("databaseSelectionController",["$q","$location","$routeParams","growl","ConvertAddonData","Databases","$anchorScroll",function(e,o,i,a,s,r,d){var l=this;l.ui={},l.ui.is_loading=!1,l.ui.domain_exists=!1,l.this_domain={},l.is_prefixing_enabled=void 0,l.move_type="move",l.database_name_max_length=CPANEL.sql.get_name_length_limit("mysql","database");var c=new n;c.setSort("db_name");var u=new n;u.setSort("user_name"),c.setFilterFunction((function(e,t){return-1!==e.db_name.indexOf(t)})),u.setFilterFunction((function(e,t){return-1!==e.user_name.indexOf(t)})),l.dbs={checkDropdownOpen:!1,allRowsSelected:c.areAllDisplayedRowsSelected(),meta:c.getMetadata(),filteredList:c.getList(),totalSelected:c.getTotalRowsSelected(),paginationMessage:c.paginationMessage,fetch:function(){l.dbs.filteredList=c.populate(),l.dbs.allRowsSelected=c.areAllDisplayedRowsSelected(),l.dbs.totalSelected=c.getTotalRowsSelected()},sortList:function(){l.dbs.fetch()},selectPage:function(){l.dbs.fetch()},selectPageSize:function(){l.dbs.fetch()},searchList:function(){l.dbs.fetch()},selectAll:function(e){c.selectAllDisplayed(e),l.dbs.fetch(),l.dbs.allRowsSelected=c.areAllDisplayedRowsSelected(),l.dbs.totalSelected=c.getTotalRowsSelected()},selectDb:function(e){c.selectItem(e),l.dbs.allRowsSelected=c.areAllDisplayedRowsSelected(),l.dbs.totalSelected=c.getTotalRowsSelected()},clearAllSelections:function(e){e.preventDefault(),e.stopPropagation(),c.clearAllSelections(),l.dbs.checkDropdownOpen=!1,l.dbs.allRowsSelected=c.areAllDisplayedRowsSelected(),l.dbs.totalSelected=c.getTotalRowsSelected()}},l.users={checkDropdownOpen:!1,allRowsSelected:u.areAllDisplayedRowsSelected(),meta:u.getMetadata(),filteredList:u.getList(),totalSelected:u.getTotalRowsSelected(),paginationMessage:u.paginationMessage,fetch:function(){l.users.filteredList=u.populate(),l.users.allRowsSelected=u.areAllDisplayedRowsSelected(),l.users.totalSelected=u.getTotalRowsSelected()},sortList:function(){l.users.fetch()},selectPage:function(){l.users.fetch()},selectPageSize:function(){l.users.fetch()},searchList:function(){l.users.fetch()},selectAll:function(e){u.selectAllDisplayed(e),l.users.fetch(),l.users.allRowsSelected=u.areAllDisplayedRowsSelected(),l.users.totalSelected=u.getTotalRowsSelected()},selectUser:function(e){u.selectItem(e),l.users.allRowsSelected=u.areAllDisplayedRowsSelected(),l.users.totalSelected=u.getTotalRowsSelected()},clearAllSelections:function(e){e.preventDefault(),e.stopPropagation(),u.clearAllSelections(),l.users.checkDropdownOpen=!1,l.users.allRowsSelected=u.areAllDisplayedRowsSelected(),l.users.totalSelected=u.getTotalRowsSelected()}},l.disableSave=function(e){return e.$dirty&&e.$invalid},l.saveOptions=function(e){if(e.$valid){l.this_domain.modified=!0;var t=c.getSelectedList();if(l.this_domain.move_options.db_move_type=l.move_type,l.this_domain.move_options.mysql_dbs=t.map((function(e){return{name:e.db_name,new_name:e.db_new_name}})),"move"===l.this_domain.move_options.db_move_type){var n=u.getSelectedList();l.this_domain.move_options.mysql_users=n.map((function(e){return{name:e.user_name}}))}else l.this_domain.move_options.mysql_users=[];return o.path("/convert/"+l.domain_name+"/migrations")}},l.goBack=function(){return o.path("/convert/"+l.domain_name+"/migrations")},l.init=function(){l.ui.is_loading=!0,s.getAddonDomain(i.addondomain).then((function(e){if(Object.keys(e).length)return l.domain_name=e.addon_domain,l.this_domain=e,e.move_options.db_move_type&&(l.move_type=e.move_options.db_move_type),r.getDatabases(l.this_domain.owner).then((function(e){!function(e){var o,n=l.this_domain.move_options.mysql_dbs&&l.this_domain.move_options.mysql_dbs.length>0,i=r.createPrefix(l.this_domain.account_settings.username),a=[];for(var s in e)e.hasOwnProperty(s)&&(n&&void 0!==(o=t.find(l.this_domain.move_options.mysql_dbs,{name:s}))?a.push({db_name:s,db_users:e[s],selected:!0,db_new_name:o.new_name,db_prefix:i}):a.push({db_name:s,db_users:e[s],selected:!1,db_new_name:"",db_prefix:i}),o=void 0);c.loadData(a)}(e),function(e){var o=l.this_domain.move_options.mysql_users&&l.this_domain.move_options.mysql_users.length>0,n=[];for(var i in e)e.hasOwnProperty(i)&&(o&&void 0!==t.find(l.this_domain.move_options.mysql_users,{name:i})?n.push({user_name:i,user_databases:e[i],selected:!0}):n.push({user_name:i,user_databases:e[i],selected:!1}));u.loadData(n)}(r.getUsers()),l.is_prefixing_enabled=r.isPrefixingEnabled(),l.is_prefixing_enabled&&(l.database_name_max_length-=r.getPrefixLength()),l.dbs.fetch(),l.users.fetch(),l.ui.domain_exists=!0})).catch((function(e){var t=e.errors.length;t>1&&a.error(e.reason);for(var o=0;o<t;o++)a.error(e.errors[o])}));l.domain_name=i.addondomain,l.ui.domain_exists=!1})).finally((function(){l.ui.is_loading=!1,o.hash("pageContainer"),d()}))},l.init()}])})),define("app/views/conversion_detail",["angular","cjt/util/locale","cjt/decorators/growlDecorator","app/services/conversion_history"],(function(e,t){return e.module("App").controller("conversionDetailController",["$anchorScroll","$location","$routeParams","growl","ConversionHistory","$timeout",function(e,o,n,i,a,s){var r=this;r.loading=!0,r.jobId=0,r.conversionData={},r.progressBarType="info",r.currentProgressMessage="",r.splitWarnings=function(e){return e?e.split("\n"):null},r.viewHistory=function(){o.path("/history/")},r.viewAddons=function(){o.path("/main")},r.updateSteps=function(){return a.getDetails(r.jobId,r.currentStep).then((function(e){if(r.conversionData.hasOwnProperty("domain")){var o=r.conversionData.steps.length,n=e.steps.length;if(o<n){r.conversionData.steps[o-1].status=e.steps[o-1].status,e.steps[o-1].warnings&&(r.conversionData.steps[o-1].warnings=e.steps[o-1].warnings);var i=e.steps.slice(o);r.conversionData.steps=r.conversionData.steps.concat(i),"FAILED"===e.job_status?r.progressBarType="danger":"DONE"===e.job_status?r.progressBarType="success":r.progressBarType="info",r.currentProgressMessage=r.conversionData.steps[r.conversionData.steps.length-1].step_name}if(!e.job_end_time||"INPROGRESS"===e.steps[n-1].status)return s((function(){return r.updateSteps()}),2e3);r.conversionData.job_status=e.job_status,r.conversionData.job_end_time=e.job_end_time,"DONE"===r.conversionData.job_status?(r.currentProgressMessage=t.maketext("Conversion Completed"),r.progressBarType="success"):"FAILED"===r.conversionData.job_status&&(r.currentProgressMessage=t.maketext("Conversion Failed"),r.progressBarType="danger")}else{for(var a in e)if(e.hasOwnProperty(a)){if("steps"===a)continue;r.conversionData[a]=e[a]}if(r.conversionData.steps=e.steps.slice(),"INPROGRESS"===r.conversionData.job_status)return r.currentProgressMessage=r.conversionData.steps[r.conversionData.steps.length-1].step_name,r.progressBarType="info",s((function(){return r.updateSteps()}),2e3);"DONE"===r.conversionData.job_status?(r.currentProgressMessage=t.maketext("Conversion Completed"),r.progressBarType="success"):(r.currentProgressMessage=t.maketext("Conversion Failed"),r.progressBarType="danger")}}),(function(e){i.error(e)}))},r.load=function(){r.loading=!0,r.updateSteps().finally((function(){r.loading=!1}))},r.goToHistory=function(){return o.path("/history")},r.init=function(){r.jobId=n.jobid,r.load()},r.init()}])})),define("app/views/subaccounts",["angular","cjt/util/locale","cjt/decorators/growlDecorator","app/services/ConvertAddonData"],(function(e,t){return e.module("App").controller("subaccountSelectionController",["$scope","$q","$location","$routeParams","ConvertAddonData",function(e,t,o,n,i){var a=this;a.ui={},a.ui.is_loading=!1,a.ui.domain_exists=!1,a.this_domain={},a.stats={},a.saveOptions=function(){return a.this_domain.modified=!0,a.this_domain.move_options["ftp-accounts"]=a.ftp_accounts,a.this_domain.move_options["webdisk-accounts"]=a.webdisk_accounts,o.path("/convert/"+a.domain_name+"/migrations")},a.goBack=function(){return o.path("/convert/"+a.domain_name+"/migrations")},a.ui.is_loading=!0,i.getAddonDomain(n.addondomain).then((function(e){Object.keys(e).length?(a.domain_name=e.addon_domain,a.this_domain=e,a.ftp_accounts=e.move_options["ftp-accounts"],a.webdisk_accounts=e.move_options["webdisk-accounts"],a.ui.domain_exists=!0):(a.domain_name=n.addondomain,a.ui.domain_exists=!1)})).finally((function(){a.ui.is_loading=!1}))}])})),define("app/directives/job_status",["angular","cjt/util/locale","cjt/core"],(function(e,t,o){e.module("App").directive("jobStatus",[function(){var e="directives/job_status.phtml",n=t.maketext("In Progress"),i=t.maketext("Done"),a=t.maketext("Failed");function s(e,t){t.success=!1,t.error=!1,t.pending=!1,"INPROGRESS"===e?(t.label=n,t.pending=!0):"DONE"===e?(t.label=i,t.success=!0):"FAILED"===e?(t.label=a,t.error=!0):t.label=""}return{replace:!0,require:"ngModel",restrict:"E",scope:{ngModel:"="},templateUrl:o.config.debug?o.buildFullPath("templates/convert_addon_to_account/directives/job_status.phtml"):e,link:function(e,t,o){s(e.ngModel,e),e.$watch("ngModel",(function(t,o){t&&t!==o&&s(t,e)}))}}}])})),define("app/views/history",["angular","lodash","cjt/util/locale","app/models/dynamic_table","app/services/conversion_history","app/filters/local_datetime_filter","app/directives/job_status","cjt/decorators/growlDecorator","cjt/decorators/paginationDecorator","cjt/directives/toggleSortDirective","cjt/directives/searchDirective","cjt/directives/pageSizeDirective"],(function(e,t,o,n,i){"use strict";return e.module("App").controller("historyController",["$location","growl","ConversionHistory","$timeout","$scope",function(e,i,a,s,r){var d=this;d.ui={},d.ui.is_loading=!1,d.in_progress={},d.in_progress_timer=null;var l=new n;l.setSort("start_time"),l.setFilterFunction((function(e,t){return-1!==e.domain.indexOf(t)})),d.conversions={meta:l.getMetadata(),filteredList:l.getList(),paginationMessage:l.paginationMessage,fetch:function(){d.conversions.filteredList=l.populate()},sortList:function(){d.conversions.fetch()},selectPage:function(){d.conversions.fetch()},selectPageSize:function(){d.conversions.fetch()},searchList:function(){d.conversions.fetch()}},history.clearSearch=function(e){27===e.keyCode&&(history.conversions.meta.filterValue="",history.conversions.searchList())},d.conversions.meta.sortDirection="desc",d.updateStatusFor=function(e){return a.getJobStatus(e).then((function(n){for(var a in n)if(void 0!==d.in_progress[a]&&n[a].job_status!==d.in_progress[a].status&&(d.in_progress[a].status=n[a].job_status,"INPROGRESS"!==n[a].job_status)){d.in_progress[a].end_time=n[a].job_end_time;var r=d.in_progress[a].domain;"FAILED"===n[a].job_status?i.error(o.maketext("The conversion of the domain “[_1]” failed.",t.escape(r))):i.info(o.maketext("The conversion of the domain “[_1]” succeeded.",t.escape(r))),delete d.in_progress[a]}0!==Object.keys(d.in_progress).length&&(d.in_progress_timer=s((function(){d.updateStatusFor(e)}),1e3))}))},d.goToDetailsView=function(t){return e.path("/history/"+t+"/detail")},d.viewAddons=function(){e.path("/main")},d.init=function(){d.ui.is_loading=!0,a.load().then((function(e){l.loadData(e),d.conversions.fetch();for(var t=e.length,o=0;o<t;o++)"INPROGRESS"===e[o].status&&(d.in_progress[e[o].job_id]=e[o]);var n=Object.keys(d.in_progress);n.length>0&&(d.in_progress_timer=s((function(){d.updateStatusFor(n)}),1e3))})).catch((function(e){i.error(e.reason)})).finally((function(){d.ui.is_loading=!1}))},d.clearInProgress=function(){d.in_progress_timer&&(s.cancel(d.in_progress_timer),d.in_progress_timer=null),d.in_progress={}},d.forceLoadList=function(){l.clear(),d.clearInProgress(),d.init()},r.$on("$destroy",(function(){d.clearInProgress()})),d.init()}])})),define("app/index",["angular","jquery","cjt/core","cjt/modules","ngRoute","ngAnimate","uiBootstrap"],(function(e,t,o){return function(){return e.module("App",["cjt2.config.whm.configProvider","ngRoute","ngAnimate","ui.bootstrap","angular-growl","cjt2.whm"]),require(["cjt/bootstrap","app/services/pageDataService","app/services/ConvertAddonData","app/services/Databases","app/services/account_packages","app/services/conversion_history","app/filters/local_datetime_filter","app/views/main","app/views/move_options","app/views/docroot","app/views/dns","app/views/email_options","app/views/db_options","app/views/conversion_detail","app/views/subaccounts","app/views/history","app/directives/move_status","app/directives/job_status"],(function(t){var n=e.module("App");n.firstLoad={addonList:!0},n.factory("defaultInfo",["pageDataService",function(e){return e.prepareDefaultInfo(PAGE)}]),n.config(["$routeProvider","$anchorScrollProvider",function(e,t){t.disableAutoScrolling(),e.when("/main",{controller:"mainController",controllerAs:"main",templateUrl:o.buildFullPath("convert_addon_to_account/views/main.ptt")}),e.when("/convert/:addondomain/migrations",{controller:"moveSelectionController",controllerAs:"move_options_vm",templateUrl:o.buildFullPath("convert_addon_to_account/views/move_options.ptt")}),e.when("/convert/:addondomain/migrations/edit/docroot",{controller:"docrootController",controllerAs:"docroot",templateUrl:o.buildFullPath("convert_addon_to_account/views/docroot.ptt")}),e.when("/convert/:addondomain/migrations/edit/email",{controller:"emailSelectionController",controllerAs:"email_selection_vm",templateUrl:o.buildFullPath("convert_addon_to_account/views/email_options.ptt")}),e.when("/convert/:addondomain/migrations/edit/databases",{controller:"databaseSelectionController",controllerAs:"db_selection_vm",templateUrl:o.buildFullPath("convert_addon_to_account/views/db_options.ptt")}),e.when("/convert/:addondomain/migrations/edit/dns",{controller:"dnsSelectionController",controllerAs:"dns",templateUrl:o.buildFullPath("convert_addon_to_account/views/dns.ptt")}),e.when("/convert/:addondomain/migrations/edit/subaccounts",{controller:"subaccountSelectionController",controllerAs:"sub_vm",templateUrl:o.buildFullPath("convert_addon_to_account/views/subaccounts.ptt")}),e.when("/history",{controller:"historyController",controllerAs:"history",templateUrl:o.buildFullPath("convert_addon_to_account/views/history.ptt")}),e.when("/history/:jobid/detail",{controller:"conversionDetailController",controllerAs:"detail",templateUrl:o.buildFullPath("convert_addon_to_account/views/conversion_detail.ptt")}),e.otherwise({redirectTo:"/main"})}]),n.run(["$rootScope","$anchorScroll","$timeout","$location","growl","growlMessages",function(e,t,o,n,i,a){t.yOffset=41}]),t(document)}))}}));