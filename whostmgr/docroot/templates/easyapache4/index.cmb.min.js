define("app/services/ea4Util",["angular","cjt/util/locale","lodash","cjt/io/api","cjt/io/whm-v1-request","cjt/io/whm-v1","cjt/services/APIService"],(function(e,t,a){"use strict";e.module("whm.easyapache4.ea4Util",[]).factory("ea4Util",["wizardState",function(i){var n={eaRegex:/^ea-/i,phpVerRegex:/^ea-php(\d{2})$/i,phpExtRegex:/^ea-php(\d{2}-)/i,apacheVerRegex:/^ea-apache(\d{2})$/i,rubyVerRegex:/^ea-ruby(\d{2})/i,apacheModulesRegex:/^ea-apache(\d{2}-)/i,additionalPkgList:[],defaultMeta:{filterList:{},filterValue:"",isEmptyList:!1,showPager:!0,maxPages:0,totalItems:0,currentPage:1,pageSize:10,pageSizes:[10,20,50,100],start:0,limit:10},pkgActions:{removeList:[],addList:[],actionNeeded:!1},vhostWarning:{exist:!1,text:""},multiRequirements:{exist:!1,orList:[],chosenPackage:""},autoSelectExt:{list:[],text:"",errorList:[],show:!1,showError:!1,showCommonExtensions:!1},checkUpdateInfo:{isLoading:!0,pkgNumber:0,btnText:t.maketext("Checking for updates …"),btnTitle:t.maketext("Checking for updates …"),btnCss:"btn-ea4-looking-updates disabled"},gatherAllRequirementsOfPkgs:function(e,t){var i=[];return a.each(e,(function(e){if(!a.includes(i,e)){var o=t[e];void 0!==o&&(i=n.recurseForRequires(o,e,i,t)),i.push(e)}})),i},recurseForRequires:function(e,t,i,o){var s=e.package;if(n.eaRegex.test(s)&&!a.includes(i,s)){void 0!==t&&s!==t&&i.push(s);var r=[];return e.pkg_dep.requires.length>0&&(r=a.clone(e.pkg_dep.requires),r=a.filter(r,(function(e){return n.eaRegex.test(e)&&!a.isArray(e)})),r=a.difference(r,i)),a.forEach(r,(function(e){var a=o[e];void 0!==a&&n.recurseForRequires(a,t,i,o)})),i}},getFormattedPackageList:function(e,t){var i=[];return(i=a.map(e,(function(e){return n._getReadableName(e,t)}))).sort(),i},getFormattedPackageName:function(e,t){return n._getReadableName(e,t)},_getReadableName:function(e,t){var a=e;return"php"===(a=void 0!==t&&""!==t?e.replace(t,""):n.apacheModulesRegex.test(e)?e.replace(n.apacheModulesRegex,""):e.replace(n.eaRegex,""))&&(a="php (DSO)"),a},getProfilePackagesByCategories:function(e){return n._pkgByCategory(e)},_pkgByCategory:function(e){var i={},o=[],s=[],r=[],c=[],l="";return a.each(e,(function(e){n.apacheVerRegex.test(e)?l=e:n.apacheModulesRegex.test(e)?o=a.concat(o,e):n.phpVerRegex.test(e)?c=a.concat(c,e):n.phpExtRegex.test(e)?s=a.concat(s,e):r=a.concat(r,e)})),o.length>0&&(l=n._getReadableName(l,n.eaRegex),i[l]={name:n.versionToString(l),packages:n.getFormattedPackageList(o,n.apacheModulesRegex)}),c.length>0&&a.each(c.sort(),(function(e){var t=new RegExp("^"+e),o=a.remove(s,(function(e){return t.test(e)})),r=n._getReadableName(e,n.eaRegex);i[r]={name:n.versionToString(r).replace("Php","PHP"),packages:n.getFormattedPackageList(o,n.phpExtRegex)}})),r.length>0&&(i.others={name:t.maketext("Additional Packages"),packages:n.getFormattedPackageList(r,n.eaRegex)}),i},versionToString:function(e){return e.replace(/^([a-z]+)(\d)(\d)$/,(function(e,t,i,n){return a.capitalize(t)+" "+i+"."+n}))},getPackageLabel:function(e,t){var a="";return e?"updatable"===t?a="Update":"installed"!==t&&"updatable"!==t?a="Install":"installed"===t&&(a="Unaffected"):"installed"!==t&&"updatable"!==t||(a="Uninstall"),a},getPackageClass:function(e,t){var a;return e?(a="callout",a+="updatable"===t?" callout-info":" callout-success"):a="installed"===t||"updatable"===t?"callout callout-warning":"no-callout",a},getDefaultMetaData:function(){return a.clone(n.defaultMeta)},getDefaultPageSizes:function(){return n.defaultMeta.pageSizes},getUpdatedMetaData:function(e,t){if(void 0!==e&&a.keys(e).length<=0)return t.isEmptyList=!0,t.totalItems=0,t;var i=t.filterValue;if(i){var o=new RegExp(".*"+i+".*","i");e=a.pickBy(e,(function(e,t){return o.test(e.package)||o.test(e.short_description)}))}var s=a.keys(e),r=n.getDefaultPageSizes();r=a.filter(r,(function(e){return e<=s.length})),t.pageSizes=r;var c=s.length;if(c>a.min(r)){var l=(t.currentPage-1)*t.pageSize,u=l+t.pageSize;u=u>c?c:u,e=a.pick(e,a.slice(s,l,u)),t.start=l+1,t.limit=u,t.showPager=!0}else t.showPager=!1,0===s.length?t.start=0:t.start=1,t.limit=s.length;return t.totalItems=c,t.filterList=e,t.isEmptyList=a.keys(t.filterList).length<=0,t},getPageShowingText:function(e){var a="";return e&&void 0!==e.start&&void 0!==e.limit&&void 0!==e.totalItems&&(a=t.maketext("[output,strong,Showing] [_1] - [_2] of [_3] items",e.start,e.limit,e.totalItems)),a},getExtensionsForPHPVersion:function(e,t){var i=new RegExp(e+".*","i");return a.filter(t,(function(e){return i.test(e)}))},decideShowHideRecommendations:function(e,i,o,s){return a.each(e,(function(e){if(!a.isUndefined(e)&&(e.show=void 0!==o&&(o?"add"===e.on:"remove"===e.on),e.show)){var r=s;n.phpVerRegex.test(s)&&(r=n._getReadableName(s,n.eaRegex),r=n.versionToString(r).replace("Php","PHP"));var c=t.makevar(e.name);e.displayName=t.maketext("Recommendations for “[_1]”: [_2]",r,c),e.desc=t.makevar(e.desc),e.showFootnote=!1;var l=!0;a.each(e.options,(function(n){a.isNil(n.recommended)||(n.title=n.recommended?t.maketext("Recommended"):t.maketext("Not Recommended")),n.text=t.makevar(n.text),n.show=!0,a.isEmpty(n.items)?n.show=l:(l=n.show=a.isEmpty(a.intersection(n.items,i)),e.showFootnote||(e.showFootnote=n.show))})),e.show=!a.every(e.options,["show",!1])}})),e},getExtensionsOfSelectedPHPVersions:function(e,t,i){var o=[],s=!1,r=a.filter(a.keys(e),(function(e){return n.phpVerRegex.test(e)})).sort(),c=a.filter(i,(function(e){return n.phpVerRegex.test(e)})).sort();if(a.isEqual(r,c))c=r,o=a.keys(t);else if(c.length>0){var l=a.keys(t);a.each(c,(function(e){var t=new RegExp(e+".*","i"),i=a.remove(l,(function(e){return t.test(e)}));o=a.concat(o,i)}))}else s=!0;return{versions:c,extensions:o,noPHPSelected:s}},validateFilename:function(e){var a={valid:!0,valMsg:""};return/^\.{1,2}$/.test(e)?(a.valid=!1,a.valMsg=t.maketext("Filename [output,strong,cannot] be “[output,strong,_1]”.",e)):/\/|\0/.test(e)&&(a.valid=!1,a.valMsg=t.maketext("Filename [output,strong,cannot] include the following characters: [list_and,_1]",["/","NUL"])),a},setupVhostWarning:function(e,a){e.vhostWarning.exist=!0;var i=t.maketext("[quant,_1,virtual host currently uses,virtual hosts currently use] this version of PHP. If you remove this PHP version, your virtual hosts may not work properly.",a);return i=i.replace(/^(\d+)/,"<span class='vhost-emphasis'>$1</span>"),e.vhostWarning.text=i,e},resetVhostWarning:function(t){t.vhostWarning=e.copy(n.vhostWarning)},createTagsForActiveProfile:function(e){var t=[],i=!1;return a.each(e,(function(e){var o,s=e.match(n.apacheVerRegex);if(s){o="Apache "+s[1].replace(/(\d)(\d)$/,"$1.$2"),t=a.concat(t,o)}else{var r=e.match(n.phpVerRegex);if(r)o="PHP "+r[1].replace(/(\d)(\d)$/,"$1.$2"),t=a.concat(t,o);var c=e.match(n.rubyVerRegex);if(c&&!i)o="Ruby "+c[1].replace(/(\d)(\d)$/,"$1.$2"),t=a.concat(t,o),i=!0}})),t},checkMPMRequirement:function(e,i,n,o){var s=/mod[-_]mpm/,r=a.filter(a.uniq(i.removeList),(function(e){return s.test(e)}));!o&&s.test(e.package)&&(r=a.union(r,[e.package]));var c=a.difference(n,r),l=a.findIndex(c,(function(e){return s.test(e)})),u=a.findIndex(i.addList,(function(e){return s.test(e)}));return-1===l&&-1===u&&(e.mpmMissing=!0,e.mpmMissingMsg=t.maketext("Your selection removed [list_and,_1].",r)+" "+t.maketext("An [asis,MPM] package must exist on your system. Click “Continue” to select a new [asis,MPM] package.")+" "+t.maketext("Click “Cancel” to cancel this operation."),e.actions.actionNeeded=!1),e},getCommonlyInstalledExtensions:function(e,t){var i=a.map(a.filter(e,["selectedPackage",!0]),"package"),o=[];a.each(t,(function(e,t){o[t]=a.chain(i).filter((function(t){return a.startsWith(t,e)})).map((function(e){return a.replace(e,n.phpExtRegex,"")})).value()}));var s=[];if(1===o.length)s=o[0];else for(var r=0,c=o.length;r<c-1;r++)s=s.length>0?a.intersection(s,o[r+1]):a.intersection(o[r],o[r+1]);return a.pullAll(s,["php","scldevel"]),s},doRubyPkgsExist:function(e){return a.some(e,(function(e){return n.rubyVerRegex.test(e.package)}))},doAdditionalPkgsExist:function(e,t){return a.some(e,(function(e){return a.includes(a.keys(t),e)}))},showFooter:function(){i.showFooter=!0},hideFooter:function(){i.showFooter=!1}};return n}])})),define("app/services/ea4Data",["angular","lodash","cjt/io/api","cjt/io/whm-v1-request","cjt/io/whm-v1","cjt/services/APIService","app/services/ea4Util"],(function(e,t,a,i){"use strict";e.module("whm.easyapache4.ea4Data",[]).factory("ea4Data",["$q","$location","ea4Util","APIService",function(e,n,o,s){var r={isReadyForProvision:!1,mpmRegex:/ea-apache24-mod[_-]mpm.*/i,modulesRegex:/ea-apache24-mod.*/i,phpRegex:/^ea-php\d{2}$/i,phpExtRegex:/ea-php\d{2}-.*/i,rubyRegex:/ea-ruby\d{2}-.*/i,provisionReady:function(e){if("boolean"!=typeof e)return r.isReadyForProvision;r.isReadyForProvision=e},getProfiles:function(){var t=e.defer(),n=new i.Class;return n.initialize("","ea4_list_profiles"),a.promise(n.getRunArguments()).done((function(e){(e=e.parsedResponse).status?t.resolve(e.raw.data):t.reject(e.error)})),t.promise},getVhostsByPhpVersion:function(t){var n=e.defer(),o=new i.Class;return o.initialize("","php_get_vhosts_by_version"),o.addArgument("version",t),a.promise(o.getRunArguments()).done((function(e){(e=e.parsedResponse).status?n.resolve(e.data):n.reject(e.error)})),n.promise},ea4GetCurrentPkgList:function(){var e=new i.Class,t=new s;return e.initialize("","ea4_get_currently_installed_packages"),t.deferred(e).promise},getEA4MetaInfo:function(){var e=new i.Class,t=new s;return e.initialize("","ea4_metainfo"),t.deferred(e).promise},getPkgInfoForAdditionalPackages:function(e){var a={};return t.each(o.additionalPkgList,(function(t){var i=e[t];void 0!==i&&(a[t]=i)})),a},getPkgInfoSubset:function(e,t){var a;if("additional"===e)return r.getPkgInfoForAdditionalPackages(t);switch(e){case"mpm":a=r.mpmRegex;break;case"modules":a=r.modulesRegex;break;case"php":a=r.phpRegex;break;case"extensions":a=r.phpExtRegex;break;case"ruby":a=r.rubyRegex}return r.filterByRegex(a,t)},filterByRegex:function(e,a){var i={};if(void 0===e)return a;var n=t.filter(t.keys(a),(function(t){return e.test(t)}));return n.sort(),t.each(n,(function(e){i[e]=a[e]})),i},resolvePackages:function(n){var o=e.defer(),s=new i.Class;return s.initialize("","package_manager_resolve_actions"),s.addArgument("ns","ea"),t.each(n,(function(e,t){s.addArgument("package-"+t,e)})),a.promise(s.getRunArguments()).done((function(e){(e=e.parsedResponse).status?o.resolve(e.raw.data):o.reject(e.raw.metadata.reason)})),o.promise},doProvision:function(n,o,s,r){var c=e.defer(),l=new i.Class;return l.initialize("","package_manager_submit_actions"),t.each(n,(function(e,t){l.addArgument("install-"+t,e)})),t.each(o,(function(e,t){l.addArgument("uninstall-"+t,e)})),t.each(s,(function(e,t){l.addArgument("upgrade-"+t,e)})),a.promise(l.getRunArguments()).done((function(e){e=e.parsedResponse,c.resolve(e.raw.data)})),c.promise},tailingLog:function(t,n){var o=e.defer(),s=new i.Class;return s.initialize("","package_manager_get_build_log"),s.addArgument("build",t),s.addArgument("offset",n),a.promise(s.getRunArguments()).done((function(e){e=e.parsedResponse,o.resolve(e.raw.data)})),o.promise},getPkgInfoList:function(){var t=e.defer(),n=new i.Class;return n.initialize("","package_manager_get_package_info"),n.addArgument("ns","ea"),n.addArgument("disable-excludes","1"),a.promise(n.getRunArguments()).done((function(e){(e=e.parsedResponse).status?t.resolve(e.data):t.reject(e.error)})),t.promise},cancelOperation:function(){r.clearEA4LocalStorageItems(),n.path("profile")},clearEA4LocalStorageItems:function(){localStorage.removeItem("pkgInfoList"),localStorage.removeItem("selectedProfile"),localStorage.removeItem("selectedPkgs"),localStorage.removeItem("provisionActions"),localStorage.removeItem("customize"),localStorage.removeItem("ea4Recommendations"),localStorage.removeItem("ea4RawPkgList"),localStorage.removeItem("ea4Update"),o.hideFooter()},setData:function(e){t.each(t.keys(e),(function(t){var a=JSON.stringify(e[t]);localStorage.setItem(t,a)}))},getData:function(e){return JSON.parse(localStorage.getItem(e))},initPkgUIProps:function(e){return e.actions=o.pkgActions,e.recommendations=[],e.multiRequirements=o.multiRequirements,e.vhostWarning=o.vhostWarning,e.mpmMissing=!1,e.mpmMissingMsg="",e.autoSelectExt=[],e}};return r.buildPkgInfoList=function(e,a,i){var n={};return a=t.filter(a,(function(e){return!/.*\-debuginfo/.test(e.package)})),t.each(a,(function(e){var a=e.package;e=r.initPkgUIProps(e),t.isEmpty(i[a])||(e.recommendations=i[a]),e.selectedPackage=!1,e.displayName=o.getFormattedPackageName(a),n[a]=e})),n=function(e,a){var i=o.gatherAllRequirementsOfPkgs(e,a);return t.each(i,(function(e){void 0!==a[e]&&(a[e].selectedPackage=!0)})),a}(e,n)},r.fixYumCache=function(){var e=new i.Class,t=new s;return e.addArgument("ns","ea"),e.initialize("","package_manager_fixcache"),t.deferred(e).promise},r.saveAsNewProfile=function(n,o,s){var r=e.defer(),c=new i.Class;return c.initialize("","ea4_save_profile"),c.addArgument("filename",o),c.addArgument("name",n.name),c.addArgument("overwrite",s),c.addArgument("desc",n.desc||""),c.addArgument("version",n.version||""),t.each(n.pkgs,(function(e,t){c.addArgument("pkg-"+t,e)})),t.each(n.tags,(function(e,t){c.addArgument("tag-"+t,e)})),a.promise(c.getRunArguments()).done((function(e){(e=e.parsedResponse).status?r.resolve(e.data):r.reject(e)})),r.promise},r.getEA4Recommendations=function(){var e=new i.Class,t=new s;return e.initialize("","ea4_recommendations"),t.deferred(e).promise},r.getUploadContentFromUrl=function(t){var n=e.defer(),o=new i.Class;return o.initialize("","cors_proxy_get"),o.addArgument("url",t),a.promise(o.getRunArguments()).done((function(e){(e=e.parsedResponse).status?n.resolve(e.data):n.reject(e.error)})),n.promise},r.dataIsAvailable=function(){return!!r.getData("pkgInfoList")},r.getPkgInfoByType=function(e,t){var a=[];return e&&(a=r.getPkgInfoSubset(e,t)),a},{provisionReady:r.provisionReady,getProfiles:r.getProfiles,ea4GetCurrentPkgList:r.ea4GetCurrentPkgList,cancelOperation:r.cancelOperation,getPkgInfoForAdditionalPackages:r.getPkgInfoForAdditionalPackages,getPkgInfoSubset:r.getPkgInfoSubset,filterByRegex:r.filterByRegex,clearEA4LocalStorageItems:r.clearEA4LocalStorageItems,resolvePackages:r.resolvePackages,doProvision:r.doProvision,tailingLog:r.tailingLog,getPkgInfoList:r.getPkgInfoList,setData:r.setData,getData:r.getData,initPkgUIProps:r.initPkgUIProps,buildPkgInfoList:r.buildPkgInfoList,getVhostsByPhpVersion:r.getVhostsByPhpVersion,fixYumCache:r.fixYumCache,saveAsNewProfile:r.saveAsNewProfile,getEA4Recommendations:r.getEA4Recommendations,getUploadContentFromUrl:r.getUploadContentFromUrl,dataIsAvailable:r.dataIsAvailable,getPkgInfoByType:r.getPkgInfoByType,getEA4MetaInfo:r.getEA4MetaInfo}}])})),define("app/directives/eaWizard",["angular","cjt/core","lodash","cjt/util/locale","cjt/filters/qaSafeIDFilter","app/services/ea4Data","app/services/ea4Util"],(function(e,t,a,i){"use strict";e.module("App").directive("eaWizard",["$timeout","ea4Data","ea4Util","wizardApi","pkgResolution",function(n,o,s,r,c){var l="directives/eaWizard.ptt";return{replace:!0,restrict:"E",templateUrl:t.config.debug?t.buildFullPath("templates/easyapache4/directives/eaWizard.ptt"):l,scope:{idPrefix:"@",totalPackageInfoList:"=",selectedPackages:"=",metaData:"=",stepName:"@",stepIndex:"@",stepTitle:"@",stepPath:"@",stepNext:"@",onToggleFn:"&",showSearch:"@",showPagination:"@"},link:function(t,l,u){var d=function(e){e.multiRequirements.exist=!1;var a=e.multiRequirements.chosenPackage,i=c.continueResolvingDependencies(e,t.totalPackageInfoList[a],a,t.totalPackageInfoList,t.selectedPackages);return i.orListExist?(e.multiRequirements=c.setupMultiRequirementForUserInput(t.totalPackageInfoList),!1):i.actionNeeded?(e=c.setupConDepCallout(e,t.totalPackageInfoList),!1):t.applyDependency(e)},p=function(e){var i=t.php.commonExtensions;i=a.map(i,(function(t){return e+"-"+t}));var n,o,r,l=(n=e,o=[],(r=c.getAllDepsRecursively(!0,t.totalPackageInfoList[n],n,t.totalPackageInfoList,t.selectedPackages))&&(o=s.getExtensionsForPHPVersion(n,r.requiredPkgs)),o);return i=a.filter(i,(function(e){var i=!1;return void 0===t.totalPackageInfoList[e]||a.includes(l,e)||(i=!0),i})),a.map(i,(function(e){return{package:e,displayName:s.getFormattedPackageName(e),isSelected:!0}}))},f=function(a){var n,r,c=!a.selectedPackage,l=a.package;if(c){if(t.checkDependency(a),a.selectedPackage){a.autoSelectExt=e.copy(s.autoSelectExt),a.autoSelectExt.list=p(a.package);var u=a.autoSelectExt.list.length;a.autoSelectExt.text=i.maketext("In addition to the dependencies that this version of [asis,PHP] requires, the system detected [quant,_1,extension,extensions] of all other installed PHP versions that it will install for this version.",u);var d=(n=l.match(s.phpVerRegex),r="",n&&(r="PHP "+n[1].replace(/(\d)(\d)$/,"$1.$2")),r);a.autoSelectExt.okText=i.maketext("[_1][comment,package name] and Extensions[comment,action text]",d),a.autoSelectExt.cancelText=i.maketext("[_1][comment,package name] Only[comment,action text]",d),a.autoSelectExt.show=u>0&&!a.actions.actionNeeded}}else{var f=0;o.getVhostsByPhpVersion(l).then((function(e){(void 0!==e&&(f=e.length),f>0)?a=s.setupVhostWarning(a,f):t.checkDependency(a)&&t.php.updatePHPExtensionList(a)}),(function(e){})),a.autoSelectExt=e.copy(s.autoSelectExt)}};t.php={commonExtensions:[],updatePHPExtensionList:function(e){if(!e.selectedPackage){var i=s.getExtensionsForPHPVersion(e.package,t.selectedPackages);a.each(i,(function(e){void 0!==t.totalPackageInfoList[e]&&(t.totalPackageInfoList[e].selectedPackage=!1),a.pull(t.selectedPackages,e)}))}},continueCheckDependency:function(e){s.resetVhostWarning(e);var a=t.checkDependency(e);!e.selectedPackage&&a&&t.php.updatePHPExtensionList(e)},resetVhostWarning:function(e){return s.resetVhostWarning(e)}},t.extensions={_extToConsider:[],_extensionList:{},noPHPSelected:!1,filterPHPExtensions:function(){var e=t.phpVersions,i=[];a.each(e,(function(e){if(e.selected){var n=new RegExp(e.version+".*","i"),o=a.filter(t.extensions._extToConsider,(function(e){return n.test(e)}));i=a.union(i,o)}})),t.currPkgInfoList=a.pick(t.extensions._extensionList,i),t.applyMetaData()},showPhpFilterTags:function(){return"extensions"===t.stepName&&!a.isEmpty(t.extensions._extensionList)}},t.toggleLabel=function(e){return s.getPackageLabel(e.selectedPackage,e.state)},t.packageClass=function(e){return s.getPackageClass(e.selectedPackage,e.state)},t.applyDependency=function(e){var i=e.package,n=t.selectedPackages,r=c.getResolvedData();return e.mpmMissing=!1,e.mpmMissingMsg="",(!e.actions.actionNeeded||!(e=s.checkMPMRequirement(e,r,n,e.selectedPackage)).mpmMissing)&&(a.each(r.removeList,(function(e){a.pull(n,e),void 0!==t.totalPackageInfoList[e]&&(t.totalPackageInfoList[e].selectedPackage=!1)})),a.each(r.addList,(function(e){n=a.concat(n,e),void 0!==t.totalPackageInfoList[e]&&(t.totalPackageInfoList[e].selectedPackage=!0)})),e.selectedPackage||(a.pull(n,i),void 0!==t.totalPackageInfoList[i]&&(t.totalPackageInfoList[i].selectedPackage=!1)),t.selectedPackages=n,e=c.resetPkgResolveActions(e),o.setData({pkgInfoList:t.totalPackageInfoList}),!0)},t.checkDependency=function(e){var i,n=e.package,o=t.selectedPackages;if(e.actions={removeList:[],addList:[],actionNeeded:!1},e.selectedPackage=t.totalPackageInfoList[n].selectedPackage=i=!e.selectedPackage,e.recommendations=s.decideShowHideRecommendations(e.recommendations,t.selectedPackages,i,n),e.showRecommendations=!a.every(e.recommendations,["show",!1]),i){var r=c.resolveDependenciesWhenSelected(e,o,t.totalPackageInfoList);return r.orListExist?(e.multiRequirements=c.setupMultiRequirementForUserInput(t.totalPackageInfoList),!1):r.actionNeeded?(e=c.setupConDepCallout(e,t.totalPackageInfoList),!1):e.showRecommendations?(e.actions.actionNeeded=!0,!1):t.applyDependency(e)}if(c.resolveDependenciesWhenUnSelected(e,o,t.totalPackageInfoList),e.showRecommendations)return e.actions.actionNeeded=!0,!1;e.mpmMissing=!1,e.mpmMissingMsg="";var l=c.getResolvedData();return!(e=s.checkMPMRequirement(e,l,o,i)).mpmMissing&&t.applyDependency(e)},t.applyMetaData=function(){t.metaData=s.getUpdatedMetaData(t.currPkgInfoList,t.metaData)},t.getShowingText=function(){return s.getPageShowingText(t.metaData)},t.showSearchPageSection=function(){return"extensions"!==t.stepName||"extensions"===t.stepName&&!t.extensions.noPHPSelected},t.showEmptyMessage=function(){return"extensions"===t.stepName?!t.extensions.noPHPSelected&&t.metaData.isEmptyList:t.metaData.isEmptyList},t.showToggleSwitch=function(e){return"php"===t.stepName?!(e.actions.actionNeeded||e.multiRequirements.exist||e.mpmMissing||e.vhostWarning.exist):!e.actions.actionNeeded&&!e.multiRequirements.exist&&!e.mpmMissing},t.initializeSelection=function(e){"php"===t.stepName?f(e):t.checkDependency(e)},t.php.resetAutoSelectExtensions=function(t){t.autoSelectExt=e.copy(s.autoSelectExt)},t.php.performAutoSelect=function(e){var i=a.filter(e.autoSelectExt.list,["isSelected",!0]);a.each(i,(function(a){var i=a.package,n=t.selectedPackages,o=t.totalPackageInfoList[i];c.resetCommonVariables(),o.selectedPackage=true;var s=c.resolveDependenciesWhenSelected(o,n,t.totalPackageInfoList);if(!s.orListExist&&!s.actionNeeded)return t.applyDependency(o);o.selectedPackage=!1,e.autoSelectExt.errorList.push(i)})),e.autoSelectExt.errorList.length>0?e.autoSelectExt.showError=!0:t.php.resetAutoSelectExtensions(e)},t.continueProcess=function(e){return"php"===t.stepName?void((a=e).selectedPackage?d(a):d(a)&&t.php.updatePHPExtensionList(a)):d(e);var a},t.finalizeSelection=function(e){var a;"php"===t.stepName?(a=e).selectedPackage?(t.applyDependency(a),t.php.autoSelectExtList=p(a.package),a.autoSelectExt.show=a.autoSelectExt.list.length>0&&!a.actions.actionNeeded):t.applyDependency(a)&&t.php.updatePHPExtensionList(a):t.applyDependency(e)},t.resetSelection=function(e){e.selectedPackage=!e.selectedPackage,e=c.resetPkgResolveActions(e)},t.proceed=function(e){o.setData({pkgInfoList:t.totalPackageInfoList,selectedPkgs:t.selectedPackages}),r.next(e)};!function(){t.showSearch=!1,t.showPagination=!1;var e=r.getStepByName(t.stepName);if(void 0!==e&&(t.stepIndex=e.stepIndex||-1,t.stepPath=e.path||"",t.stepTitle=e.title||"",t.idPrefix=e.name||"eaWizard",t.stepNext=e.nextStep||""),t.currPkgInfoList=o.getPkgInfoByType(t.stepName,t.totalPackageInfoList),t.metaData=s.getDefaultMetaData(),t.applyMetaData(t.currPkgInfoList,t.metaData),n((function(){l.find("#wizard-step-title").focus()})),"extensions"===t.stepName){var i=t.currPkgInfoList,c=s.getExtensionsOfSelectedPHPVersions(t.totalPackageInfoList,i,t.selectedPackages);t.extensions.noPHPSelected=c.noPHPSelected,t.phpVersions=a.map(c.versions,(function(e){if(void 0!==t.totalPackageInfoList[e])return{version:t.totalPackageInfoList[e].package,name:t.totalPackageInfoList[e].displayName,selected:!0}})),t.extensions._extToConsider=c.extensions,t.extensions._extensionList=a.pick(i,t.extensions._extToConsider),t.currPkgInfoList=t.extensions._extensionList,t.applyMetaData()}else if("php"===t.stepName){var u=o.getPkgInfoByType("extensions",t.totalPackageInfoList),d=a.map(a.filter(t.currPkgInfoList,(function(e){return"not_installed"!==e.state})),"package");t.php.commonExtensions=s.getCommonlyInstalledExtensions(u,d)}}()}}}])})),define("app/directives/saveAsProfile",["angular","cjt/util/locale","cjt/core","lodash","cjt/decorators/growlDecorator","app/services/ea4Data","app/services/ea4Util","cjt/directives/validationContainerDirective","cjt/directives/validationItemDirective"],(function(e,t,a,i){e.module("App").directive("saveAsProfile",["ea4Data","ea4Util","growl","growlMessages",function(e,n,o,s){var r={name:"",filename:{name:"",valMsg:""},tags:[],description:"",version:"",overwrite:!1},c="directives/saveAsProfile.ptt";return{replace:!0,restrict:"E",templateUrl:a.config.debug?a.buildFullPath("templates/easyapache4/directives/saveAsProfile.ptt"):c,scope:{idPrefix:"@",packages:"=",actionHandler:"=",position:"@",onCancel:"&",onSaveSuccess:"&",onSaveError:"&",show:"@",saveButtonText:"@"},link:function(a,c,l){a.saveAsData=i.cloneDeep(r),a.highlightOverwrite=!1,a.actionHandler=a.actionHandler||{},a.idPrefix=a.idPrefix||"save",a.position=a.position||"top",a.saveButtonText=a.saveButtonText||t.maketext("Save");var u=function(){a.saveAsData=i.cloneDeep(r),a.form&&a.form.$dirty&&(a.form.txtFilename.$setValidity("invalidFilename",!0),a.form.$setPristine()),i.isUndefined(a.onCancel)||a.onCancel({position:a.position})};a.actionHandler.saveForm=function(){if(s.destroyAllMessages(),i.isUndefined(a.packages))throw"Packages for the profile are not provided. Wherever this directive is used, make sure to fill the packages attribute correctly.";if(a.form.$valid){var n=a.saveAsData.overwrite?1:0,r=i.split(a.saveAsData.tagsAsString,/\s*,\s*/),c=a.saveAsData.filename.name+".json",l={name:a.saveAsData.name,desc:a.saveAsData.desc,pkgs:a.packages,tags:i.compact(r)};return e.saveAsNewProfile(l,c,n).then((function(e){void 0===e||i.isEmpty(e.path)||(o.success(t.maketext("The system successfully saved the current packages to the “[_1]” profile. It is available in the EasyApache 4 profiles page.",i.escape(a.saveAsData.name))),u(),i.isUndefined(a.onSaveSuccess)||a.onSaveSuccess())}),(function(e){void 0!==e.data&&e.data.already_exists&&(a.highlightOverwrite=!0),i.isUndefined(a.onSaveSuccess)||a.onSaveError(),o.error(i.escape(e.error))}))}},a.actionHandler.cancel=function(){u()},a.validateFilenameInput=function(){var e=n.validateFilename(a.saveAsData.filename.name);a.saveAsData.filename.valMsg=e.valMsg,a.form.txtFilename.$setValidity("invalidFilename",e.valid)}}}}])})),define("app/services/pkgResolution",["angular","lodash","cjt/io/api","cjt/io/whm-v1-request","cjt/io/whm-v1","cjt/services/APIService"],(function(e,t){"use strict";e.module("whm.easyapache4.pkgResolution",[]).factory("pkgResolution",(function(){var e={eaRegex:/^ea-/,allConflicts:[],allRequires:[],resolvedRemoveList:[],requireStructure:{safe:[],unsafe:{}},conflictStructure:{safe:[],unsafe:{}},orListStructure:{exist:!1,orLists:[]},resolvedPackages:{addList:[],removeList:[],actionNeeded:!1},resetCommonVariables:function(){e.allConflicts=[],e.allRequires=[],e.resolvedRemoveList=[],e.requireStructure={safe:[],unsafe:{}},e.conflictStructure={safe:[],unsafe:{}},e.orListStructure={exist:!1,orLists:[]},e.resolvedPackages={addList:[],removeList:[],actionNeeded:!1}},getOrListStructure:function(){return e.orListStructure},setOrListStructure:function(t){e.orListStructure=t},getResolvedData:function(){return e.resolvedPackages},resolveDependenciesWhenSelected:function(t,a,i){var n={orListExist:!1,actionNeeded:!1};if(t)if(e.recurseWhenSelected(t,t.package,i),e.allRequires.push(t.package),e.orListStructure=e.updateMultiRequirements(e.orListStructure,a,e.allRequires,e.allConflicts,i),e.orListStructure.exist)n.orListExist=e.orListStructure.exist;else{var o=e.proceedToResolveRequirementsAndConflicts(t,a,i);n.actionNeeded=o}return n},updateMultiRequirements:function(a,i,n,o,s){if(a){var r=t.clone(a.orLists);t.each(r,(function(r){var c=!1,l=t.filter(r,(function(t){return e.eaRegex.test(t)&&void 0!==s[t]})),u=[];if(!(c=t.isEmpty(l)))if(u=t.intersection(l,i),t.isEmpty(u)&&(u=t.intersection(l,n)),t.isEmpty(u)){var d=t.intersection(l,o);1===(l=t.difference(l,d)).length&&(e.allRequires=t.union(n,l),c=!0)}else 1===l.length&&(e.allRequires=t.union(n,l)),c=!0;c?t.pull(a.orLists,r):t.isEqual(r,l)||(t.pull(a.orLists,r),t.isEmpty(l)||(a.orLists=t.concat(a.orLists,[l])))})),a.exist=a.orLists.length>0}return a},continueResolvingDependencies:function(t,a,i,n,o){var s={orListExist:!1,actionNeeded:!1};if(e.recurseWhenSelected(a,i,n),e.allRequires.push(i),e.orListStructure=e.updateMultiRequirements(e.orListStructure,o,e.allRequires,e.allConflicts,n),e.orListStructure.exist)s.orListExist=e.orListStructure.exist;else{var r=e.proceedToResolveRequirementsAndConflicts(t,o,n);s.actionNeeded=r}return s},proceedToResolveRequirementsAndConflicts:function(a,i,n){var o=t.difference(e.allRequires,i);o.length>0&&(e.requireStructure=e.buildRequireStructure(o,i,n));var s=t.intersection(e.allConflicts,i);return s.length>0&&(e.conflictStructure=e.buildConflictStructure(s,i,n)),e.requireStructure=e.resolveUnsafeRequires(i,e.requireStructure,n),e.conflictStructure=e.resolveUnsafeConflicts(i,e.conflictStructure,n),e.resolvedPackages.removeList=t.union(e.resolvedRemoveList,e.conflictStructure.safe),e.resolvedPackages.addList=e.requireStructure.safe,e.resolvedPackages.actionNeeded=e.resolvedPackages.removeList.length>0,e.resolvedPackages.actionNeeded},buildRequireStructure:function(a,i,n){var o=e.requireStructure;return n&&t.each(a,(function(e){var a=!0;t.each(i,(function(i){var s=n[i];void 0!==s&&t.includes(s.pkg_dep.conflicts,e)&&(void 0===o.unsafe[e]&&(o.unsafe[e]=[]),o.unsafe[e].push(i),a=!1)})),a&&o.safe.push(e)})),o},buildConflictStructure:function(a,i,n){var o=e.conflictStructure;return t.each(a,(function(e){var a=!0;t.each(i,(function(i){var s=n[i];void 0!==s&&t.includes(s.pkg_dep.requires,e)&&(void 0===o.unsafe[e]&&(o.unsafe[e]=[]),o.unsafe[e].push(i),a=!1)})),a&&o.safe.push(e)})),o},resolveUnsafeRequires:function(a,i,n){if(i){var o=i.unsafe,s=t.keys(o);t.each(s,(function(s){var r=o[s];r=t.difference(r,e.resolvedRemoveList),t.each(r,(function(i){if(!t.includes(e.resolvedRemoveList,i)){var o=t.difference(a,e.resolvedRemoveList);e.recurseConflictRequirements(n[i],i,o,n),e.resolvedRemoveList=t.union(e.resolvedRemoveList,[i])}})),i.safe.push(s),t.unset(i.unsafe,s)})),i.unsafe={}}return i},resolveUnsafeConflicts:function(a,i,n){if(i){var o=t.omit(i.unsafe,e.resolvedRemoveList),s=t.keys(o);t.each(s,(function(s){var r=t.difference(o[s],e.resolvedRemoveList);t.each(r,(function(i){if(!t.includes(e.resolvedRemoveList,i)){var o=t.difference(a,e.resolvedRemoveList);e.recurseConflictRequirements(n[i],i,o,n),e.resolvedRemoveList=t.union(e.resolvedRemoveList,[i])}})),i.safe.push(s),t.unset(i.unsafe,s)})),i.unsafe={}}return i},recurseConflictRequirements:function(a,i,n,o){var s=a.package;i!==s&&e.resolvedRemoveList.push(s);var r=t.pull(n,s);r=t.filter(r,(function(e){var a=o[e];return void 0!==a&&t.includes(a.pkg_dep.requires,s)})),t.each(r,(function(t){e.recurseConflictRequirements(o[t],i,n,o)}))},recurseWhenSelected:function(a,i,n){if(a){var o=a.package;if(!e.eaRegex.test(o))return;if(t.includes(e.allRequires,o))return;void 0!==i&&o!==i&&e.allRequires.push(o),e.allConflicts=t.union(e.allConflicts,t.filter(a.pkg_dep.conflicts,(function(t){return e.eaRegex.test(t)})));var s=[];if(a.pkg_dep.requires.length>0){s=t.clone(a.pkg_dep.requires);var r=t.remove(s,(function(e){return t.isArray(e)}));r.length>0&&(e.orListStructure.orLists=t.unionWith(e.orListStructure.orLists,r,t.isEqual)),s=t.filter(s,(function(t){return e.eaRegex.test(t)})),s=t.difference(s,e.allRequires)}t.forEach(s,(function(t){var a=n[t];void 0!==a&&e.recurseWhenSelected(a,i,n)}))}},getAllDepsRecursively:function(t,a,i,n,o){var s={};return t?(e.recurseWhenSelected(a,i,n),s={requiredPkgs:e.allRequires,conflictPkgs:e.allConflicts}):(e.recurseWhenUnselected(a,i,n,o),s={removedList:e.resolvedRemoveList}),s},resolveDependenciesWhenUnSelected:function(a,i,n){if(a){var o=a.package;e.resolvedRemoveList.push(o),e.recurseWhenUnselected(a,o,n,i),e.resolvedPackages.removeList=t.uniq(e.resolvedRemoveList)}},recurseWhenUnselected:function(a,i,n,o){var s=a.package;if(e.eaRegex.test(s)&&!t.includes(e.allRequires,s)){void 0!==i&&s!==i&&e.allRequires.push(s);var r=[];if(o.length>0){t.each(o,(function(a){t.includes(n&&n[a]&&n[a].pkg_dep.requires,s)&&(e.resolvedRemoveList.push(a),r.push(a))})),o=t.pullAll(o,r);var c=t.remove(r,(function(e){return t.isArray(e)}));t.each(c,(function(e){t.concat(r,t.filter(e,(function(e){return void 0!==n[e]&&n[e].selectedPackage})))})),r=t.filter(r,(function(t){return e.eaRegex.test(t)})),r=t.difference(r,e.allRequires)}t.forEach(r,(function(t){var a=n[t];void 0!==a&&e.recurseWhenUnselected(a,i,n,o)}))}},setupMultiRequirementForUserInput:function(a){var i={},n=e.getOrListStructure();if(void 0!==n){var o=n.orLists.shift();if(void 0!==o&&o.length>0){var s=t.map(o,(function(e){if(void 0!==a[e])return{package:e,displayName:a[e].displayName}}));i={exist:n.exist,orList:s,chosenPackage:""}}}return i},resetPkgResolveActions:function(t){return e.resetCommonVariables(),t&&(t.actions={removeList:[],addList:[],actionNeeded:!1},t.mpmMissing=!1,t.mpmMissingMsg="",t.multiRequirements={}),t},setupConDepCallout:function(a,i){var n=e.getResolvedData();return n.actionNeeded&&(a.actions.actionNeeded=n.actionNeeded,a.actions.removeList=t.map(n.removeList,(function(e){return i[e].displayName})),a.actions.addList=t.map(n.addList,(function(e){return i[e].displayName}))),a}};return e}))})),define("app/services/wizardApi",["angular","lodash","cjt/util/locale","cjt/io/api","cjt/io/whm-v1-request","cjt/io/whm-v1","cjt/services/APIService"],(function(e,t,a){"use strict";e.module("whm.easyapache4.wizardApi",[]).factory("wizardApi",["$location","wizardState","ea4Data","ea4Util",function(e,i,n,o){var s={defaultWizardState:{showWizard:!1,showSearchAndPage:!1,currentStepIndex:0,showFooter:!1,currentStep:"",lastStepName:"",steps:{mpm:{name:"mpm",title:a.maketext("Apache [output,acronym,MPM,Multi-Processing Modules]"),path:"mpm",stepIndex:1,nextStep:"modules"},modules:{name:"modules",title:a.maketext("Apache Modules"),path:"modules",stepIndex:2,nextStep:"php"},php:{name:"php",title:a.maketext("[output,acronym,PHP,PHP Hypertext Preprocessor] Versions"),path:"php",stepIndex:3,nextStep:"extensions"},extensions:{name:"extensions",title:a.maketext("[output,acronym,PHP,PHP Hypertext Preprocessor] Extensions"),path:"extensions",stepIndex:4,nextStep:"ruby"},ruby:{name:"ruby",title:a.maketext("[asis,Ruby] via [asis,Passenger]"),path:"ruby",stepIndex:5,nextStep:"additional"},additional:{name:"additional",title:a.maketext("Additional Packages"),path:"additional",stepIndex:6,nextStep:"review"},review:{name:"review",title:a.maketext("Review"),path:"review",stepIndex:7,nextStep:""}}},getDefaultWizardState:function(){return s.defaultWizardState},rebuildWizardSteps:function(e,a){e=e||{},a.rubyPkgsExist||delete e.ruby,a.additionalPkgsExist||delete e.additional;var i=t.orderBy(t.values(e),["stepIndex"],["asc"]);return e=t.keyBy(i,(function(e){return e.name}))},init:function(){i.steps=s.defaultWizardState.steps;var e=n.getData("pkgInfoList");if(e){var t={rubyPkgsExist:o.doRubyPkgsExist(e),additionalPkgsExist:n.getData("additionalPkgsExist")};i.steps=s.rebuildWizardSteps(s.defaultWizardState.steps,t)}i.showWizard=!1,i.showSearchAndPage=!1,i.showFooter=!1,i.currentStepIndex=1,i.lastStepName="review"},updateWizard:function(e){t.each(t.keys(e),(function(t){i[t]=e[t]}))},getStepByName:function(e){return i.steps[e]},getStepNameByIndex:function(e){var a=t.find(i.steps,["stepIndex",e]);if(void 0!==a)return a.name},reset:function(){i=s.getDefaultWizardState()},next:function(t){t?(i.currentStepIndex=s.getStepByName(t).stepIndex,i.currentStep=t):(i.currentStepIndex++,t=s.getNextStepNameByIndex(i.currentStepIndex),i.currentStep=t),e.path(t)},getNextStepNameByIndex:function(e){var a=s.getLastStep().stepIndex,n=t.find(i.steps,["stepIndex",e]);if(void 0===n)for(var o=e+1;o<=a;o++)n=t.find(i.steps,["stepIndex",o]);return n?n.name:""},getLastStep:function(){return i.steps[i.lastStepName]}};return{init:s.init,getStepByName:s.getStepByName,updateWizard:s.updateWizard,next:s.next,getDefaultWizardState:s.getDefaultWizardState,reset:s.reset,rebuildWizardSteps:s.rebuildWizardSteps,getLastStep:s.getLastStep,getNextStepNameByIndex:s.getNextStepNameByIndex}}])})),define("app/directives/fileModel",["angular"],(function(e){e.module("App").directive("fileModel",["$parse",function(e){return{restrict:"A",require:"ngModel",link:function(t,a,i,n){var o=e(i.fileModel);a.bind("change",(function(){var e=this.files[0];e&&t.$apply((function(){o.assign(t,e),n.$setViewValue(n.$modelValue),n.$setDirty()}))}))}}}])})),define("app/directives/fileType",["angular"],(function(e){e.module("App").directive("fileType",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,a,i){t.bind("change",(function(){var t=this.files[0];t&&!function(e,t){var a=e.type;if(""===a){var i=e.name.match(/\.((?:.(?!\.))+)$/);"json"===(a=i.length>0?i[1]:"")&&(a="application/"+a)}return t.some((function(e){return e===a}))}(t,e.$eval(a.fileType))?i.$setValidity("filetype",!1):i.$setValidity("filetype",!0)}))}}}])})),define("app/directives/fileSize",["angular"],(function(e){e.module("App").directive("fileSize",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,a,i){t.bind("change",(function(){var e=this.files[0];e&&(0===e.size?i.$setValidity("fileSize",!1):i.$setValidity("fileSize",!0))}))}}}])})),define("app/views/profile",["angular","cjt/util/locale","lodash","cjt/services/alertService","cjt/directives/alertList","cjt/decorators/growlDecorator","app/directives/fileModel","app/directives/fileType","app/directives/fileSize","app/services/ea4Data","app/services/ea4Util","app/services/pkgResolution"],(function(e,t,a){"use strict";var i=e.module("App");i.controller("profile",["$scope","$timeout","$location","$uibModal","ea4Data","ea4Util","alertService","growl","growlMessages",function(i,n,o,s,r,c,l,u,d){i.profileList=[],i.activeProfile={},i.loadingProfiles=!1,i.errorOccurred=!1,i.noProfiles=!1,i.upload={show:!1,profile:{},content:{},disableLocalSec:!0,localSecIsOpen:!0,disableUrlSec:!1,urlSecIsOpen:!1,url:{value:"",filename:"",filenameValMsg:"",showFilenameInput:!1},overwrite:!1,highlightOverwrite:!1},i.convertProfile={show:!1};var p={};i.isLoading=function(){return i.loadingProfiles||i.loadingProfileData};var f=function(e){r.clearEA4LocalStorageItems(),r.setData({selectedPkgs:e.pkgs,customize:!0,ea4Recommendations:p}),o.path("loadPackages")};i.$on("$viewContentLoaded",(function(){i.customize.wizard.currentStep="",i.customize.wizard.showWizard=!1,l.clear(),r.clearEA4LocalStorageItems(),i.loadProfiles()})),i.checkForEA4Updates=function(){i.customize.checkUpdateInfo=e.copy(c.checkUpdateInfo),r.getPkgInfoList().then((function(e){if(void 0!==e){var t=e;r.setData({ea4RawPkgList:t});var n=a.map(a.filter(t,["state","updatable"]),(function(e){return e.package}));i.customize.checkUpdateInfo.pkgNumber=n.length,i.customize.toggleUpdateButton()}i.customize.checkUpdateInfo.isLoading=!1}),(function(e){l.add({type:"danger",message:e,id:"alertMessages",closeable:!1})}))},i.loadProfiles=function(){i.profileList=[],i.loadingProfiles=!0,r.getProfiles().then((function(e){void 0!==e?(i.noProfiles=!1,i.checkForEA4Updates(),i.loadingProfileData=!0,r.getEA4Recommendations().then((function(t){p=t.data,P(e,p)}),(function(e){x(e)})).finally((function(){i.loadingProfileData=!1}))):i.noProfiles=!0}),(function(e){e&&(i.errorOccurred=!0,r.setData({ea4ThrewError:!0}),o.path("yumUpdate"))})).finally((function(){i.loadingProfiles=!1}))},i.viewProfile=function(t){var a=e.copy(t);s.open({templateUrl:"profileModalContent.tmpl",controller:"ModalInstanceCtrl",resolve:{data:function(){return a}}})},i.customizeCurrentProfile=function(e){f(e)},i.proceedNext=function(e,t){i.clickedCustomize=t,e.isValid?(e.showValidationWarning=!1,i.continueAction(e)):e.showValidationWarning=!0},i.continueAction=function(e){var t=i.clickedCustomize;i.clickedCustomize=!1,-1===e.pkgs.indexOf("ea-apache24")&&e.pkgs.push("ea-apache24"),t?f(e):function(e){r.setData({selectedProfile:e}),o.path("review")}(e)},i.reset=function(e){i.clickedCustomize=!1,e.showValidationWarning=!1},i.hideRecommendations=function(t){t.showRecommendations=!1,n((function(){e.element("#toggleRecommendations").focus()}))},i.showRecommendations=function(t){t.showRecommendations=!0,n((function(){e.element("#recommendations_container").focus()}))};var g=function(e){var t=e.$error;void 0!==t&&a.each(a.keys(t),(function(e){i.formUpload.profile_file.$setValidity(e,!0)}))},m=function(t){if(t.profile={},i.formUpload&&i.formUpload.$dirty){g(i.formUpload.profile_file),i.formUpload.$setPristine();try{e.element("#profile_file").val(null)}catch(t){e.element("#form_upload_profile").reset()}}},v=function(e){if(e.filename="",e.filenameValMsg="",e.value="",e.showFilenameInput=!1,i.formUpload&&i.formUpload.$dirty){var t=i.formUpload.profile_file_url.$error;void 0!==t&&a.each(a.keys(t),(function(e){i.formUpload.profile_file.$setValidity(e,!0)})),g(i.formUpload.profile_file_url),g(i.formUpload.txtUploadUrlFilename),i.formUpload.$setPristine()}},h=function(){d.destroyAllMessages();var e=i.upload.profile;if(t=e.name,n=!0,/(?:\.\.|\\|\/)/.test(t)&&(n=!1),n){var t,n;i.$apply(i.formUpload.profile_file.$setValidity("invalidfilename",!0));var o=new FileReader;o.readAsText(e),o.onloadend=function(){if(o.readyState&&!o.error){var e=k(o.result);a.each(a.keys(e.val_results),(function(t){i.$apply(i.formUpload.profile_file.$setValidity(t,e.val_results[t]))})),i.formUpload.profile_file_url.$valid&&(i.upload.content=e.content)}}}else i.$apply(i.formUpload.profile_file.$setValidity("invalidfilename",!1))},k=function(e){var t,i,n="",o={};try{n=JSON.parse(e),o.invalidformat=!0,t=n,i=!0,(a.isEmpty(t.name)||a.isEmpty(t.pkgs))&&(i=!1),o.content=!!i}catch(e){o.invalidformat=!1,console.log(e)}return{content:n,val_results:o}};i.cancelUpload=function(){i.upload.show=!1,function(){d.destroyAllMessages();var e=i.upload;e.content={},e.overwrite=!1,e.highlightOverwrite=!1,e.disableLocalSec=!0,e.localSecIsOpen=!0,e.disableUrlSec=!1,e.urlSecIsOpen=!1,m(i.upload),v(i.upload.url)}()},i.resetUploadUrl=function(){v(i.upload.url)},i.getAndValidateUploadDataFromURL=function(){return d.destroyAllMessages(),r.getUploadContentFromUrl(i.upload.url.value).then((function(e){if(void 0!==e&&"200"===e.status){var n=e.headers["content-type"];if(!/^(application|text)\/json/.test(n))return void i.formUpload.profile_file_url.$setValidity("filetype",!1);i.formUpload.profile_file_url.$setValidity("filetype",!0);var o=k(e.content);a.each(a.keys(o.val_results),(function(e){i.formUpload.profile_file_url.$setValidity(e,o.val_results[e])})),i.formUpload.profile_file_url.$valid?(i.upload.content=o.content,i.upload.url.showFilenameInput=!0):i.upload.url.showFilenameInput=!1}else{var s=t.maketext("Status: “[output,strong,_1]”. Reason: “[output,em,_2]”.",a.escape(e.status),a.escape(e.reason));u.error(s)}}),(function(e){u.error(a.escape(e))}))},i.validateFilenameInput=function(){var e=c.validateFilename(i.upload.url.filename);i.upload.url.filenameValMsg=e.valMsg,i.formUpload.txtUploadUrlFilename.$setValidity("valFilename",e.valid)},i.uploadProfile=function(){if(d.destroyAllMessages(),i.formUpload.$valid){var e=i.upload.overwrite?1:0,n=void 0!==i.upload.profile.name?i.upload.profile.name:i.upload.url.filename+".json";return r.saveAsNewProfile(i.upload.content,n,e).then((function(e){void 0===e||a.isEmpty(e.path)||(i.loadProfiles(),u.success(t.maketext("The system successfully uploaded your profile.")),i.cancelUpload())}),(function(e){!a.isEmpty(e.data)&&e.data.already_exists&&(i.upload.highlightOverwrite=!0),u.error(a.escape(e.error))}))}},i.handleAccordionToggle=function(){m(i.upload),v(i.upload.url),i.upload.urlSecIsOpen?(i.upload.disableLocalSec=!1,i.upload.disableUrlSec=!0):(i.upload.disableUrlSec=!1,i.upload.disableLocalSec=!0)},i.showPopover=function(e){switch(i.convertProfile.cancel(),e){case"upload":i.upload.show=!0,document.querySelector("#profile_file").onchange=h;var t=document.querySelectorAll(".panel-heading a");a.each(t,(function(e){e.onclick=i.handleAccordionToggle}));break;case"convert":i.convertProfile.show=!0}};var P=function(e,n){var o=a.sortBy(a.keys(e));a.each(o,(function(o){void 0!==e[o]&&a.each(e[o],(function(e){if(e.profileType=o,e.tagsAsString=t.list_and(e.tags),e.isValid=!0,e.showValidationWarning=!1,e.active){i.activeProfile=e,i.customize.activeProfilePkgs=e.pkgs;var s=function(e,i){var n=e.pkgs,o=a.intersection(n,a.keys(i)),s={};return a.each(o,(function(e){var o=i[e],r=c.decideShowHideRecommendations(o,n,!0,e);r=a.filter(r,["level","danger"]),a.isEmpty(r)||(s[e]={},s[e].recosList=r,s[e].show=!a.every(r,["show",!1]),s[e].footNote=t.maketext("These recommendations appear because you have “[_1]” installed on your system.",e))})),s}(i.activeProfile,n);if(a.isEmpty(a.keys(s)))i.activeProfile.recommendations={};else{i.activeProfile.showRecommendations=!1;var r=a.pickBy(s,(function(e,t){return s[t].show})),l=0;a.each(a.keys(r),(function(e){l+=a.filter(r[e].recosList,["show",!0]).length})),i.activeProfile.recommendations=r,i.activeProfile.recommendationLabel=t.maketext("[quant,_1,Recommendation,Recommendations]",l),i.activeProfile.recommendationsExist=!!l}}else{e.isValid=a.isEmpty(e.validation_data.not_on_server),e.isValid||(e.validation_data.not_on_server_without_prefix=c.getFormattedPackageList(e.validation_data.not_on_server)),e.id=o+"_"+e.path.replace(/\.json/,"");var u="cpanel"!==o&&"custom"!==o?"vendor/"+o:o;e.downloadUrl="ea4_profile_download/"+u+"?filename="+e.path,i.profileList.push(e)}}))})),i.noProfiles=i.profileList.length<=0;var s=c.createTagsForActiveProfile(i.activeProfile.pkgs);i.activeProfile.tags=s,i.activeProfile.tagsAsString=t.list_and(s)},x=function(e){i.errorOccurred=!0,l.add({type:"danger",message:e,id:"alertMessages",closeable:!1})}}]),i.controller("ModalInstanceCtrl",["$scope","$uibModalInstance","data","ea4Util",function(e,t,a,i){e.modalData={};var n=a;n.pkgs=i.getProfilePackagesByCategories(n.pkgs),e.modalData=n,e.closeModal=function(){t.close()}}])})),define("app/views/yumUpdate",["angular","cjt/util/locale","lodash","cjt/services/alertService","cjt/directives/alertList","app/services/ea4Data","app/services/ea4Util","app/services/pkgResolution"],(function(e,t,a){var i=e.module("App");i.controller("yumUpdate",["$scope","$location","ea4Data","ea4Util","alertService","growl","growlMessages",function(e,t,a,n,o,s,r){e.fixFailed=!1;e.$on("$viewContentLoaded",(function(){r.destroyAllMessages(),a.getData("ea4ThrewError")&&(e.fixingYum=!0,a.fixYumCache().then((function(n){n.status&&n.data.cache_seems_ok_now?(i.firstLoad=!1,a.setData({ea4ThrewError:!1}),t.path("profile")):e.fixFailed=!0}),(function(t){e.fixFailed=!0})).finally((function(){e.fixingYum=!1})))}))}])})),define("app/views/customize",["angular","lodash","cjt/util/locale","app/services/ea4Data","app/services/pkgResolution"],(function(e,t,a){"use strict";e.module("App").controller("customize",["$scope","ea4Data","pkgResolution","wizardState","wizardApi","$location","ea4Util",function(e,i,n,o,s,r,c){e.customize={pkgInfoList:{},selectedPkgs:[],currentPkgInfoList:{},saveProfilePopup:{position:"top",showTop:!1,showBottom:!1},activeProfilePkgs:[]},e.customize.wizard=o,e.customize.wizardApi=s,e.customize.showsaveProfilePopup=function(t){e.customize.saveProfilePopup.position=t,"top"!==t?(e.customize.saveProfilePopup.showTop=!1,e.customize.saveProfilePopup.showBottom=!0):(e.customize.saveProfilePopup.showTop=!0,e.customize.saveProfilePopup.showBottom=!1)},e.customize.clearSaveProfilePopup=function(t){"top"!==t?(e.customize.saveProfilePopup.showTop=!1,e.customize.saveProfilePopup.showBottom=!1,e.customize.saveProfilePopup.position="top"):(e.customize.saveProfilePopup.showTop=!1,e.customize.saveProfilePopup.showBottom=!1)},e.customize.loadData=function(a){n.resetCommonVariables(),e.customize.pkgInfoList=i.getData("pkgInfoList");var o=i.getData("customize");t.keys(e.customize.pkgInfoList).length<=0?i.cancelOperation():(e.customize.selectedPkgs=i.getData("selectedPkgs"),s.updateWizard({showWizard:o,currentStep:a}),"review"===a?c.hideFooter():c.showFooter())},e.customize.processPkgInfoList=function(t){if(void 0!==t){var a=i.getData("ea4Recommendations");e.customize.pkgInfoList=i.buildPkgInfoList(e.customize.selectedPkgs,t,a),i.setData({pkgInfoList:e.customize.pkgInfoList})}},e.customize.loadPkgInfoList=function(){n.resetCommonVariables(),e.customize.selectedPkgs=i.getData("selectedPkgs");var t=i.getPkgInfoList();return t.then((function(t){e.customize.processPkgInfoList(t)})),t},e.customize.proceed=function(t){i.setData({pkgInfoList:e.customize.pkgInfoList,selectedPkgs:e.customize.selectedPkgs}),s.next(t)},e.customize.getStepClass=function(t){if(t===e.customize.wizard.currentStep)return"active"},e.customize.getViewWidthCss=function(e){return e?"col-xs-9":"col-xs-12"},e.customize.provisionEA4Updates=function(){i.clearEA4LocalStorageItems(),i.setData({selectedPkgs:e.customize.activeProfilePkgs,ea4Update:!0}),r.path("review")},e.customize.toggleUpdateButton=function(){e.customize.checkUpdateInfo.pkgNumber>0?(e.customize.checkUpdateInfo.btnText=a.maketext("Update [asis,EasyApache 4]"),e.customize.checkUpdateInfo.btnTitle=a.maketext("Update [asis,EasyApache 4]"),e.customize.checkUpdateInfo.btnCss="btn-primary"):(e.customize.checkUpdateInfo.btnText=a.maketext("[asis,EasyApache 4] is up to date[comment,no punctuation due to usage]"),e.customize.checkUpdateInfo.btnTitle=a.maketext("[asis,EasyApache 4] is up to date[comment,no punctuation due to usage]"),e.customize.checkUpdateInfo.btnCss="btn-primary disabled")}}])})),define("app/views/loadPackages",["angular","lodash","cjt/services/alertService"],(function(e,t){"use strict";e.module("App").controller("loadPackages",["$scope","alertService","wizardApi","wizardState","ea4Data","ea4Util","pkgResolution",function(e,t,a,i,n,o,s){e.$on("$viewContentLoaded",(function(){var r;null===(r=n.getData("ea4RawPkgList"))?e.customize.loadPkgInfoList().then((function(){n.getEA4MetaInfo().then((function(t){if(t.data){o.additionalPkgList=t.data.additional_packages;var s=o.doAdditionalPkgsExist(o.additionalPkgList,e.customize.pkgInfoList);n.setData({additionalPkgsExist:s});var r={rubyPkgsExist:o.doRubyPkgsExist(e.customize.pkgInfoList),additionalPkgsExist:s};i.steps=a.rebuildWizardSteps(i.steps,r),e.customize.proceed("mpm")}}),(function(e){t.add({type:"danger",message:e,id:"alertMessages",closeable:!1})}))}),(function(e){t.add({type:"danger",message:e,id:"alertMessages",closeable:!1})})):(s.resetCommonVariables(),e.customize.selectedPkgs=n.getData("selectedPkgs"),e.customize.processPkgInfoList(r),a.init(),e.customize.proceed("mpm"))}))}])})),define("app/views/mpm",["angular"],(function(e){e.module("App").controller("mpm",["$scope",function(e){e.$on("$viewContentLoaded",(function(){e.customize.loadData("mpm")}))}])})),define("app/views/modules",["angular"],(function(e){e.module("App").controller("modules",["$scope",function(e){e.$on("$viewContentLoaded",(function(){e.customize.loadData("modules")}))}])})),define("app/views/php",["angular","cjt/util/locale"],(function(e,t){e.module("App").controller("php",["$scope","PAGE",function(e,a){e.$on("$viewContentLoaded",(function(){e.customize.loadData("php"),function(){var i=a.cl_data,n=a.cl_licensed;if(e.linkTarget="_blank",e.purchaseLink="",e.clActionText="",e.hasCustomUrl=i.purchase_cl_data.is_url,void 0!==i){var o=i.purchase_cl_data;!i.cl_is_supported||i.cl_is_installed||o.disable_upgrade?e.showCLBanner=!1:(e.showCLBanner=!0,o.server_timeout||o.error_msg&&""!==o.error_msg?e.hideUpgradeOption=!0:(e.hideUpgradeOption=!1,n?(e.purchaseLink="scripts13/install_cloudlinux_EA4",e.clActionText=t.maketext("Install [asis,CloudLinux]"),e.linkTarget="_self"):(e.purchaseLink=i.purchase_cl_data.url,e.clActionText=t.maketext("Upgrade to [asis,CloudLinux]")))),e.purchaseClData=o}}()}))}])})),define("app/views/extensions",["angular"],(function(e){e.module("App").controller("extensions",["$scope",function(e){e.$on("$viewContentLoaded",(function(){e.customize.loadData("extensions")}))}])})),define("app/views/additionalPackages",["angular"],(function(e){"use strict";e.module("App").controller("additionalPackages",["$scope",function(e){e.$on("$viewContentLoaded",(function(){e.customize.loadData("additional")}))}])})),define("app/views/review",["angular","lodash","app/services/ea4Data","app/services/ea4Util"],(function(e,t){e.module("App").controller("review",["$scope","$location","ea4Data","ea4Util","growlMessages",function(e,a,i,n,o){e.readyToProvision=!1,e.gettingResults=!0;var s={},r=function(t,a){i.resolvePackages(t).then((function(t){e.installList=n.getFormattedPackageList(t.install),e.uninstallList=n.getFormattedPackageList(t.uninstall),e.upgradeList=n.getFormattedPackageList(t.upgrade),e.existingList=n.getFormattedPackageList(t.unaffected),e.installList.length||e.upgradeList.length||e.uninstallList.length?(i.setData({provisionActions:{profileId:a,install:t.install,uninstall:t.uninstall,upgrade:t.upgrade}}),e.readyToProvision=!0,i.provisionReady(!0)):e.noActionRequired=!0}),(function(t){e.apiError=!0,e.yumErrorMessage=t})).finally((function(){e.gettingResults=!1}))};e.$on("$viewContentLoaded",(function(){if(s=a.search(),t.isEmpty(s)||t.isEmpty(s.install)&&t.isEmpty(s.uninstall)){var n=i.getData("customize"),o=i.getData("ea4Update");if(n)e.customize.loadData("review"),r(i.getData("selectedPkgs"));else if(o)r(i.getData("selectedPkgs"));else{var c=i.getData("selectedProfile");c||i.cancelOperation(),r(c.pkgs,c.fullPath)}}else l=s,u=[],i.ea4GetCurrentPkgList().then((function(e){if(e.status){u=e.data;var a=t.isArray(l.install)?l.install:[l.install];u=t.union(u,a);var i=t.isArray(l.uninstall)?l.uninstall:[l.uninstall];u=t.difference(u,i),r(u)}}));var l,u})),e.cancel=function(){i.cancelOperation()}}])})),define("app/views/provision",["angular","cjt/util/locale","app/services/ea4Data","app/services/ea4Util"],(function(e,t){"use strict";var a=e.module("App");a.controller("provision",["$scope","$location","ea4Data","spinnerAPI",function(e,i,n,o){var s="";e.realTimeLogDisplay="";var r=!1,c=function(){n.tailingLog(e.buildID,e.currentTailingPosition).then((function(a){for(var i=!1,l=0,u=a.content;l<u.length;l++)if(u[l]!=="-- "+e.buildID+" --")if(u[l]!=="-- /"+e.buildID+" --")s+=u[l]+"\r\n",u[l]=u[l].replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/'/gm,"&#39;").replace(/"/gm,"&quot;"),u[l]!=="-- error("+e.buildID+") --"?u[l]!=="-- /error("+e.buildID+") --"?(i&&(u[l]="<span class='text-danger'>"+u[l]+"</span>"),/Error:.*/gm.test(u[l])&&(u[l]="<span class='text-danger'>"+u[l]+"</span>",r=!0),e.realTimeLogDisplay+=u[l]+"\r\n"):i=!1:(i=!0,r=!0);else{var d=t.maketext("Provision process finished.");s+=d+"\r\n",e.realTimeLogDisplay+="<span class='text-success'><strong>"+d+"</strong></span>\r\n"}else{var p=t.maketext("Provision process started.");s+=p+"\r\n",e.realTimeLogDisplay+="<span class='text-success'><strong>"+p+"</strong></span>\r\n"}window.setTimeout((function(){var e=document.getElementById("log");e&&(e.scrollTop=e.scrollHeight)}),100),e.currentTailingPosition=a.offset,a.still_running?window.setTimeout(c(),100):(o.stop("provisionSpinner"),e.finished=!0,n.provisionReady(!1))}))};e.$on("$viewContentLoaded",(function(){e.customize.wizard.currentStep="",e.customize.wizard.showWizard=!1;var t=n.getData("provisionActions");n.provisionReady()&&void 0!==t||n.cancelOperation(),"bottom"===i.hash()?function(t){o.start("provisionSpinner"),e.provisionStarted=!0,r=!1,n.doProvision(t.install,t.uninstall,t.upgrade,t.profileId).then((function(t){e.buildID=t.build,e.currentTailingPosition=0,c()})).finally((function(){e.customize.checkUpdateInfo.pkgNumber=0,e.customize.toggleUpdateButton(),n.clearEA4LocalStorageItems(),a.firstLoad=!1,n.php_set_session_save_path()}))}(t):i.hash("bottom")})),e.cancel=function(){n.cancelOperation()},e.resultReady=function(){var a=null;return r?(a="alert-danger",e.resultSummary=t.maketext("The provision process exited with errors. Please check the log for details.")):(a="alert-success",e.resultSummary=t.maketext("The provision process is complete.")),a};var l=function(e){document.body.removeChild(e.target)};e.saveLog=function(){var e=new Blob([s],{type:"text/plain"}),t=document.createElement("a");t.download="log.txt",t.innerHTML="My Hidden Link",window.URL=window.URL||window.webkitURL,t.href=window.URL.createObjectURL(e),t.onclick=l,t.style.display="none",document.body.appendChild(t),t.click()}}])})),define("app/views/ruby",["angular"],(function(e){e.module("App").controller("ruby",["$scope",function(e){e.$on("$viewContentLoaded",(function(){e.customize.loadData("ruby")}))}])})),define("app/index",["angular","cjt/core","lodash","cjt/modules"],(function(e,t,a){"use strict";return function(){return e.module("App",["cjt2.config.whm.configProvider","ngRoute","ui.bootstrap","cjt2.whm","angular-growl","whm.easyapache4.ea4Util","whm.easyapache4.ea4Data","whm.easyapache4.pkgResolution","whm.easyapache4.wizardApi"]),require(["cjt/bootstrap","cjt/util/locale","cjt/directives/toggleSwitchDirective","cjt/directives/searchDirective","app/directives/eaWizard","app/directives/saveAsProfile","app/services/ea4Data","app/services/ea4Util","app/services/pkgResolution","app/services/wizardApi","cjt/views/applicationController","app/views/profile","app/views/yumUpdate","app/views/customize","app/views/loadPackages","app/views/mpm","app/views/modules","app/views/php","app/views/extensions","app/views/additionalPackages","app/views/review","app/views/provision","app/views/ruby"],(function(i,n){var o=e.module("App");o.value("PAGE",PAGE),o.firstLoad=!0;o.value("wizardState",{}),o.config(["$routeProvider","$compileProvider",function(e,a){e.when("/profile",{controller:"profile",templateUrl:t.buildFullPath("easyapache4/views/profile.ptt")}).when("/loadPackages",{controller:"loadPackages",templateUrl:t.buildFullPath("easyapache4/views/loadPackages.ptt")}).when("/mpm",{controller:"mpm",templateUrl:t.buildFullPath("templates/easyapache4/views/mpm.phtml")}).when("/modules",{controller:"modules",templateUrl:t.buildFullPath("templates/easyapache4/views/modules.phtml")}).when("/php",{controller:"php",templateUrl:t.buildFullPath("easyapache4/views/php.ptt")}).when("/extensions",{controller:"extensions",templateUrl:t.buildFullPath("templates/easyapache4/views/extensions.phtml")}).when("/additional",{controller:"additionalPackages",templateUrl:t.buildFullPath("templates/easyapache4/views/additionalPackages.phtml")}).when("/review",{controller:"review",templateUrl:t.buildFullPath("easyapache4/views/review.ptt")}).when("/ruby",{controller:"ruby",templateUrl:t.buildFullPath("templates/easyapache4/views/ruby.phtml")}).when("/provision",{controller:"provision",templateUrl:t.buildFullPath("easyapache4/views/provision.ptt")}).when("/yumUpdate",{controller:"yumUpdate",templateUrl:t.buildFullPath("easyapache4/views/yumUpdate.ptt")}).otherwise({redirectTo:"/profile"}),a.aHrefSanitizationWhitelist(/^\s*(https?|blob):/)}]),o.run(["$rootScope","$location","ea4Util","wizardApi","wizardState",function(e,t,i,n,o){a.isEmpty(o)&&(n.init(),i.hideFooter()),e.$on("$routeChangeStart",(function(){e.currentRoute=t.path()}))}]),i(document)}))}}));