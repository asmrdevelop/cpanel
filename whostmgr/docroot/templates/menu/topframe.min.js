(function(){"use strict";var LOADAVG_TIMEOUT=5*1e3*60;var documentHidden=void 0;var isPageVisible=function(){return documentHidden===void 0||!document[documentHidden]};var checkRecentActivity=function(){return isPageVisible()&&(!top._LAST_ACTIVITY||new Date-top._LAST_ACTIVITY<LOADAVG_TIMEOUT)};var loadLiveEl;var loadLiveOne;var loadLiveFive;var loadLiveFifteen;var updateLoad=function(event){if(loadLiveEl){var loadavgs=JSON.parse(event.target.responseText);loadLiveOne.textContent=loadavgs.one;loadLiveFive.textContent=loadavgs.five;loadLiveFifteen.textContent=loadavgs.fifteen;if(loadLiveEl.classList.contains("hidden")){loadLiveEl.classList.remove("hidden")}if(checkRecentActivity()){if(loadavgs["one"]<.5){setTimeout(getLoadAverage,15e3)}else if(loadavgs["one"]<1){setTimeout(getLoadAverage,3e4)}else{setTimeout(getLoadAverage,45e3)}}else{setTimeout((function checkActivity(){if(checkRecentActivity()){getLoadAverage()}else{setTimeout(checkActivity,2e4)}}),2e4)}return}setTimeout((function(){updateLoad(event)}),1e3)};var getLoadAverage=function(){var request=new XMLHttpRequest;request.addEventListener("load",(function(event){if(request.status===0||request.status>=200&&request.status<300||request.status===304){updateLoad(event)}}));var url="";if(window.COMMON.securityToken){url=window.COMMON.securityToken+"/json-api/loadavg"}else{url="/json-api/loadavg"}if(url){request.open("GET",url,true);request.send()}};var setLastActivity=function(){top._LAST_ACTIVITY=new Date};var handleVisibilityChange=function(event){if(isPageVisible()){setLastActivity()}};var attachLoadAvg=function(){var frames=top.document.getElementsByTagName("frame");var initializeEventHandler=function(frame){frame.document.body.addEventListener("click",setLastActivity);frame.document.body.addEventListener("keyup",setLastActivity)};if(frames){for(var len=frames.length-1;len>-1;len--){var frame=frames[len];frame.contentWindow.addEventListener("load",initializeEventHandler(this))}}};var checkUpdateAvailability=function(){var getUpdateAvailabilityEl=document.getElementById("getUpdateAvailability");if(getUpdateAvailabilityEl){var request=new XMLHttpRequest;request.addEventListener("load",(function(event){if(request.status===0||request.status>=200&&request.status<300||request.status===304){if(event&&event.target&&event.target.responseText){var response=JSON.parse(event.target.responseText);if(response&&response.data&&response.data.update_available){var updateNewestVersionEl=document.getElementById("lblUpdateNewestVersion");if(updateNewestVersionEl){updateNewestVersionEl.textContent=updateNewestVersionEl.textContent.replace("[PLACEHOLDER_VALUE_UPDATE_VERSION]",response.data.newest_version)}if(getUpdateAvailabilityEl.classList.contains("hidden")){getUpdateAvailabilityEl.classList.remove("hidden")}}}}}));var url="";if(window.COMMON.securityToken){url=window.COMMON.securityToken+"/json-api/get_update_availability?api.version=1"}else{url="/json-api/get_update_availability?api.version=1"}if(url){request.open("GET",url,true);request.send()}}};var logoutWHM=function(){if(typeof sessionStorage.searchTerm!=="undefined"){delete sessionStorage.searchTerm;delete sessionStorage.userName}};var addVisibilityListener=function(){var visibilityChange=void 0;if(typeof document.hidden!=="undefined"){documentHidden="hidden";visibilityChange="visibilitychange"}else if(typeof document.msHidden!=="undefined"){documentHidden="msHidden";visibilityChange="msvisibilitychange"}else if(typeof document.webkitHidden!=="undefined"){documentHidden="webkitHidden";visibilityChange="webkitvisibilitychange"}if(documentHidden!==void 0){document.addEventListener(visibilityChange,handleVisibilityChange)}};function updateUIForQuota(data){if(data&&parseInt(data.quota_enabled)!==1){var quotaWarnings=document.querySelectorAll(".quota_sensitive");for(var quotaWarning in quotaWarnings){if(quotaWarnings[quotaWarning].style){quotaWarnings[quotaWarning].style.display=""}}var quotaValues=document.querySelectorAll(".quota_insensitive");for(var quotaValue in quotaValues){if(quotaValues[quotaValue].style){quotaValues[quotaValue].style.display="none"}}}}function checkQuota(){if(typeof window.COMMON.isDnsOnly!=="undefined"&&window.COMMON.isDnsOnly){return}var pageURL=window.location.toString();var needsRebootReasonIsQuota=typeof window.serverNeedsReboot==="object"&&window.serverNeedsReboot!==null?parseInt(window.serverNeedsReboot.quota,10):parseInt(window.serverNeedsReboot,10)===1;var noCache=pageURL.match(/newquota/)||pageURL.match(/graceful_reboot_landing/)||pageURL.match(/forcereboot/)||needsRebootReasonIsQuota;if(noCache){window.localStorage.removeItem("cPQuotaStatus")}var cached=window.localStorage.getItem("cPQuotaStatus");if(cached){cached=JSON.parse(cached);if(typeof cached==="object"&&cached.hasOwnProperty("lastChecked")&&Date.now()-cached.lastChecked<36e5){updateUIForQuota(cached);return false}}var xmlhttp=new XMLHttpRequest;xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState===XMLHttpRequest.DONE){if(xmlhttp.status===200){var response=JSON.parse(xmlhttp.responseText);updateUIForQuota(response.data);response.data.lastChecked=Date.now();if(!noCache){window.localStorage.setItem("cPQuotaStatus",JSON.stringify(response.data))}}}};var uri="/json-api/quota_enabled?api.version=1";if(window.COMMON.securityToken){uri=window.COMMON.securityToken+uri}xmlhttp.open("GET",uri,true);xmlhttp.send()}var init=function(){var logoutLink=document.getElementById("lnkLogout");loadLiveEl=document.getElementById("loadlive");if(!logoutLink&&!loadLiveEl){return}logoutLink.addEventListener("click",logoutWHM);loadLiveOne=loadLiveEl.querySelector("#lavg_one");loadLiveFive=loadLiveEl.querySelector("#lavg_five");loadLiveFifteen=loadLiveEl.querySelector("#lavg_fifteen");setLastActivity();getLoadAverage();checkQuota();addVisibilityListener();attachLoadAvg();if(window.COMMON.hasRootPrivileges){checkUpdateAvailability()}};window.addEventListener("content-container-init",init)})();
